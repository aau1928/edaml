<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>环境数据分析与机器学习 - 4&nbsp; 环境数据统计分析</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./CH5.html" rel="next">
<link href="./CH3.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="edaml.scss">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./CH4.html">进阶知识</a></li><li class="breadcrumb-item"><a href="./CH4.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">环境数据统计分析</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">环境数据分析与机器学习</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="搜索"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">前言</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">基础知识</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CH1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">绪论</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CH2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">R语言编程基础</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CH3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">环境数据整理与可视化</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">进阶知识</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CH4.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">环境数据统计分析</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CH5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">R语言机器学习建模</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">高阶知识</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CH6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">R语言深度学习建模</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">参考文献</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目录</h2>
   
  <ul>
  <li><a href="#描述性统计" id="toc-描述性统计" class="nav-link active" data-scroll-target="#描述性统计"><span class="header-section-number">4.1</span> 描述性统计</a>
  <ul>
  <li><a href="#频数分析" id="toc-频数分析" class="nav-link" data-scroll-target="#频数分析"><span class="header-section-number">4.1.1</span> 频数分析</a></li>
  <li><a href="#集中趋势" id="toc-集中趋势" class="nav-link" data-scroll-target="#集中趋势"><span class="header-section-number">4.1.2</span> 集中趋势</a></li>
  <li><a href="#离散程度" id="toc-离散程度" class="nav-link" data-scroll-target="#离散程度"><span class="header-section-number">4.1.3</span> 离散程度</a></li>
  <li><a href="#数据分布特征" id="toc-数据分布特征" class="nav-link" data-scroll-target="#数据分布特征"><span class="header-section-number">4.1.4</span> 数据分布特征</a></li>
  <li><a href="#数据摘要" id="toc-数据摘要" class="nav-link" data-scroll-target="#数据摘要"><span class="header-section-number">4.1.5</span> 数据摘要</a></li>
  </ul></li>
  <li><a href="#推断性统计" id="toc-推断性统计" class="nav-link" data-scroll-target="#推断性统计"><span class="header-section-number">4.2</span> 推断性统计</a>
  <ul>
  <li><a href="#随机抽样方法" id="toc-随机抽样方法" class="nav-link" data-scroll-target="#随机抽样方法"><span class="header-section-number">4.2.1</span> 随机抽样方法</a>
  <ul>
  <li><a href="#简单随机抽样" id="toc-简单随机抽样" class="nav-link" data-scroll-target="#简单随机抽样"><span class="header-section-number">4.2.1.1</span> 简单随机抽样</a></li>
  <li><a href="#系统抽样" id="toc-系统抽样" class="nav-link" data-scroll-target="#系统抽样"><span class="header-section-number">4.2.1.2</span> 系统抽样</a></li>
  <li><a href="#分层抽样" id="toc-分层抽样" class="nav-link" data-scroll-target="#分层抽样"><span class="header-section-number">4.2.1.3</span> 分层抽样</a></li>
  <li><a href="#整群抽样和多阶段抽样" id="toc-整群抽样和多阶段抽样" class="nav-link" data-scroll-target="#整群抽样和多阶段抽样"><span class="header-section-number">4.2.1.4</span> 整群抽样和多阶段抽样</a></li>
  </ul></li>
  <li><a href="#参数估计" id="toc-参数估计" class="nav-link" data-scroll-target="#参数估计"><span class="header-section-number">4.2.2</span> 参数估计</a>
  <ul>
  <li><a href="#点估计" id="toc-点估计" class="nav-link" data-scroll-target="#点估计"><span class="header-section-number">4.2.2.1</span> 点估计</a></li>
  <li><a href="#区间估计" id="toc-区间估计" class="nav-link" data-scroll-target="#区间估计"><span class="header-section-number">4.2.2.2</span> 区间估计</a></li>
  <li><a href="#自举采样估计" id="toc-自举采样估计" class="nav-link" data-scroll-target="#自举采样估计"><span class="header-section-number">4.2.2.3</span> 自举采样估计</a></li>
  </ul></li>
  <li><a href="#假设检验" id="toc-假设检验" class="nav-link" data-scroll-target="#假设检验"><span class="header-section-number">4.2.3</span> 假设检验</a>
  <ul>
  <li><a href="#假设检验的步骤" id="toc-假设检验的步骤" class="nav-link" data-scroll-target="#假设检验的步骤"><span class="header-section-number">4.2.3.1</span> 假设检验的步骤</a></li>
  <li><a href="#检验功效及其计算" id="toc-检验功效及其计算" class="nav-link" data-scroll-target="#检验功效及其计算"><span class="header-section-number">4.2.3.2</span> 检验功效及其计算</a></li>
  <li><a href="#单正态总体均值与方差的假设检验" id="toc-单正态总体均值与方差的假设检验" class="nav-link" data-scroll-target="#单正态总体均值与方差的假设检验"><span class="header-section-number">4.2.3.3</span> 单正态总体均值与方差的假设检验</a></li>
  <li><a href="#双正态总体均值与方差的假设检验" id="toc-双正态总体均值与方差的假设检验" class="nav-link" data-scroll-target="#双正态总体均值与方差的假设检验"><span class="header-section-number">4.2.3.4</span> 双正态总体均值与方差的假设检验</a></li>
  <li><a href="#总体比率的假设检验" id="toc-总体比率的假设检验" class="nav-link" data-scroll-target="#总体比率的假设检验"><span class="header-section-number">4.2.3.5</span> 总体比率的假设检验</a></li>
  <li><a href="#基于列联表资料的假设检验" id="toc-基于列联表资料的假设检验" class="nav-link" data-scroll-target="#基于列联表资料的假设检验"><span class="header-section-number">4.2.3.6</span> 基于列联表资料的假设检验</a></li>
  <li><a href="#分布函数的拟合优度检验" id="toc-分布函数的拟合优度检验" class="nav-link" data-scroll-target="#分布函数的拟合优度检验"><span class="header-section-number">4.2.3.7</span> 分布函数的拟合优度检验</a></li>
  <li><a href="#其他检验方法" id="toc-其他检验方法" class="nav-link" data-scroll-target="#其他检验方法"><span class="header-section-number">4.2.3.8</span> 其他检验方法</a></li>
  <li><a href="#方差分析" id="toc-方差分析" class="nav-link" data-scroll-target="#方差分析"><span class="header-section-number">4.2.3.9</span> 方差分析</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#相关分析与回归分析" id="toc-相关分析与回归分析" class="nav-link" data-scroll-target="#相关分析与回归分析"><span class="header-section-number">4.3</span> 相关分析与回归分析</a>
  <ul>
  <li><a href="#相关分析" id="toc-相关分析" class="nav-link" data-scroll-target="#相关分析"><span class="header-section-number">4.3.1</span> 相关分析</a>
  <ul>
  <li><a href="#双变量简单相关系数的计算与检验" id="toc-双变量简单相关系数的计算与检验" class="nav-link" data-scroll-target="#双变量简单相关系数的计算与检验"><span class="header-section-number">4.3.1.1</span> 双变量简单相关系数的计算与检验</a></li>
  <li><a href="#多变量偏相关系数的计算与检验" id="toc-多变量偏相关系数的计算与检验" class="nav-link" data-scroll-target="#多变量偏相关系数的计算与检验"><span class="header-section-number">4.3.1.2</span> 多变量偏相关系数的计算与检验</a></li>
  <li><a href="#多变量复相关系数的计算与检验" id="toc-多变量复相关系数的计算与检验" class="nav-link" data-scroll-target="#多变量复相关系数的计算与检验"><span class="header-section-number">4.3.1.3</span> 多变量复相关系数的计算与检验</a></li>
  </ul></li>
  <li><a href="#回归分析" id="toc-回归分析" class="nav-link" data-scroll-target="#回归分析"><span class="header-section-number">4.3.2</span> 回归分析</a>
  <ul>
  <li><a href="#线性回归" id="toc-线性回归" class="nav-link" data-scroll-target="#线性回归"><span class="header-section-number">4.3.2.1</span> 线性回归</a></li>
  <li><a href="#非线性回归" id="toc-非线性回归" class="nav-link" data-scroll-target="#非线性回归"><span class="header-section-number">4.3.2.2</span> 非线性回归</a></li>
  <li><a href="#线性回归模型诊断与改善方法" id="toc-线性回归模型诊断与改善方法" class="nav-link" data-scroll-target="#线性回归模型诊断与改善方法"><span class="header-section-number">4.3.2.3</span> 线性回归模型诊断与改善方法</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#主成分分析与因子分析" id="toc-主成分分析与因子分析" class="nav-link" data-scroll-target="#主成分分析与因子分析"><span class="header-section-number">4.4</span> 主成分分析与因子分析</a>
  <ul>
  <li><a href="#主成分分析" id="toc-主成分分析" class="nav-link" data-scroll-target="#主成分分析"><span class="header-section-number">4.4.1</span> 主成分分析</a></li>
  <li><a href="#因子分析" id="toc-因子分析" class="nav-link" data-scroll-target="#因子分析"><span class="header-section-number">4.4.2</span> 因子分析</a></li>
  </ul></li>
  <li><a href="#聚类分析和判别分析" id="toc-聚类分析和判别分析" class="nav-link" data-scroll-target="#聚类分析和判别分析"><span class="header-section-number">4.5</span> 聚类分析和判别分析</a>
  <ul>
  <li><a href="#聚类分析" id="toc-聚类分析" class="nav-link" data-scroll-target="#聚类分析"><span class="header-section-number">4.5.1</span> 聚类分析</a></li>
  <li><a href="#判别分析" id="toc-判别分析" class="nav-link" data-scroll-target="#判别分析"><span class="header-section-number">4.5.2</span> 判别分析</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./CH4.html">进阶知识</a></li><li class="breadcrumb-item"><a href="./CH4.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">环境数据统计分析</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">环境数据统计分析</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>数学分析是从公理体系出发，采用演绎法将普适规律应用于特殊领域(从一般到个别)，而统计分析是从实际观测数据出发，采用归纳法从特殊现象总结出普适规律(从个别到一般)。与数学分析方法一样，统计分析方法也是一种重要的科学研究方法，普遍应用于自然科学、社会科学、经济学等诸多领域。</p>
<p>尽管环境数据规模和维度越来越大，统计分析仍然是探索和分析此类大数据的有效手段，同时也是机器学习的基础。常用的数据统计分析方法包括描述性统计(descriptive statistics)、推断性统计(inferential statistics)、相关分析(correlation analysis)、回归分析(regression analysis)、主成分分析(principal component analysis，PCA)、因子分析(factor analysis，FA)、聚类分析(clustering analysis)等。</p>
<p>本章基于R语言介绍描述性统计分析、推断性统计分析、相关分析、回归分析、主成分分析、因子分析以及聚类分析。</p>
<section id="描述性统计" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="描述性统计"><span class="header-section-number">4.1</span> 描述性统计</h2>
<p>描述性统计分析是以一种简单而有意义的方式来描述、显示和概括原始数据，亦可称之为探索性数据分析(Exploratory Data Analysis，EDA)，主要包括频数分析、集中趋势分析、离散程度分析、数据分布特征以及一些基本的统计图表。</p>
<section id="频数分析" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="频数分析"><span class="header-section-number">4.1.1</span> 频数分析</h3>
<p>频数分析是按某个分类变量分组或按某个数值变量分区间对数据进行频数统计，以了解数据在这些有意义的组或区间上的具体分布。在频数的基础上，可以进一步计算频率、累积频率等指标。直方图是最常用的频数分析的可视化方式。R提供的<code>table()</code>函数可对数据集中某个分类变量进行频数统计(结果为频数分布表，也称为一维列联表)，<code>xtabs()</code>函数根据两个分类变量创建交叉频数统计(结果为二维列联表)，<code>prop.table()</code>函数在频数统计的结果上计算频率，<code>addmargins()</code>函数为频数或频率统计结果计算行列之和。在R Markdown和Quarto文档中，可利用knitr包中的<code>kable()</code>函数美化频数统计表的输出。</p>
<div id="exm-4.1" class="theorem example">
<p><span class="theorem-title"><strong>例 4.1</strong></span> 下面是一个对河流水质数据进行的频数分析。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#随机构造数据：rn为河流名称，wq为水质等级，wt为河流类型</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">rn =</span> <span class="fu">paste</span>(<span class="st">"河流"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>),</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">wq =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"I类"</span>,<span class="st">"II类"</span>,<span class="st">"III类"</span>,<span class="st">"IV类"</span>,<span class="st">"V类"</span>,<span class="st">"劣V类"</span>),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>              <span class="dv">50</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">wt =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"小型河流"</span>,<span class="st">"中型河流"</span>,<span class="st">"大型河流"</span>),</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>              <span class="dv">50</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wq =</span> <span class="fu">factor</span>(wq,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"I类"</span>,<span class="st">"II类"</span>,<span class="st">"III类"</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"IV类"</span>,<span class="st">"V类"</span>,<span class="st">"劣V类"</span>),</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ordered =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">wt =</span> <span class="fu">factor</span>(wt,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"小型河流"</span>,<span class="st">"中型河流"</span>,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"大型河流"</span>),</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ordered =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 3
   rn      wq    wt      
   &lt;chr&gt;   &lt;ord&gt; &lt;ord&gt;   
 1 河流 1  IV类  大型河流
 2 河流 2  III类 中型河流
 3 河流 3  劣V类 小型河流
 4 河流 4  III类 大型河流
 5 河流 5  IV类  中型河流
 6 河流 6  劣V类 中型河流
 7 河流 7  劣V类 大型河流
 8 河流 8  IV类  大型河流
 9 河流 9  III类 大型河流
10 河流 10 I类   小型河流
# ℹ 40 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> data<span class="sc">$</span>wq <span class="sc">%&gt;%</span> <span class="fu">table</span>() </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>t1 <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">.</th>
<th style="text-align: right;">Freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">I类</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">II类</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">III类</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">IV类</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">V类</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">劣V类</td>
<td style="text-align: right;">9</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>t2 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">xtabs</span>(<span class="sc">~</span> wq <span class="sc">+</span> wt, .)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>t2 <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">小型河流</th>
<th style="text-align: right;">中型河流</th>
<th style="text-align: right;">大型河流</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">I类</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">II类</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">III类</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">IV类</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">V类</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">劣V类</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>t2 <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addmargins</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">小型河流</th>
<th style="text-align: right;">中型河流</th>
<th style="text-align: right;">大型河流</th>
<th style="text-align: right;">Sum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">I类</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">II类</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">III类</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">IV类</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">V类</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">劣V类</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sum</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">50</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>t2 <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prop.table</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addmargins</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">小型河流</th>
<th style="text-align: right;">中型河流</th>
<th style="text-align: right;">大型河流</th>
<th style="text-align: right;">Sum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">I类</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.14</td>
</tr>
<tr class="even">
<td style="text-align: left;">II类</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">III类</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.20</td>
</tr>
<tr class="even">
<td style="text-align: left;">IV类</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.20</td>
</tr>
<tr class="odd">
<td style="text-align: left;">V类</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.14</td>
</tr>
<tr class="even">
<td style="text-align: left;">劣V类</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.18</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sum</td>
<td style="text-align: right;">0.30</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.38</td>
<td style="text-align: right;">1.00</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><code>cumsum()</code>函数用于计算累积频数或频率：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> t1 <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prop.table</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CumFreq =</span> <span class="fu">cumsum</span>(Freq))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      . Freq CumFreq
1   I类 0.14    0.14
2  II类 0.14    0.28
3 III类 0.20    0.48
4  IV类 0.20    0.68
5   V类 0.14    0.82
6 劣V类 0.18    1.00</code></pre>
</div>
</div>
<p>频数分布表可以用<code>as.data.frmae()</code>函数转换为数据框类型。</p>
<p>对数值变量做分组频数统计，需要先确定分组区间界值及相应的标签，再用<code>cut()</code>函数根据区间界值对数据分组，然后用<code>table()</code>和<code>prop.table()</code>函数进行频数和频率统计。</p>
<div id="exm-4.2" class="theorem example">
<p><span class="theorem-title"><strong>例 4.2</strong></span> 现有某市2014年冬季(2014年12月-2015年2月)的每日AQI指数，共90个数据(如下表所示)，对其做频数分析。</p>
</div>
<table class="table">
<colgroup>
<col style="width: 5%">
<col style="width: 94%">
</colgroup>
<thead>
<tr class="header">
<th>月份</th>
<th style="text-align: left;">AQI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>12月</td>
<td style="text-align: left;">86 62 75 71 78 107 130 137 86 119 134 81 76 92 132 70 55 79 79 108 78 71 99 150 117 65 95 105 103 94 73</td>
</tr>
<tr class="even">
<td>1月</td>
<td style="text-align: left;">64 79 94 310 194 185 91 98 99 165 142 97 76 72 86 183 161 127 98 99 199 141 154 185 257 264 118 53 56 142 135</td>
</tr>
<tr class="odd">
<td>2月</td>
<td style="text-align: left;">67 99 147 217 121 80 103 72 62 70 95 120 240 164 74 196 212 139 77 42 55 130 132 96 70 144 54 29</td>
</tr>
</tbody>
</table>
<p>根据《环境空气质量评价技术规范(试行)》(HJ 663—2013)的规定，AQI(空气质量指数)分级如下：0~50为优(一级)，51~100为良(二级)，101~150为轻度污染(三级)，151~200为中度污染(四级)，201~300为重度污染(五级)，&gt;300为严重污染(六级)。 先通过电子表格软件如WPS表格或Office Excel，输入数据，第一列列名为Month，第二列列名为Day，第三列列名为AQI，最后命名保存为aqi-data.csv数据文件。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"./data/aqi-data.csv"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"优"</span>, <span class="st">"良"</span>, <span class="st">"轻度污染"</span>, <span class="st">"中度污染"</span>, <span class="st">"重度污染"</span>, <span class="st">"严重污染"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">51</span>, <span class="dv">101</span>, <span class="dv">151</span>, <span class="dv">201</span>, <span class="dv">301</span>, <span class="cn">Inf</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>aqi <span class="ot">&lt;-</span> <span class="fu">cut</span>(df<span class="sc">$</span>AQI, <span class="at">breaks =</span> breaks, <span class="at">labels =</span> labels,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># include.lowest参数为TRUE时表示区间包含界值下限，为FALSE时表示包含界值上限</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>ft <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(<span class="at">Group =</span> aqi))</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>dft <span class="ot">&lt;-</span> ft <span class="sc">%&gt;%</span> </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CumFreq =</span> <span class="fu">cumsum</span>(Freq),</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">FreqRate =</span> <span class="fu">prop.table</span>(Freq)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CumFreqRate =</span> <span class="fu">cumsum</span>(FreqRate)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">FreqRate =</span> <span class="fu">round</span>(FreqRate <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">CumFreqRate =</span> <span class="fu">round</span>(CumFreqRate <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>))</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>dft</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Group Freq CumFreq FreqRate CumFreqRate
1       优    2       2     2.22        2.22
2       良   47      49    52.22       54.44
3 轻度污染   25      74    27.78       82.22
4 中度污染   10      84    11.11       93.33
5 重度污染    5      89     5.56       98.89
6 严重污染    1      90     1.11      100.00</code></pre>
</div>
</div>
<p>由以上频数分析结果可见，该城市冬季AQI为“优”和“良”的累积比例超过54%。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>dft<span class="sc">$</span>Group <span class="ot">&lt;-</span> <span class="fu">ordered</span>(dft<span class="sc">$</span>Group,                     </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"优"</span>,<span class="st">"良"</span>,<span class="st">"轻度污染"</span>,<span class="st">"中度污染"</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"重度污染"</span>,<span class="st">"严重污"</span>))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dft, <span class="fu">aes</span>(<span class="at">x =</span> Group, <span class="at">y =</span> Freq)) <span class="sc">+</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span>   </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Freq), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>) <span class="sc">+</span>  </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">55</span>)) <span class="sc">+</span>   </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"空气质量等级"</span>, <span class="at">y =</span> <span class="st">"累计天数"</span>) <span class="sc">+</span>  </span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-4.0" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.0-1.png" class="img-fluid figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.0-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.1: 频数分布条形图
</figcaption>
</figure>
</div>
</div>
</div>
<p>在除尘系统设计中，也需要对颗粒物粒径进行类似的频数统计，从而更好地了解尘粒的粒径分布以计算分级除尘效率。</p>
</section>
<section id="集中趋势" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="集中趋势"><span class="header-section-number">4.1.2</span> 集中趋势</h3>
<p>集中趋势反映一组变量值的集中位置，用于描述数据的一般水平。集中趋势用平均数表示，包括算术平均数、几何平均数、调和平均数、中位数、百分位数和众数，前三者为数值平均数，后三者为位置平均数。数值平均数综合了所有数据，受极值影响较大，且不适用于定类和定序数据；位置平均数不受极值的影响，适用于定序数据。要注意，众数不具有唯一性，有时无法计算得到，只有对大量数据计算众数才有意义。</p>
<p>计算数值平均数的方法：</p>
<ul>
<li>计算算术平均数: <code>mean()</code>。<br>
</li>
<li>计算加权算术平均数: <code>weighted.mean()</code>。<br>
</li>
<li>计算几何平均数: <code>psych::geometric.mean()</code>，或<code>pracma::geomean()</code>，或<code>exp(mean(log(x)))</code>。几何平均数受极值的影响较算术平均数小，适用于等比或近似等比关系的数据，计算时要注意负数的影响。<br>
</li>
<li>计算调和平均数(倒数的算术平均数的倒数)：<code>psych::harmonic.mean()</code>，或<code>pracma::harmmean()</code>。调和平均数实际应用范围较小，一般用于因缺乏总体单位数而不能直接计算算术平均数的场合，计算时要注意0值的影响。</li>
</ul>
<p>对于同一组数据，调和平均数≤几何平均数≤算术平均数。</p>
<p>计算位置平均数的方法：</p>
<ul>
<li>中位数: <code>median()</code>。中位数是数据排序后居于中间位置的数值，不受两端极值影响，在非正态分布数据中较算术平均数更有代表性。<br>
</li>
<li>百分位数: <code>quantile()</code>。百分位数是中位数的扩展，有些数据需要了解其1%、5%、10%、25%、75%、90%、95%、99%、99.99%等位置上的数值，如环境毒理学研究、除尘技术研发等；其中居于25%和75%位置上的数据分别称为下四分位数(Q1)和上四分位数(Q3)。<br>
</li>
<li>众数: 众数是数据集中出现频次最高的数值。计算众数首先要排除无法计算的情况(如所有数值出现的频数相等)，然后先计算频数：<code>tbl = as.data.frame(table(x))</code>，再找出最大频数：<code>max_freq = max(tbl[ , 2])</code>，最后找出最大频数对应的数值：<code>mode = tbl[tbl[ , 2] == max_freq, 1]</code></li>
</ul>
<p>通过算术平均数、中位数以及众数的关系可以判断数据的大致分布类型(如 <a href="#fig-4.1" class="quarto-xref">图&nbsp;<span>4.2</span></a> 所示)：对于理想的对称分布，算术平均数 = 中位数 = 众数；在右偏分布的资料中，算术平均数＞中位数＞众数；在左偏分布的资料中，算术平均数＜中位数＜众数。</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-4.1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/fig4.1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.2: 通过算术平均数、中位数和众数的关系判断数据分布类型
</figcaption>
</figure>
</div>
</div>
</div>
<div id="exm-4.3" class="theorem example">
<p><span class="theorem-title"><strong>例 4.3</strong></span> 计算数值平均数。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 算术平均数</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算废水中铬浓度10次测定结果的算术平均数</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>cr_conc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.92</span>, <span class="fl">0.83</span>, <span class="fl">0.82</span>, <span class="fl">0.91</span>, <span class="fl">1.06</span>, <span class="fl">0.88</span>, <span class="fl">1.07</span>, <span class="fl">0.84</span>, <span class="fl">1.01</span>, <span class="fl">0.96</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(cr_conc)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.93</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 分组频数资料加权计算算术平均数</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>so2_conc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.44</span>, <span class="fl">0.48</span>, <span class="fl">0.52</span>, <span class="fl">0.56</span>, <span class="fl">0.60</span>)    <span class="co"># 二氧化硫分组组中值</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">3</span>, <span class="dv">5</span>)    <span class="co"># 对应频数</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>wm <span class="ot">&lt;-</span> <span class="fu">weighted.mean</span>(so2_conc, f)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(wm, <span class="dv">2</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.52</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 几何平均数</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 8个样本中某污物染浓度测定值(近似等比资料)</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>p_conc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">80</span>, <span class="dv">160</span>, <span class="dv">326</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 利用对数法计算</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>logpc <span class="ot">&lt;-</span> <span class="fu">log10</span>(p_conc)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(p_conc)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>gm <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">^</span>(<span class="fu">sum</span>(logpc) <span class="sc">/</span> n)    <span class="co"># 对数法</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(gm, <span class="dv">2</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 40.09</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 利用psych包计算</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(psych<span class="sc">::</span><span class="fu">geometric.mean</span>(p_conc), <span class="dv">2</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 40.09</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 调和平均数</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 4个化工园区废水处理量和处理率，求平均处理率</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>wv  <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">30000</span>, <span class="dv">50000</span>, <span class="dv">25000</span>, <span class="dv">18000</span>)    <span class="co"># 废水处理量</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>pt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">65</span>, <span class="dv">75</span>, <span class="dv">95</span>, <span class="dv">55</span>)    <span class="co"># 废水处理率</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>hm <span class="ot">&lt;-</span> <span class="fu">sum</span>(wv) <span class="sc">/</span> <span class="fu">sum</span>(wv <span class="sc">/</span> (pt <span class="sc">/</span> <span class="dv">100</span>))</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(hm <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 71.57</code></pre>
</div>
</div>
<div id="exm-4.4" class="theorem example">
<p><span class="theorem-title"><strong>例 4.4</strong></span> 计算位置平均数。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 中位数</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 10个废水BOD浓度测定值</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>bod <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="fl">53.5</span>, <span class="dv">51</span>, <span class="fl">53.5</span>, <span class="dv">52</span>, <span class="dv">55</span>, <span class="dv">58</span>, <span class="dv">53</span>, <span class="dv">56</span>, <span class="fl">53.5</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(bod)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 53.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算1%、5%、95% 99%分位数</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 随机生成颗粒物粒径数据(利用对数正态分布函数)</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>p_size <span class="ot">&lt;-</span> <span class="fu">rlnorm</span>(<span class="dv">1000</span>, <span class="at">meanlog =</span> <span class="dv">3</span>, <span class="at">sdlog =</span> <span class="dv">1</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>qp <span class="ot">&lt;-</span> <span class="fu">quantile</span>(p_size, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.95</span>, <span class="fl">0.99</span>))</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(qp, <span class="dv">2</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    1%     5%    95%    99% 
  2.16   4.23  99.19 232.50 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算众数</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>bod <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="fl">53.5</span>, <span class="dv">51</span>, <span class="fl">53.5</span>, <span class="dv">52</span>, <span class="dv">55</span>, <span class="dv">58</span>, <span class="dv">53</span>, <span class="dv">56</span>, <span class="fl">53.5</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>tbl <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">table</span>(bod))    <span class="co"># 统计频数并转换成数据框类型</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>max_freq <span class="ot">&lt;-</span> <span class="fu">max</span>(tbl[ , <span class="dv">2</span>])    <span class="co"># 找到最大的频数</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>tbl[tbl[ , <span class="dv">2</span>] <span class="sc">==</span> max_freq, <span class="dv">1</span>]    <span class="co"># 频数最大的数值即众数</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 53.5
Levels: 50 51 52 53 53.5 55 56 58</code></pre>
</div>
</div>
<p>计算总和可用<code>sum()</code>函数，对于矩阵还可用<code>rowSums()</code>、<code>colSums()</code>、<code>rowMeans()</code>和<code>colMeans()</code>分别求其行和列的和与算术平均数，也可利用<code>apply()</code>函数与<code>sum()</code>或<code>mean()</code>结合来计算行与列的和或算术平均数。</p>
<div id="exm-4.5" class="theorem example">
<p><span class="theorem-title"><strong>例 4.5</strong></span> 计算矩阵行列总和与平均数。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>, <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>mat</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5] [,6]
[1,]    1    2    3    4    5    6
[2,]    7    8    9   10   11   12
[3,]   13   14   15   16   17   18
[4,]   19   20   21   22   23   24</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rowSums</span>(mat)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  21  57  93 129</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(mat)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 40 44 48 52 56 60</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rowMeans</span>(mat)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  3.5  9.5 15.5 21.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colMeans</span>(mat)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10 11 12 13 14 15</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(mat, <span class="dv">1</span>, sum)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  21  57  93 129</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(mat, <span class="dv">2</span>, sum)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 40 44 48 52 56 60</code></pre>
</div>
</div>
</section>
<section id="离散程度" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="离散程度"><span class="header-section-number">4.1.3</span> 离散程度</h3>
<p>离散程度反映数据偏离中心位置的程度，用于描述数据的变异大小。离散程度用变异数表征，变异指标包括极差(亦称全距，range)、四分位间距(interquartile range，IQR)、标准差(standard deviation，SD)、方差(variance，VAR)、标准误(standard error，SE)以及变异系数(coefficient of variation，CV)，其中方差和标准差最为常用。</p>
<ul>
<li>极差: <code>max(x) – min(x)</code>，即为数据中最大值与最小值之差。仅使用了数据中两个极端观测值，稳定性差。<br>
</li>
<li>四分位间距: <code>IQR(x)</code>，即上、下四分位数之差。与极差相比，IQR不受极值影响，具有较好的稳定性，但仍然只使用了数据集中2个观测值。<br>
</li>
<li>方差: 总体方差用<code>sum((x - mean(x))^2) / length(x)</code>计算，样本方差用<code>var(x)</code>计算。方差综合考虑了数据中所有观测值的变异，是更有代表性也被经常使用的离散程度指标。<br>
</li>
<li>标准差: 由于方差的量纲与原数据不同，故引入标准差，即方差的平方根。总体标准差用<code>sqrt()</code>计算总体方差的平方根，样本标准差直接用<code>sd()</code>计算。<br>
</li>
<li>标准误: <code>sd(x) / sqrt(length(x))</code>，即样本均值的标准误差，用于衡量样本均值和总体均值的偏差大小。<br>
</li>
<li>变异系数: 相对变异指标，消除了量纲和平均数差异的影响，便于比较不同组数据之间的离散程度。常用的变异系数为标准差变异系数，计算方法为<code>sd(x) / abs(mean(x)) * 100</code>，或直接使用<code>raster::cv()</code>函数。</li>
</ul>
<div id="exm-4.6" class="theorem example">
<p><span class="theorem-title"><strong>例 4.6</strong></span> 计算各种变异指标。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 读入aqi数据</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"./data/aqi-data.csv"</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> df<span class="sc">$</span>AQI</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算极差</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(x) <span class="sc">-</span> <span class="fu">min</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 281</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算四分位间距</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">IQR</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 62.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算样本方差</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2821.243</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算样本标准差</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 53.11537</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算标准误</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(x) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(x))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.598852</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算变异系数</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>raster<span class="sc">::</span><span class="fu">cv</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 46.69255</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(x) <span class="sc">/</span> <span class="fu">abs</span>(<span class="fu">mean</span>(x)) <span class="sc">*</span> <span class="dv">100</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 46.69255</code></pre>
</div>
</div>
</section>
<section id="数据分布特征" class="level3" data-number="4.1.4">
<h3 data-number="4.1.4" class="anchored" data-anchor-id="数据分布特征"><span class="header-section-number">4.1.4</span> 数据分布特征</h3>
<p>环境数据的统计分析，通常需要对样本的分布做出假设，绝大多数的统计分析方法要求样本分布(近似)为正态分布。样本的分布特征可以用偏度(skewness)和峰度(kurtosis)来描述。</p>
<p>偏度用于描述数据分布偏斜方向和程度，如果是对称分布(如 <a href="#fig-4.1" class="quarto-xref">图&nbsp;<span>4.2</span></a> 中图所示)，则偏度为0；如果是左偏分布(亦称负偏态，分布高峰偏右，如 <a href="#fig-4.1" class="quarto-xref">图&nbsp;<span>4.2</span></a> 左图所示)，偏度为负值；如果是右偏分布(亦称正偏态，分布高峰偏左，如 <a href="#fig-4.1" class="quarto-xref">图&nbsp;<span>4.2</span></a> 右图所示)，偏度为正值。</p>
<p>峰度用于表征概率密度曲线在平均值处的峰值高低，也反映了尾部的厚度。当数据分布接近正态分布时，峰度接近于0；当数据分布两侧的极端数据更多时，峰度为负值；当数据分布两侧的极端数据更少时，峰度为正值。</p>
<p>有很多R包提供了计算偏度和峰度的函数，此处介绍e1071包中偏度和峰度的计算函数<code>skewness()</code>和<code>kurtosis()</code>。e1071包中偏度和峰度的计算均有三个不同的公式，在函数中以type参数指定，参数值为1、2和3，默认type=3。在资料为正态分布时，这三个公式计算的偏度都是无偏估计值，而峰度只有第二个公式的计算结果为无偏估计值。psych包中计算偏度和峰度函数为<code>skew()</code>和<code>kurtosi()</code>，与e1071包的计算方法一致。</p>
<div id="exm-4.7" class="theorem example">
<p><span class="theorem-title"><strong>例 4.7</strong></span> 计算偏度和峰度。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"./data/aqi-data.csv"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> df<span class="sc">$</span>AQI</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>e1071<span class="sc">::</span><span class="fu">skewness</span>(x, <span class="at">type =</span> <span class="dv">1</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.312296</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>e1071<span class="sc">::</span><span class="fu">skewness</span>(x, <span class="at">type =</span> <span class="dv">2</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.334644</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>e1071<span class="sc">::</span><span class="fu">skewness</span>(x, <span class="at">type =</span> <span class="dv">3</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.290485</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>e1071<span class="sc">::</span><span class="fu">kurtosis</span>(x, <span class="at">type =</span> <span class="dv">1</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.765053</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>e1071<span class="sc">::</span><span class="fu">kurtosis</span>(x, <span class="at">type =</span> <span class="dv">2</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.936933</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>e1071<span class="sc">::</span><span class="fu">kurtosis</span>(x, <span class="at">type =</span> <span class="dv">3</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.659751</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 生成1000个正态数据(样本均值为0，标准差为1)</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">skewness</span>(y)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.07010706</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kurtosis</span>(y)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.08095659</code></pre>
</div>
</div>
<p>从 <a href="#exm-4.7" class="quarto-xref">例&nbsp;<span>4.7</span></a> 的计算结果可以发现，标准正态分布数据的偏度和峰度均接近于0。</p>
<p>Q-Q图(x轴为理论分位数，y轴为样本数据分位数；符合正态分布时，二者应呈直线关系)和经验分布函数图(比较样本经验分布和理论分布曲线的重合程度)可用来直观地判断数据分布是否符合或近似正态分布。R中<code>qqnorm()</code>和<code>qqline()</code>函数分别用于绘制Q-Q图及其相应直线，<code>ecdf()</code>函数用于计算样本数据的经验分布，再通过<code>plot()</code>绘制出图形，与理论分布函数曲线(<code>pnorm()</code>函数计算理论概率并用<code>lines()</code>函数绘制曲线)进行比较。</p>
<div id="exm-4.8" class="theorem example">
<p><span class="theorem-title"><strong>例 4.8</strong></span> 绘制 <a href="#exm-4.7" class="quarto-xref">例&nbsp;<span>4.7</span></a> 中x和y的Q-Q图(结果如 <a href="#fig-4.2" class="quarto-xref">图&nbsp;<span>4.3</span></a> 所示)。</p>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 偏态数据</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"./data/aqi-data.csv"</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> df<span class="sc">$</span>AQI</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(x)</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(x, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 正态数据</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(y)</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(y, <span class="at">col =</span> <span class="st">"red"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-4.2" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-4.2" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-4.2-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-4.2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.2-1.png" class="img-fluid figure-img" data-ref-parent="fig-4.2" width="384">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-4.2-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) 偏态数据的Q-Q图
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-4.2" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-4.2-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-4.2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.2-2.png" class="img-fluid figure-img" data-ref-parent="fig-4.2" width="384">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-4.2-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) 正态数据的Q-Q图
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.3: Q-Q图
</figcaption>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">sample =</span> AQI)) <span class="sc">+</span> </span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>(<span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>(<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="CH4_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>dfn <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">val =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfn, <span class="fu">aes</span>(<span class="at">sample =</span> val)) <span class="sc">+</span> </span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>(<span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>(<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="CH4_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
</div>
<p>由 <a href="#fig-4.2" class="quarto-xref">图&nbsp;<span>4.3</span></a> 可见，AQI数据的分位数与正态分布的理论分位数在两端的差异非常明显，表明其分布不符合正态分布；而构造的标准正态数据的样本分位数与理论分位数呈明显的直线关系，表明其符合正态分布。</p>
<div id="exm-4.9" class="theorem example">
<p><span class="theorem-title"><strong>例 4.9</strong></span> 绘制经验累积分布函数曲线图与理论累积分布函数曲线(结果如 <a href="#fig-4.3" class="quarto-xref">图&nbsp;<span>4.4</span></a> 所示，其中红色平滑曲线为理论累积分布密度函数曲线，蓝色为经验累积分布密度函数曲线，即数据实际的累积分布密度)。</p>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 偏态数据</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"./data/aqi-data.csv"</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> df<span class="sc">$</span>AQI</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ecdf</span>(x), <span class="at">verticals =</span> <span class="cn">TRUE</span>, <span class="at">do.p =</span> <span class="cn">FALSE</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">min</span>(x)<span class="sc">:</span><span class="fu">max</span>(x))</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(m, <span class="fu">pnorm</span>(m, <span class="fu">mean</span>(x), <span class="fu">sd</span>(x)), <span class="at">col =</span> <span class="st">"red"</span>)    <span class="co"># 理论分布</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 正态数据</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">20</span>, <span class="dv">5</span>))</span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ecdf</span>(y), <span class="at">verticals =</span> <span class="cn">TRUE</span>, <span class="at">do.p =</span> <span class="cn">FALSE</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">min</span>(y)<span class="sc">:</span><span class="fu">max</span>(y))</span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(m, <span class="fu">pnorm</span>(m, <span class="fu">mean</span>(y), <span class="fu">sd</span>(y)), <span class="at">col =</span> <span class="st">"red"</span>)    <span class="co"># 理论分布</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-4.3" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-4.3" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-4.3-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-4.3-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.3-1.png" class="img-fluid figure-img" style="width:70.0%" data-ref-parent="fig-4.3">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-4.3-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) 偏态数据
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-4.3" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-4.3-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-4.3-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.3-2.png" class="img-fluid figure-img" style="width:70.0%" data-ref-parent="fig-4.3">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-4.3-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) 正态数据
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.4: 经验累积分布函数曲线
</figcaption>
</figure>
</div>
<p>由 <a href="#fig-4.3-2" class="quarto-xref">图&nbsp;<span>4.4 (b)</span></a> 可见，根据正态分布生成的数据的样本经验分布函数与理论分布函数的曲线基本重合。</p>
</section>
<section id="数据摘要" class="level3" data-number="4.1.5">
<h3 data-number="4.1.5" class="anchored" data-anchor-id="数据摘要"><span class="header-section-number">4.1.5</span> 数据摘要</h3>
<p>R中<code>summary()</code>函数可以提供数据的基本摘要信息，对数值变量，可显示其最小值、最大值、算术平均数、中位数、Q1和Q3以及缺失数。与之相比，psych包提供的<code>describe()</code>函数提供的摘要信息更为全面，对数值变量，除了<code>summary()</code>函数提供的信息外，还包括截断均值、标准差、标准误、极差、四分位间距、绝对中位数偏差、偏度和峰度等信息。skimr包提供的<code>skim()</code>函数强化了对缺失数据的分析，并对数值变量给出频数分布直方图。</p>
<div id="exm-4.10" class="theorem example">
<p><span class="theorem-title"><strong>例 4.10</strong></span> 比较<code>summary()</code>、<code>describe()</code>和<code>skim()</code>三个数据摘要函数的差异。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(airquality)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Ozone           Solar.R           Wind             Temp      
 Min.   :  1.00   Min.   :  7.0   Min.   : 1.700   Min.   :56.00  
 1st Qu.: 18.00   1st Qu.:115.8   1st Qu.: 7.400   1st Qu.:72.00  
 Median : 31.50   Median :205.0   Median : 9.700   Median :79.00  
 Mean   : 42.13   Mean   :185.9   Mean   : 9.958   Mean   :77.88  
 3rd Qu.: 63.25   3rd Qu.:258.8   3rd Qu.:11.500   3rd Qu.:85.00  
 Max.   :168.00   Max.   :334.0   Max.   :20.700   Max.   :97.00  
 NA's   :37       NA's   :7                                       
     Month            Day      
 Min.   :5.000   Min.   : 1.0  
 1st Qu.:6.000   1st Qu.: 8.0  
 Median :7.000   Median :16.0  
 Mean   :6.993   Mean   :15.8  
 3rd Qu.:8.000   3rd Qu.:23.0  
 Max.   :9.000   Max.   :31.0  
                               </code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(airquality, <span class="at">IQR =</span> <span class="cn">TRUE</span>, <span class="at">quant =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        vars   n   mean    sd median trimmed   mad  min   max range  skew
Ozone      1 116  42.13 32.99   31.5   37.80 25.95  1.0 168.0   167  1.21
Solar.R    2 146 185.93 90.06  205.0  190.34 98.59  7.0 334.0   327 -0.42
Wind       3 153   9.96  3.52    9.7    9.87  3.41  1.7  20.7    19  0.34
Temp       4 153  77.88  9.47   79.0   78.28  8.90 56.0  97.0    41 -0.37
Month      5 153   6.99  1.42    7.0    6.99  1.48  5.0   9.0     4  0.00
Day        6 153  15.80  8.86   16.0   15.80 11.86  1.0  31.0    30  0.00
        kurtosis   se    IQR  Q0.25  Q0.75
Ozone       1.11 3.06  45.25  18.00  63.25
Solar.R    -1.00 7.45 143.00 115.75 258.75
Wind        0.03 0.28   4.10   7.40  11.50
Temp       -0.46 0.77  13.00  72.00  85.00
Month      -1.32 0.11   2.00   6.00   8.00
Day        -1.22 0.72  15.00   8.00  23.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(airquality)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">airquality</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">153</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 15%">
<col style="width: 11%">
<col style="width: 15%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Ozone</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">0.76</td>
<td style="text-align: right;">42.13</td>
<td style="text-align: right;">32.99</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">18.00</td>
<td style="text-align: right;">31.5</td>
<td style="text-align: right;">63.25</td>
<td style="text-align: right;">168.0</td>
<td style="text-align: left;">▇▃▂▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">Solar.R</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.95</td>
<td style="text-align: right;">185.93</td>
<td style="text-align: right;">90.06</td>
<td style="text-align: right;">7.0</td>
<td style="text-align: right;">115.75</td>
<td style="text-align: right;">205.0</td>
<td style="text-align: right;">258.75</td>
<td style="text-align: right;">334.0</td>
<td style="text-align: left;">▅▃▅▇▅</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Wind</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">9.96</td>
<td style="text-align: right;">3.52</td>
<td style="text-align: right;">1.7</td>
<td style="text-align: right;">7.40</td>
<td style="text-align: right;">9.7</td>
<td style="text-align: right;">11.50</td>
<td style="text-align: right;">20.7</td>
<td style="text-align: left;">▂▇▇▃▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">Temp</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">77.88</td>
<td style="text-align: right;">9.47</td>
<td style="text-align: right;">56.0</td>
<td style="text-align: right;">72.00</td>
<td style="text-align: right;">79.0</td>
<td style="text-align: right;">85.00</td>
<td style="text-align: right;">97.0</td>
<td style="text-align: left;">▂▃▇▇▃</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Month</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">6.99</td>
<td style="text-align: right;">1.42</td>
<td style="text-align: right;">5.0</td>
<td style="text-align: right;">6.00</td>
<td style="text-align: right;">7.0</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: right;">9.0</td>
<td style="text-align: left;">▇▇▇▇▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">Day</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">15.80</td>
<td style="text-align: right;">8.86</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: right;">16.0</td>
<td style="text-align: right;">23.00</td>
<td style="text-align: right;">31.0</td>
<td style="text-align: left;">▇▇▇▇▆</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>显然，<code>describe()</code>的摘要信息比<code>summary()</code>更全面，而<code>skim()</code>突出了缺失数据的摘要信息，并提供了简易的变量分布直方图。</p>
<div id="exr-4.1" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 4.1</strong></span> <br>
(1)用<code>rlnorm()</code>函数生成1000个数据点，用ggplot2绘制频数分布直方图(<code>geom_histogram()</code>)，并叠加密度曲线(<code>geom_density()</code>)。<br>
(2)参考 <a href="#exm-4.2" class="quarto-xref">例&nbsp;<span>4.2</span></a> ，将上述数据合理划分为10个组，计算出如 <a href="#exm-4.2" class="quarto-xref">例&nbsp;<span>4.2</span></a> 的频数分布表。<br>
(3)基于上述数据计算各种集中趋势指标和离散趋势指标以及峰度和偏度。<br>
(4)参考 <a href="#exm-4.10" class="quarto-xref">例&nbsp;<span>4.10</span></a> ，对上述数据进行数据摘要。</p>
</div>
</section>
</section>
<section id="推断性统计" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="推断性统计"><span class="header-section-number">4.2</span> 推断性统计</h2>
<p>在现实中，收集总体中所有个体信息的成本往往过高甚至无法实现，大多数时候都是采用无偏和随机的科学抽样方法来获取总体的一个子集(样本数据)。推断性统计(亦称抽样推断)则是从样本数据推断总体特征的方法，主要包括参数估计、假设检验和方差分析(ANOVA)等。</p>
<p>推断性统计由于随机抽样必然导致抽样误差，利用抽样误差的分布规律就可以保障推断性统计结果的可靠性。影响抽样误差的因素包括：样本容量大小、总体变异大小以及抽样组织形式。其他条件相同的情况下，样本容量越大，抽样误差越小；总体变异越大，抽样误差越大；回置抽样比不回置抽样的抽样误差更大。</p>
<section id="随机抽样方法" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="随机抽样方法"><span class="header-section-number">4.2.1</span> 随机抽样方法</h3>
<section id="简单随机抽样" class="level4" data-number="4.2.1.1">
<h4 data-number="4.2.1.1" class="anchored" data-anchor-id="简单随机抽样"><span class="header-section-number">4.2.1.1</span> 简单随机抽样</h4>
<p>简单随机抽样是指对全部个体不做任何分组，从中完全随机地抽取个体组成样本的抽样技术，一般应用于小规模总体。R中<code>sample()</code>函数可以执行回置和不回置的简单随机抽样。sampling是一个更专业的实现各种随机抽样方法的R包，其中<code>srswor()</code>和<code>srswr()</code>函数分别用于执行不回置和回置简单随机抽样。</p>
<div id="exm-4.11" class="theorem example">
<p><span class="theorem-title"><strong>例 4.11</strong></span> 简单随机抽样示例。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="at">y =</span> <span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">6</span>, <span class="at">by =</span> <span class="fl">0.5</span>))  <span class="co"># 构造的待抽样总体</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">6</span>    <span class="co"># 抽取样本容量</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>s1 <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df), n, <span class="at">replace =</span> <span class="cn">FALSE</span>)  <span class="co"># 不回置抽样</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">=</span> df[s1, ]    <span class="co"># 根据抽取的行号获取数据</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>df1</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  x   y
4 4 3.5
3 3 3.0
6 6 4.5
8 8 5.5
9 9 6.0
2 2 2.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>s2 <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df), n, <span class="at">replace =</span> <span class="cn">TRUE</span>)  <span class="co"># 回置抽样 </span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">=</span> df[s2, ]    <span class="co"># 根据抽取的行号获取数据</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>df2</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    x   y
4   4 3.5
3   3 3.0
7   7 5.0
4.1 4 3.5
6   6 4.5
9   9 6.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>s3 <span class="ot">=</span> <span class="fu">srswor</span>(n, <span class="fu">nrow</span>(df))  <span class="co"># 不回置抽样</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">=</span> <span class="fu">getdata</span>(df, s3)  <span class="co"># 根据抽取的行号获取数据</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>df3</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ID_unit x   y
2       2 2 2.5
3       3 3 3.0
4       4 4 3.5
6       6 6 4.5
8       8 8 5.5
9       9 9 6.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>s4 <span class="ot">=</span> <span class="fu">srswr</span>(n, <span class="fu">nrow</span>(df))  <span class="co"># 回置抽样</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">=</span> <span class="fu">getdata</span>(df, s4)  <span class="co"># 根据抽取的行号获取抽样数据</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>df4</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    x   y
1   1 2.0
2   2 2.5
4   4 3.5
6   6 4.5
9   9 6.0
9.1 9 6.0</code></pre>
</div>
</div>
</section>
<section id="系统抽样" class="level4" data-number="4.2.1.2">
<h4 data-number="4.2.1.2" class="anchored" data-anchor-id="系统抽样"><span class="header-section-number">4.2.1.2</span> 系统抽样</h4>
<p>系统抽样也称等距抽样、机械抽样，是指先将全部个体按一定顺序排列，并根据样本容量确定抽样间隔，然后随机确定抽样起点，再按确定的间隔抽取个体组成样本的抽样技术，主要应用于分布均匀的小规模总体。sampling包中的<code>UPrandomsystmatic()</code>函数用于执行系统抽样。</p>
<div id="exm-4.12" class="theorem example">
<p><span class="theorem-title"><strong>例 4.12</strong></span> 系统抽样示例。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">y =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">100</span>) <span class="sc">*</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">2</span>))</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>pik <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span> <span class="sc">/</span> n, <span class="fu">nrow</span>(df) <span class="sc">/</span> n)    <span class="co"># 概率向量,用于确定抽样概率和计算抽样间隔 </span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>s5 <span class="ot">=</span> <span class="fu">UPrandomsystematic</span>(pik)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>df5 <span class="ot">=</span> <span class="fu">getdata</span>(df, s5)</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>df5[ , <span class="sc">-</span><span class="dv">1</span>]</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    x  y
4   4  3
14 14 -3
24 24  4
34 34  3
44 44  1
54 54  8
64 64  7
74 74  9
84 84  9
94 94  6</code></pre>
</div>
</div>
</section>
<section id="分层抽样" class="level4" data-number="4.2.1.3">
<h4 data-number="4.2.1.3" class="anchored" data-anchor-id="分层抽样"><span class="header-section-number">4.2.1.3</span> 分层抽样</h4>
<p>分层抽样也称类型抽样，是指将全部总体单位按某些标志分成若干层(类型)，然后在各层中按规定的比例随机抽取单位组成样本的抽样技术。各层抽取的比例(或概率)可以相等也可以不等。分层抽样的优点是抽取样本的代表性比较好，抽样误差比较小，在复杂总体抽样调查中经常被使用。sampling包中的<code>strata()</code>函数用于执行分层抽样。</p>
<div id="exm-4.13" class="theorem example">
<p><span class="theorem-title"><strong>例 4.13</strong></span> 分层抽样示例。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> iris</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>s6 <span class="ot">=</span> <span class="fu">strata</span>(df, <span class="at">stratanames =</span> <span class="st">"Species"</span>, </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="at">method =</span> <span class="st">"srswor"</span>)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>df6 <span class="ot">=</span> <span class="fu">getdata</span>(df, s6)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>df6</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Sepal.Length Sepal.Width Petal.Length Petal.Width    Species ID_unit Prob
7            4.6         3.4          1.4         0.3     setosa       7 0.06
14           4.3         3.0          1.1         0.1     setosa      14 0.06
41           5.0         3.5          1.3         0.3     setosa      41 0.06
72           6.1         2.8          4.0         1.3 versicolor      72 0.06
79           6.0         2.9          4.5         1.5 versicolor      79 0.06
98           6.2         2.9          4.3         1.3 versicolor      98 0.06
101          6.3         3.3          6.0         2.5  virginica     101 0.08
105          6.5         3.0          5.8         2.2  virginica     105 0.08
132          7.9         3.8          6.4         2.0  virginica     132 0.08
149          6.2         3.4          5.4         2.3  virginica     149 0.08
    Stratum
7         1
14        1
41        1
72        2
79        2
98        2
101       3
105       3
132       3
149       3</code></pre>
</div>
</div>
<p>以上代码按iris数据集中“Species”变量进行分层(共3层)，并用size参数指定每层抽取的单位数，用method参数指定抽取方法。</p>
<p>实际操作中，分层抽样方法可以通过人为调整各层抽样比例，来确保单位数较少的层也能被抽出足够数量的单位以组成更有代表性的样本。</p>
</section>
<section id="整群抽样和多阶段抽样" class="level4" data-number="4.2.1.4">
<h4 data-number="4.2.1.4" class="anchored" data-anchor-id="整群抽样和多阶段抽样"><span class="header-section-number">4.2.1.4</span> 整群抽样和多阶段抽样</h4>
<p>整群抽样是指将全部总体单位按某个标志分群，然后随机抽取群并将群内所有单位组成样本的抽样技术该方法，此即简单整群抽样。如果在抽取的群中再采用各种随机抽样方法来抽取单位组成样本，则称为二阶段整群抽样。整群抽样特别适用于大规模总体。实际工作中，经常采用多阶段抽样技术，综合运用整群抽样、分层抽样以及简单随机抽样等多种抽样技术，以抽取所需要的单位。sampling包中的<code>cluster()</code>函数用于执行整群抽样，<code>mstage()</code>函数用于执行二阶段和多阶段抽样。</p>
<div id="exm-4.14" class="theorem example">
<p><span class="theorem-title"><strong>例 4.14</strong></span> 简单整群抽样示例。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 简单整群抽样</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>s7 <span class="ot">=</span> <span class="fu">cluster</span>(df, <span class="at">clustername =</span> <span class="st">"Species"</span>, <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">"srswor"</span>, <span class="at">description =</span> <span class="cn">TRUE</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of selected clusters: 1 
Number of units in the population and number of selected units: 150 50 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>df7 <span class="ot">=</span> <span class="fu">getdata</span>(df, s7)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df7)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Sepal.Length Sepal.Width Petal.Length Petal.Width   Species ID_unit
101          6.3         3.3          6.0         2.5 virginica     101
102          5.8         2.7          5.1         1.9 virginica     102
103          7.1         3.0          5.9         2.1 virginica     103
104          6.3         2.9          5.6         1.8 virginica     104
105          6.5         3.0          5.8         2.2 virginica     105
106          7.6         3.0          6.6         2.1 virginica     106
         Prob
101 0.3333333
102 0.3333333
103 0.3333333
104 0.3333333
105 0.3333333
106 0.3333333</code></pre>
</div>
</div>
<p>以上代码根据Species变量从iris数据集中将某一个品种的所有观测值作为一个群而抽出，参数size指定抽取群数，参数method指定抽样方法(“srswor”、“srswr”、“poisson”和”systematic”)；参数description设置抽样时是否显示各群基本信息。如果从该群中再随机抽取10个观测值作为最终的样本，即为二阶段整群抽样：</p>
<div id="exm-4.15" class="theorem example">
<p><span class="theorem-title"><strong>例 4.15</strong></span> 二阶段抽样示例。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 二阶段整群抽样</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>s8 <span class="ot">=</span> <span class="fu">srswor</span>(<span class="dv">10</span>, <span class="fu">nrow</span>(df7))  </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>df8 <span class="ot">=</span> <span class="fu">getdata</span>(df7, s8)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>df8</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Sepal.Length Sepal.Width Petal.Length Petal.Width   Species ID_unit
104          6.3         2.9          5.6         1.8 virginica     104
106          7.6         3.0          6.6         2.1 virginica     106
107          4.9         2.5          4.5         1.7 virginica     107
111          6.5         3.2          5.1         2.0 virginica     111
114          5.7         2.5          5.0         2.0 virginica     114
128          6.1         3.0          4.9         1.8 virginica     128
129          6.4         2.8          5.6         2.1 virginica     129
141          6.7         3.1          5.6         2.4 virginica     141
146          6.7         3.0          5.2         2.3 virginica     146
150          5.9         3.0          5.1         1.8 virginica     150
         Prob
104 0.3333333
106 0.3333333
107 0.3333333
111 0.3333333
114 0.3333333
128 0.3333333
129 0.3333333
141 0.3333333
146 0.3333333
150 0.3333333</code></pre>
</div>
</div>
<p>对存在多个分类变量的复杂总体，可以直接采用<code>mstage()</code>函数进行多阶段随机整群抽样：</p>
<div id="exm-4.16" class="theorem example">
<p><span class="theorem-title"><strong>例 4.16</strong></span> 多阶段抽样示例。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 人为构造样本</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="st">"PA"</span>, <span class="dv">100</span>), <span class="dv">100</span>, <span class="dv">1</span>),</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>            <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="st">"PB"</span>, <span class="dv">120</span>), <span class="dv">120</span>, <span class="dv">1</span>),</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="st">"PC"</span>, <span class="dv">150</span>), <span class="dv">150</span>, <span class="dv">1</span>))</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">cbind.data.frame</span>(df, <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">paste0</span>(<span class="st">"ca"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>), <span class="dv">20</span>),</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">rep</span>(<span class="fu">paste0</span>(<span class="st">"cb"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>), <span class="dv">24</span>),</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">rep</span>(<span class="fu">paste0</span>(<span class="st">"cc"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>), <span class="dv">30</span>)),</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">runif</span>(<span class="dv">370</span>) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Province"</span>, <span class="st">"City"</span>, <span class="st">"SO2"</span>)</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df<span class="sc">$</span>Province, df<span class="sc">$</span>City)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    
     ca1 ca2 ca3 ca4 ca5 cb1 cb2 cb3 cb4 cb5 cc1 cc2 cc3 cc4 cc5
  PA  20  20  20  20  20   0   0   0   0   0   0   0   0   0   0
  PB   0   0   0   0   0  24  24  24  24  24   0   0   0   0   0
  PC   0   0   0   0   0   0   0   0   0   0  30  30  30  30  30</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(df)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 分别对前2个变量进行二阶段随机整群抽样</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 先从Province中随机抽出2个群，然后从2个群的City中再各自随机抽出2个子群</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>s9 <span class="ot">=</span> <span class="fu">mstage</span>(df, <span class="at">stage =</span> <span class="fu">list</span>(<span class="st">"cluster"</span>, <span class="st">"cluster"</span>),</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">varnames =</span> <span class="fu">list</span>(<span class="st">"Province"</span>, <span class="st">"City"</span>),</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fu">list</span>(<span class="dv">2</span>, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>)), <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"srswor"</span>, <span class="st">"srswor"</span>))</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(df)</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>df9 <span class="ot">=</span> <span class="fu">getdata</span>(df, s9)[[<span class="dv">2</span>]]</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df9<span class="sc">$</span>Province, df9<span class="sc">$</span>City)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    
     cb3 cb4 cc3 cc4
  PB  24  24   0   0
  PC   0   0  30  30</code></pre>
</div>
</div>
</section>
</section>
<section id="参数估计" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="参数估计"><span class="header-section-number">4.2.2</span> 参数估计</h3>
<p>针对总体分布类型已知而参数未知的情况，可以通过样本统计量来估算总体参数，这称之为参数估计。参数估计包括点估计和区间估计。点估计无法反映抽样误差的大小，而区间估计则给出总体参数的一个置信区间(CI)来体现抽样误差的大小，综合考虑了点估计和抽样误差。</p>
<p>参数估计的原则如下：</p>
<ul>
<li>无偏性：如果某估计量的所有可能值的平均值，即估计量的数学期望等于相应的总体参数值，则该估计量就是相应总体参数的无偏估计量。<br>
</li>
<li>有效性：如果某估计量是若干个无偏估计量中方差最小的，则该估计量就是相应总体参数的更有效的估计量。<br>
</li>
<li>一致性：如果某估计量随着样本容量的增大，越来越接近总体参数的真值，则该估计量就是相应总体参数的一致估计量。<br>
</li>
<li>充分性：如果某估计量充分利用了样本中有关总体的所有可能信息，则该估计量就是相应总体参数的充分估计量。</li>
</ul>
<p>区间估计需要给出置信水平，即概率，大多数情况下这个概率取0.95，即保证总体参数落入区间的概率为95%。置信水平一般以<span class="math inline">1－\alpha</span>表示，<span class="math inline">\alpha</span>称为显著性水平。在给定置信水平下，就可以基于中心极限定理和抽样分布来建立置信区间。</p>
<section id="点估计" class="level4" data-number="4.2.2.1">
<h4 data-number="4.2.2.1" class="anchored" data-anchor-id="点估计"><span class="header-section-number">4.2.2.1</span> 点估计</h4>
<p>点估计方法有矩法(moment method)、极大似然法(maximum likelihood method)、最小二乘法(least square method)、贝叶斯法(Bayes method)等，其中矩法和极大似然法最为常用。</p>
<p><strong>(1)矩法</strong><br>
矩法估计是基于大数定律的参数估计方法。对于随机变量<span class="math inline">X</span>，其<span class="math inline">n</span>阶原点矩定义为<span class="math inline">E(X^n)</span>，其n阶中心矩定义为<span class="math inline">E{[X - (X)]^n}</span>。样本<span class="math inline">x</span>的<span class="math inline">k</span>阶原点矩<span class="math inline">A_k = (\sum{x_i^k})/n</span>是总体<span class="math inline">k</span>阶原点矩的无偏估计量。对于正态分布，样本均值(1阶原点矩)是总体均值的无偏估计量。但<span class="math inline">k</span>阶样本中心矩<span class="math inline">B_k = [\sum(x_i-\bar{x})^k]/n</span>是总体k阶中心矩的有偏估计量，<span class="math inline">B_k^{'} = \sum(x_i-\bar{x})^k/(n-1)</span>才是总体k阶中心矩的无偏估计量，在<span class="math inline">n</span>趋近于无穷大时，<span class="math inline">B_k</span>与<span class="math inline">B_k^{'}</span>等价。方差计算基于二阶中心矩，偏度基于三阶中心矩，峰度基于四阶中心矩。 矩法估计时，低阶矩估计的结果更精确。对于参数为λ的指数分布，其均值为<span class="math inline">1/λ</span>，方差为<span class="math inline">1/λ^2</span>，则估计λ时，应采用<span class="math inline">1/\bar{x}</span>，而不是<span class="math inline">1/s</span>。</p>
<div id="exm-4.17" class="theorem example">
<p><span class="theorem-title"><strong>例 4.17</strong></span> 矩法估计指数分布的参数<span class="math inline">\lambda</span>。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">rexp</span>(<span class="dv">50</span>, <span class="at">rate =</span> <span class="dv">5</span>)    <span class="co"># 生成50个服从λ=5的指数分布的数据</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>(<span class="at">ld1 =</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">mean</span>(x))    <span class="co"># 根据1/x ̅估算参数λ</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.287561</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">ld2 =</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">sd</span>(x))    <span class="co"># 根据1/s估算参数λ</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.527402</code></pre>
</div>
</div>
<p>上述代码中两个估算参数的表达式最外层的英文括号<code>()</code>用于显示表达式计算结果，相当于<code>print()</code>的功能。计算结果表明，基于<span class="math inline">1/\bar{x}</span>估算的结果更接近总体参数<span class="math inline">\lambda</span>。矩法估计参数时，小样本估计的结果不唯一，波动很大，甚至会跳出参数空间的范围。因此，矩法在足够样本量的情况下，估计结果才能更准确和可靠。</p>
<p><strong>(2)极大似然法</strong><br>
极大似然法基于极大似然原理，即概率大的事件在一次观测中更容易发生。极大似然法针对总体分布已知的情况，通过求解待估参数的似然函数得到优良且唯一的估计量。在小样本情况下，极大似然法估计结果比矩法估计结果波动小，相对稳定。 下面以均匀分布来比较矩法和极大似然法估计参数的稳定性。对于均匀分布<span class="math inline">U(0, \theta)(\theta＞0)</span>，其概率密度函数如下：</p>
<p><span id="eq-4.1"><span class="math display">
f(x;\theta)=\begin{cases}\dfrac{1}{\theta},&amp;0\le x\le\theta\\0,&amp;\text{其他}\end{cases}
\tag{4.1}</span></span></p>
<p>矩法估计参数<span class="math inline">\theta</span>的公式为<span class="math inline">\hat{\theta}=2\bar{x}</span>，而根据似然函数推导出的参数<span class="math inline">\theta</span>的极大似然估计公式为<span class="math inline">\hat{\theta}=\text{max}(x_i)</span>。下面的代码模拟了从<span class="math inline">\theta=6</span>的<span class="math inline">U(0, \theta)</span>分布中抽取大小为30的100个样本，分别计算矩法和极大似然估计的结果，并绘制图形(如 <a href="#fig-4.4" class="quarto-xref">图&nbsp;<span>4.5</span></a> 所示)，以直观比较。</p>
<div id="exm-4.18" class="theorem example">
<p><span class="theorem-title"><strong>例 4.18</strong></span> 矩法和极大似然法利用小样本估计均匀分布参数<span class="math inline">\theta</span>的稳定性。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">30</span>; theta <span class="ot">=</span> <span class="dv">6</span>; ul <span class="ot">=</span> <span class="dv">8</span>; dl <span class="ot">=</span> <span class="dv">4</span>; times <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>me <span class="ot">=</span> mle <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, times)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>times){</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, theta)    <span class="co"># 随机生成样本</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  me[i] <span class="ot">=</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">mean</span>(x)</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  mle[i] <span class="ot">=</span> <span class="fu">max</span>(x)</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制图形</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span>times, me, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">xlab =</span> <span class="st">"样本序号"</span>, <span class="at">ylab =</span> <span class="st">"参数估计值"</span>,</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>), <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">1</span><span class="sc">:</span>times, mle, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">"red"</span>)</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">6</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">5</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">7</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-4.4" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.4-1.png" class="img-fluid figure-img" style="width:80.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.5: 比较矩法估计和极大似然估计
</figcaption>
</figure>
</div>
</div>
</div>
<p>从 <a href="#fig-4.4" class="quarto-xref">图&nbsp;<span>4.5</span></a> 可见，小样本情况下，极大似然法估计值比矩法更稳定，但存在低估的情况。</p>
</section>
<section id="区间估计" class="level4" data-number="4.2.2.2">
<h4 data-number="4.2.2.2" class="anchored" data-anchor-id="区间估计"><span class="header-section-number">4.2.2.2</span> 区间估计</h4>
<p>区间估计是在点估计的基础上，根据抽样分布原理，按一定的概率估计总体参数落在哪个范围，这个范围称为总体参数的置信区间。对总体参数<span class="math inline">\theta</span>估计其取值范围，对于给定的小概率<span class="math inline">\alpha</span>，有<span class="math inline">P(\theta_1&lt;\theta&lt;\theta_2)=1-\alpha，(\theta_1,\theta_2)</span>是参数<span class="math inline">\theta</span>的置信区间，<span class="math inline">\theta_1</span>、<span class="math inline">\theta_2</span>分别是参数的置信下限和上限，置信区间两端的区域称为舍弃域，<span class="math inline">\alpha</span>为显著性水平，<span class="math inline">1-\alpha</span>为区间估计的置信概率，也称为置信水平。置信水平的含义是指由全部样本统计量所确定的所有置信区间中，有<span class="math inline">100(1-\alpha)%</span>的置信区间包括了总体参数<span class="math inline">\theta</span>，另外有<span class="math inline">100\alpha</span>%的置信区间没有包括总体参数<span class="math inline">\theta</span>。在实际应用中，<span class="math inline">\alpha</span>一般取0.01或0.05，如无特别指出，<span class="math inline">\alpha</span>一般取0.05。</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-4.5" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/fig4.5.png" class="img-fluid figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.6: 置信区间与舍弃域
</figcaption>
</figure>
</div>
</div>
</div>
<p>置信区间的宽度<span class="math inline">(\theta_2-\theta_1)</span>反映了参数估计的不确定性，越宽则不确定性越大，精确度越小，但参数落入该区间的几率越大。置信水平越大，置信区间越宽；样本容量增大，置信区间收窄。</p>
<p>(1)单个正态总体均值<span class="math inline">\mu</span>的区间估计<br>
当总体<span class="math inline">\sigma^2</span>已知时，基于正态分布统计量估计其均值的双侧和单侧置信区间的计算公式如下：</p>
<p><span id="eq-4.2"><span class="math display">
  \begin{gathered}
  \left(\bar{x}-\frac\sigma{\sqrt{n}}|z_{\alpha/2}|,\bar{x}+\frac\sigma{\sqrt{n}}|z_{\alpha/2}|\right)\\
  \left(-\infty,\bar{x}+\frac\sigma{\sqrt{n}}|z_{\alpha}|\right)\\
  \left(\bar{x}-\frac\sigma{\sqrt{n}}|z_{\alpha}|,+\infty\right)
  \end{gathered}
\tag{4.2}</span></span></p>
<p>利用<code>qnorm()</code>函数计算统计量z的值，如求累积概率为0.025处的<em>z</em>值：<code>qnorm(0.025)</code>。R包BSDA中的<code>z.test()</code>函数可直接给出该情况下的区间估计和假设检验结果。<br>
当总体<span class="math inline">\sigma^2</span>未知时，基于<em>t</em>分布统计量估计其均值的双侧和单侧置信区间计算公式如下：</p>
<p><span id="eq-4.3"><span class="math display">
\begin{gathered}
  (\bar{x}-\frac{s}{\sqrt{n}}|t_{\alpha/2,n-1}|,\bar{x}+\frac{s}{\sqrt{n}}|t_{\alpha/2,n-1}|\\
  (-\infty,\bar{x}+\frac{s}{\sqrt{n}}|t_{\alpha,n-1}|) \\
  (\bar{x}-\frac{s}{\sqrt{n}}|t_{\alpha,n-1}|,+\infty)
\end{gathered}
\tag{4.3}</span></span></p>
<p>利用<code>qt()</code>函数计算统计量t的值，如求自由度为9、累积概率为0.025处的t值：<code>qt(0.025, 9)</code>。<code>t.test()</code>函数可以同时给出区间估计和假设检验结果。</p>
<div id="exm-4.19" class="theorem example">
<p><span class="theorem-title"><strong>例 4.19</strong></span> 为测定某湖泊水Hg污染情况，从该湖中随机取9条鱼龄相近的鱼，测得鱼胸肌中Hg含量分别1.921、2.024、2.046、2.032、1.982、1.889、2.136、1.983、2.146(mg/kg)，试估计该湖泊鱼胸肌中Hg含量的95%和99%置信区间。</p>
</div>
<p>解：n = 9，小样本，按<em>t</em>分布计算；先计算<span class="math inline">t_{0.05/2,8}</span>和<span class="math inline">t_{0.01/2,8}</span>，然后按公式计算CI：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>t1 <span class="ot">=</span> <span class="fu">qt</span>(<span class="fl">0.975</span>,<span class="dv">8</span>); t2 <span class="ot">=</span> <span class="fu">qt</span>(<span class="fl">0.995</span>,<span class="dv">8</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">1.921</span>,<span class="fl">2.024</span>,<span class="fl">2.046</span>,<span class="fl">2.032</span>,<span class="fl">1.982</span>,<span class="fl">1.889</span>,<span class="fl">2.136</span>,<span class="fl">1.983</span>,<span class="fl">2.146</span>)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>xt1 <span class="ot">=</span> t1 <span class="sc">*</span> <span class="fu">sd</span>(x) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(x))</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>xt2 <span class="ot">=</span> t2 <span class="sc">*</span> <span class="fu">sd</span>(x) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(x))</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"95%CI: "</span>, <span class="fu">mean</span>(x) <span class="sc">-</span> xt1, <span class="fu">mean</span>(x) <span class="sc">+</span> xt1, <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>95%CI:  1.951157 2.084176 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"99%CI: "</span>, <span class="fu">mean</span>(x) <span class="sc">-</span> xt2, <span class="fu">mean</span>(x) <span class="sc">+</span> xt2, <span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>99%CI:  1.920891 2.114443 </code></pre>
</div>
</div>
<p>直接采用<code>t.test()</code>函数计算：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(x, <span class="at">conf.level =</span> <span class="fl">0.95</span>)<span class="sc">$</span>conf.int</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.951157 2.084176
attr(,"conf.level")
[1] 0.95</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(x, <span class="at">conf.level =</span> <span class="fl">0.99</span>)<span class="sc">$</span>conf.int</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.920891 2.114443
attr(,"conf.level")
[1] 0.99</code></pre>
</div>
</div>
<p>(2)单个正态总体方差<span class="math inline">\sigma^2</span>的区间估计<br>
当总体均值<span class="math inline">\mu</span>已知时，基于<span class="math inline">\chi^2</span>分布统计量估计其方差<span class="math inline">\sigma^2</span>的双侧和单侧置信区间：</p>
<p><span id="eq-4.4"><span class="math display">\begin{gathered}
  (\frac{\sum_{i=1}^{n}(x_{i}-\mu)^{2}}{\chi_{\alpha/2,n}^{2}},\frac{\sum_{i=1}^{n}(x_{i}-\mu)^2}{\chi_{1-\alpha/2,n}^2}\\
  (0,\frac{\sum_{i=1}^{n}(x_{i}-\mu)^{2}}{\chi_{1-\alpha,n}^2}) \\
  (\frac{\sum_{i=1}^{n}(x_{i}-\mu)^2}{\chi_{\alpha/2,n}^2},+\infty)
\end{gathered}
\tag{4.4}</span></span></p>
<p>当总体均值<span class="math inline">\mu</span>未知时，基于<span class="math inline">\chi^2</span>分布统计量估计其方差<span class="math inline">\sigma^2</span>的双侧和单侧置信区间：</p>
<p><span id="eq-4.5"><span class="math display">
  \left(\frac{(n-1)s^2}{\chi_{(\alpha/2,n-1)}^2},\frac{(n-1)s^2}{\chi_{(1-\alpha/2,n-1)}^2}\right)\\
  \left(0,\frac{(n-1)s^2}{\chi_{(1-\alpha/2,n-1)}^2}\right)\\
  \left(\frac{(n-1)s^2}{\chi_{(\alpha/2,n-1)}^2},+\infty\right)\\
\tag{4.5}</span></span></p>
<p>R利用<code>qchisq()</code>函数计算统计量<span class="math inline">\sigma^2</span>的值，如求自由度为9、累积概率为0.025出的<span class="math inline">\sigma^2</span>值：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qchisq</span>(<span class="fl">0.025</span>, <span class="dv">9</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.700389</code></pre>
</div>
</div>
<p>(3)两个正态总体均值差的区间估计<br>
当两个总体的方差<span class="math inline">\sigma_1^2</span>、<span class="math inline">\sigma_2^2</span>均已知时，基于正态分布统计量估计均值差的双侧和单侧置信区间：</p>
<p><span id="eq-4.6"><span class="math display">
\left(\bar{x}_1-\bar{x}_2-\left|z_{\alpha/2}\right|\sqrt{\frac{\sigma_1^2}{n_1}+\frac{\sigma_2^2}{n_2}},\bar{x}_1-\bar{x}_2+\left|z_{\alpha/2}\right|\sqrt{\frac{\sigma_1^2}{n_1}+\frac{\sigma_2^2}{n_2}}\right)\\
\left(-\infty,\bar{x}_1-\bar{x}_2+\left|z_{\alpha}\right|\sqrt{\frac{\sigma_1^2}{n_1}+\frac{\sigma_2^2}{n_2}}\right)\\
\left(\bar{x}_1-\bar{x}_2-\left|z_{\alpha}\right|\sqrt{\frac{\sigma_1^2}{n_1}+\frac{\sigma_2^2}{n_2}},+\infty\right)\\
\tag{4.6}</span></span></p>
<p>当两个总体的方差<span class="math inline">\sigma_1^2</span>、<span class="math inline">\sigma_2^2</span>均未知且<span class="math inline">n_1 \neq n_2</span>但<span class="math inline">n_1</span> 、<span class="math inline">n_2</span>均足够大(<span class="math inline">≥50</span>)时，基于正态分布统计量估计均值差的双侧和单侧置信区间：</p>
<p><span id="eq-4.7"><span class="math display">
\begin{gathered}
  (\bar{x}_1-\bar{x}_2-|z_{\alpha/2}|\sqrt{\frac{s_1^2}{n_1}+\frac{s_2^2}{n_2}},\bar{x}_1-\bar{x}_2+|z_{\alpha/2}|\sqrt{\frac{s_1^2}{n_1}+\frac{s_2^2}{n_2}}) \\
  (-\infty,\bar{x}_1-\bar{x}_2+|z_\alpha|\sqrt{\frac{s_1^2}{n_1}+\frac{s_2^2}{n_2}}) \\
  (\bar{x}_{1}-\bar{x}_{2}-|z_{\alpha}|\sqrt{\frac{s_1^2}{n_1}+\frac{s_2^2}{n_2}},+\infty)
\end{gathered}
\tag{4.7}</span></span></p>
<p>以上两种情况下的总体均值差的区间估计可直接使用R包BSDA中的<code>z.test()</code>函数。</p>
<p>当两个总体的方差<span class="math inline">\sigma_1^2</span>、<span class="math inline">\sigma_2^2</span>均未知但相等时，基于<em>t</em>分布统计量估计均值差的双侧和单侧置信区间：</p>
<p><span id="eq-4.8"><span class="math display">
\begin{gathered}
  (\bar{x}_1-\bar{x}_2-s_w|t_{\alpha/2,n_1+n_2-2}|\sqrt{\frac{1}{n_1}+\frac{1}{n_2}},\bar{x}_1-\bar{x}_2+s_{w}|t_{\alpha/2,n_1+n_2-2}|\sqrt{\frac{1}{n_1}+\frac{1}{n_2}}\\
  (-\infty,\bar{x}_1-\bar{x}_2+s_w|t_{(\alpha,n_1+n_2-2)}|\sqrt{\frac{1}{n_1}+\frac{1}{n_2}}\\
  (\bar{x}_1-\bar{x}_2-s_w|t_{(a,n_1+n_2-2)}|\sqrt{\frac{1}{n_1}+\frac{1}{n_2}},+\infty\\
\end{gathered}
\tag{4.8}</span></span></p>
<p>其中<span class="math inline">s_w</span>的计算公式为：</p>
<p><span id="eq-4.9"><span class="math display">
s_w=\sqrt{\frac{(n_1-1)s_1^2+(n_2-1)s_2^2}{n_1+n_2-2}}
\tag{4.9}</span></span></p>
<p>以上此情况下的均值差区间估计和假设检验，可执行<code>t.test(x, y, var.equal = TRUE)</code>。</p>
<p>当两个总体的方差<span class="math inline">\sigma_1^2</span>、<span class="math inline">\sigma_2^2</span>均未知但<span class="math inline">n_1=n_2=n</span>时，基于<em>t</em>分布统计量估计均值差的双侧和单侧置信区间：</p>
<p><span id="eq-4.10"><span class="math display">
\begin{gathered}
  (\bar{x}_1-\bar{x}_2-|t_{\alpha/2,n-1}|\frac{s_z}{\sqrt{n}},\bar{x}_1-\bar{x}_2+|t_{\alpha/2,n-1}|\frac{s_z}{\sqrt{n}})\\
  (-\infty,\bar{x_1}-\bar{x_2}+|t_{\alpha,n-1}|\frac{s_z}{\sqrt{n}})\\
  (\bar{x}_1-\bar{x}_2-|t_{\alpha,n-1}|\frac{s_z}{\sqrt{n}},+\infty)
\end{gathered}
\tag{4.10}</span></span></p>
<p>其中<span class="math inline">s_z</span>的计算公式为:</p>
<p><span id="eq-4.11"><span class="math display">
\begin{gathered}
  s_{z}=\sqrt{\frac{\sum_{i=1}^{n}[(x_{1,i}-\bar{x}_1)-(x_{2,i}-\bar{x}_2)]^2}{n-1}}
\end{gathered}
\tag{4.11}</span></span></p>
<p>以上情况下的均值差区间估计和假设检验，可执行<code>t.test(x, y, paired = TRUE)</code>。</p>
<p>当两个总体的方差<span class="math inline">\sigma_1^2</span>、<span class="math inline">\sigma_2^2</span>均未知且不相等时，基于<em>t</em>分布统计量估计均值差的双侧和单侧置信区间：</p>
<p><span id="eq-4.12"><span class="math display">
\begin{gathered}
  \left(\bar{x}_{1}-\bar{x}_{2}-|t_{(\alpha/2,\nu)}|\sqrt{\frac{s_{1}^{2}}{n_{1}}+\frac{s_{2}^{2}}{n_{2}}},\bar{x}_{1}-\bar{x}_{2}+|t_{(\alpha/2,\nu)}|\sqrt{\frac{s_{1}^{2}}{n_{1}}+\frac{s_{2}^{2}}{n_{2}}}\right) \\
  \left(-\infty\text{,}\bar{x}_{1}-\bar{x}_{2}+|t_{(\alpha,\nu)}|\sqrt{\frac{s_{1}^{2}}{n_{1}}+\frac{s_{2}^{2}}{n_{2}}}\right) \\
  \left(\bar{x}_{1}-\bar{x}_{2}-|t_{(\alpha,\nu)}|\sqrt{\frac{s_{1}^{2}}{n_{1}}+\frac{s_{2}^{2}}{n_{2}}},+\infty\right)
\end{gathered}
\tag{4.12}</span></span></p>
<p>其中<span class="math inline">\nu</span>的计算公式为:</p>
<p><span id="eq-4.13"><span class="math display">
\begin{gathered}
  \nu=\frac{({s_1^2}/{n_1}+{s_2^2}/{n_2})^2}{{s_1^4}/[{n_1^2(n_1-1)}]+{s_2^4}/[{n_2^2(n_2-1)}]}
\end{gathered}
\tag{4.13}</span></span></p>
<p>以上情况下的均值差区间估计和假设检验，直接执行<code>t.test(x, y)</code>。</p>
<p>(4)两个正态总体方差比的区间估计<br>
当两个总体的均值<span class="math inline">\mu_1</span>、<span class="math inline">\mu_2</span>已知时，基于<em>F</em>分布估计二者方差比<span class="math inline">\sigma_1^2/\sigma_2^2</span>的双侧和单侧置信区间如下：</p>
<p><span id="eq-4.14"><span class="math display">
\begin{gathered}
  \left(\frac{n_2\sum_{i=1}^{n_1}(x_{1,i}-\mu_1)^2}{n_1\sum_{i=1}^{n_2}(x_{2,i}-\mu_2)^2}F_{1-\alpha/2,n,m},\frac{n_2\sum_{i=1}^{n_1}(x_{1,i}-\mu_1)^2}{n_1\sum_{i=1}^{n_2}(x_{2,i}-\mu_2)^2}F_{\alpha/2,n,m}\right)\\
  \left(0,\frac{n_2\sum_{i=1}^{n_1}(x_{1,i}-\mu_1)^2}{n_1\sum_{i=1}^{n_2}(x_{2,i}-\mu_2)^2}F_{\alpha,n,m}\right)\\
  \left(\frac{n_2\sum_{i=1}^{n_1}(x_{1,i}-\mu_1)^2}{n_1\sum_{i=1}^{n_2}(x_{2,i}-\mu_2)^2}F_{1-\alpha,n,m},+\infty\right)
\end{gathered}
\tag{4.14}</span></span></p>
<p>当两个总体的均值<span class="math inline">\mu_1</span>、<span class="math inline">\mu_2</span>未知时，基于<em>F</em>分布估计二者方差比<span class="math inline">\sigma_1^2/\sigma_2^2</span>的双侧和单侧置信区间如下：</p>
<p><span id="eq-4.15"><span class="math display">
\begin{gathered}
\left(\frac{s_1^2}{s_2^2}F_{(1-\alpha/2,n-1,m-1)},\frac{s_1^2}{s_2^2}F_{(\alpha/2,n-1,m-1)}\right) \\
\left(0\text{,}\frac{s_1^2}{s_2^2}F_{(\alpha,n-1,m-1)}\right) \\
\left(\frac{s_1^2}{s_2^2}F_{(1-\alpha,n-1,m-1)},+\infty\right)
\end{gathered}
\tag{4.15}</span></span></p>
<p>此情况下，直接使用<code>var.test()</code>函数估计方差比的置信区间并进行假设检验。</p>
<p>(5)总体比率的区间估计<br>
当样本量<span class="math inline">n</span>较大(<span class="math inline">np＞25</span>)时，可基于正态分布统计量估计单个总体比率p的置信区间：</p>
<p><span id="eq-4.16"><span class="math display">
\begin{gathered}
  \left(p-|z_{\alpha/2}|\sqrt{\frac{p(1-p)}n},p+|z_{\alpha/2}|\sqrt{\frac{p(1-p)}n}\right) \\
  \left(0,p+|z_\alpha|\sqrt{\frac{p(1-p)}n}\right) \\
  \left(p-|z_\alpha|\sqrt{\frac{p(1-p)}n},1\right)
\end{gathered}
\tag{4.16}</span></span></p>
<p>当样本量<span class="math inline">n</span>较小时，可基于F分布统计量估计单个总体比率p的置信区间：</p>
<p><span id="eq-4.17"><span class="math display">
\begin{gathered}
  \left(\frac{2npF_{1-\alpha/2,2np,2n-2np+2}}{2n-2np+2+2npF_{1-\alpha/2,2np,2n-2np+2}},\frac{(2np+2)F_{\alpha/2,2np+2,2n-2np}}{2n-2np+(2np+2)F_{\alpha/2,2np+2,2n-2np}}\right)\\
  \left(0,\frac{(2np+2)F_{\alpha/2,2np+2,2n-2np}}{2n-2np+(2np+2)F_{\alpha,2np+2,2n-2np}}\right)\\
  \left(\frac{2npF_{1-\alpha/2,2np,2n-2np+2}}{2n-2np+2+2npF_{1-\alpha,2np,2n-2np+2}},1\right)
\end{gathered}
\tag{4.17}</span></span></p>
<p>函数<code>binom.test()</code>可用于进行精确估计总体比率的置信区间，也可用<code>prop.test()</code>函数(默认进行连续性修正，即参数correct = TRUE)进行近似估计。</p>
<div id="exm-4.20" class="theorem example">
<p><span class="theorem-title"><strong>例 4.20</strong></span> 测定某工厂废水样本63个，发现其中3个样本污染物A的浓度超标。试估计污染物A总体超标率的90%置信区间。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 公式计算</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">63</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>np <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fl">0.1</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>nu1 <span class="ot">=</span> <span class="dv">2</span> <span class="sc">*</span> np</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>nu2 <span class="ot">=</span> <span class="dv">2</span> <span class="sc">*</span> n <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> np <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>nu3 <span class="ot">=</span> <span class="dv">2</span> <span class="sc">*</span> np <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>nu4 <span class="ot">=</span> <span class="dv">2</span> <span class="sc">*</span> n <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> np</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>q1 <span class="ot">=</span> <span class="fu">qf</span>(a <span class="sc">/</span> <span class="dv">2</span>, nu1, nu2)</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>q2 <span class="ot">=</span> <span class="fu">qf</span>(<span class="dv">1</span> <span class="sc">-</span> a <span class="sc">/</span> <span class="dv">2</span>, nu3, nu4)</span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a>ci <span class="ot">=</span> <span class="fu">c</span>(nu1 <span class="sc">*</span> q1 <span class="sc">/</span> (nu2 <span class="sc">+</span> nu1 <span class="sc">*</span> q1), nu3 <span class="sc">*</span> q2 <span class="sc">/</span> (nu4 <span class="sc">+</span> nu3 <span class="sc">*</span> q2))</span>
<span id="cb118-12"><a href="#cb118-12" aria-hidden="true" tabindex="-1"></a>ci</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01310334 0.11849878</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># binom.test函数计算</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">binom.test</span>(<span class="at">x =</span> np, <span class="at">n =</span> n, <span class="at">conf.level =</span> <span class="fl">0.90</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Exact binomial test

data:  np and n
number of successes = 3, number of trials = 63, p-value = 9.048e-15
alternative hypothesis: true probability of success is not equal to 0.5
90 percent confidence interval:
 0.01310334 0.11849878
sample estimates:
probability of success 
            0.04761905 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prop.test函数计算</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.test</span>(<span class="at">x =</span> np, <span class="at">n =</span> n, <span class="at">conf.level =</span> <span class="fl">0.90</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    1-sample proportions test with continuity correction

data:  np out of n, null probability 0.5
X-squared = 49.778, df = 1, p-value = 1.722e-12
alternative hypothesis: true p is not equal to 0.5
90 percent confidence interval:
 0.01472307 0.12381063
sample estimates:
         p 
0.04761905 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># 不使用连续性修正</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.test</span>(<span class="at">x =</span> np, <span class="at">n =</span> n, <span class="at">conf.level =</span> <span class="fl">0.90</span>, <span class="at">correct =</span> <span class="cn">FALSE</span>)   </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    1-sample proportions test without continuity correction

data:  np out of n, null probability 0.5
X-squared = 51.571, df = 1, p-value = 6.904e-13
alternative hypothesis: true p is not equal to 0.5
90 percent confidence interval:
 0.01918907 0.11330422
sample estimates:
         p 
0.04761905 </code></pre>
</div>
</div>
</section>
<section id="自举采样估计" class="level4" data-number="4.2.2.3">
<h4 data-number="4.2.2.3" class="anchored" data-anchor-id="自举采样估计"><span class="header-section-number">4.2.2.3</span> 自举采样估计</h4>
<p>当总体分布未知，仅有一个样本且样本量n较小时，可通过自举采样(bootstrap sampling)来估计总体参数的置信区间。在机器学习建模中，自举采样法也有重要的应用，例如集成学习算法bagging的核心思想就是自举采样方法。</p>
<p>自举采样是现代统计学中一种针对小样本的重采样技术，即以已有的小样本为“总体”，从中反复回置抽取等量的自举样本。“自举采样的样本统计量围绕原始样本统计量的变化”是“原始样本统计量围绕总体参数的变化”的一个很好的近似。与传统参数估计方法需要总体为正态分布的假设相比，自举采样法仅仅通过已有样本数据而不对总体的分布做任何假设。</p>
<p>自举采样法的特点是：采取回置抽样，每次抽样均以相同概率抽取单位；自举样本容量与原始样本容量相同。</p>
<p>利用自举抽样方法估计总体参数的步骤如下：<br>
(1)通过回置抽样从已知样本抽取N个与已知样本容量大小n相同的自举样本；<br>
(2)计算每个自举样本的待估参数的函数值；<br>
(3)根据置信概率α求取N个函数值的上下分位数。</p>
<div id="exm-4.21" class="theorem example">
<p><span class="theorem-title"><strong>例 4.21</strong></span> 利用自举抽样法求解 <a href="#exm-4.19" class="quarto-xref">例&nbsp;<span>4.19</span></a> 。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">1.921</span>, <span class="fl">2.024</span>, <span class="fl">2.046</span>, <span class="fl">2.032</span>, <span class="fl">1.982</span>, <span class="fl">1.889</span>, <span class="fl">2.136</span>, <span class="fl">1.983</span>, <span class="fl">2.146</span>)</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="dv">5000</span>; n <span class="ot">=</span> <span class="fu">length</span>(x)</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">=</span> <span class="fu">rep</span>(<span class="cn">NA</span>, N)</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N){</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>  mat[i] <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">sample</span>(x, n, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 95%置信区间</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(mat, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    2.5%    97.5% 
1.963994 2.070000 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 99%置信区间</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(mat, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.005</span>, <span class="fl">0.995</span>))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    0.5%    99.5% 
1.950218 2.084115 </code></pre>
</div>
</div>
<p>R包boot中的<code>boot.ci()</code>函数提供了自举抽样法估计参数置信区间的更多功能。</p>
<div id="exm-4.22" class="theorem example">
<p><span class="theorem-title"><strong>例 4.22</strong></span> 利用<code>boot.ci()</code>函数估计 <a href="#exm-4.19" class="quarto-xref">例&nbsp;<span>4.19</span></a> 的置信区间：</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">conc =</span> <span class="fu">c</span>(<span class="fl">1.921</span>, <span class="fl">2.024</span>, <span class="fl">2.046</span>, <span class="fl">2.032</span>, <span class="fl">1.982</span>,</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">1.889</span>, <span class="fl">2.136</span>, <span class="fl">1.983</span>, <span class="fl">2.146</span>))</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>meanx <span class="ot">=</span> <span class="cf">function</span>(x, ind) <span class="fu">mean</span>(x[ind, ])</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>x.boot <span class="ot">=</span> <span class="fu">boot</span>(x, meanx, <span class="at">R =</span> <span class="dv">5000</span>, <span class="at">stype =</span> <span class="st">"i"</span>)</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a><span class="fu">boot.ci</span>(x.boot, <span class="at">conf =</span> <span class="fu">c</span>(<span class="fl">0.95</span>, <span class="fl">0.99</span>), <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"basic"</span>, <span class="st">"norm"</span>, <span class="st">"perc"</span>, <span class="st">"bca"</span>))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS
Based on 5000 bootstrap replicates

CALL : 
boot.ci(boot.out = x.boot, conf = c(0.95, 0.99), type = c("basic", 
    "norm", "perc", "bca"))

Intervals : 
Level      Normal              Basic         
95%   ( 1.965,  2.071 )   ( 1.966,  2.071 )   
99%   ( 1.949,  2.088 )   ( 1.950,  2.087 )  

Level     Percentile            BCa          
95%   ( 1.964,  2.069 )   ( 1.966,  2.071 )   
99%   ( 1.949,  2.085 )   ( 1.951,  2.087 )  
Calculations and Intervals on Original Scale</code></pre>
</div>
</div>
<p><code>boot.ci()</code>函数可生成5种不同类型的双侧等尾非参数置信区间：一阶正态近似(Normal)、基本自举区间(Basic)、学生化自举区间(Studentized)、自举百分位数区间(Percentile)和校正自举百分位数区间(BCa)，可通过type参数指定置信区间估算方法。</p>
<div id="exr-4.2" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 4.2</strong></span> <br>
(1)重复10次测定某废水中CODMn含量分别为436.5、430.3、442.8、438.9、429.5、440.7、439.6、431.4、433.2、435.4mg/L，基于t分布和自举抽样法估计其均值的95%和99%置信区间。<br>
(2)基于 <a href="#exm-4.19" class="quarto-xref">例&nbsp;<span>4.19</span></a> ，按同样方法计算95%置信区间。</p>
</div>
</section>
</section>
<section id="假设检验" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="假设检验"><span class="header-section-number">4.2.3</span> 假设检验</h3>
<p>假设检验是用来判断造成样本与样本、样本与总体之间差异的原因是抽样误差还是本质差别的一种统计推断方法。显著性检验是最常用的一种假设检验方法，其基本原理是先对总体参数做出某种假设，然后基于反证法思想，利用样本信息对假设做出接受或拒绝的决策。假设检验是一种重要的推断性统计分析方法，基于“小概率事件”原理，即小概率事件在一次试验或观测中基本上不会发生。常用的假设检验方法分为参数检验和非参数检验，前者需要总体分布已知，而后者不需要知道总体分布类型。</p>
<section id="假设检验的步骤" class="level4" data-number="4.2.3.1">
<h4 data-number="4.2.3.1" class="anchored" data-anchor-id="假设检验的步骤"><span class="header-section-number">4.2.3.1</span> 假设检验的步骤</h4>
<p><strong>(1)根据问题提出假设</strong><br>
根据实际问题，一般提出两个对立的假设：检验假设(null hypothesis，亦称零假设或原假设)和备择假设(alternative hypothesis)。检验假设通常是统计者想要拒绝的假设，用H<sub>0</sub>表示，双侧检验用<code>=</code>，右侧检验用<code>≥</code>，左侧检验用<code>≤</code>。备择假设通常是统计者想要接受的假设，用H<sub>1</sub>表示，双侧检验用<code>≠</code>，右侧检验用<code>&gt;</code>，左侧检验用<code>&lt;</code>。<br>
假设检验有可能发生两种错误：弃真错误(第I类错误)和取伪错误(第II类错误)。弃真错误是H<sub>0</sub>为真但被拒绝，其概率记为<span class="math inline">\alpha</span>，亦即检验水准或显著性水平，人为设定从而可以控制其大小。取伪错误是H<sub>0</sub>为假但被接受，其概率记为<span class="math inline">\beta</span>，在显著性检验(仅控制弃真错误的概率)中不受控制。显然，应当将犯错后果最严重的假设作为检验假设，因为通过控制α可以来降低犯弃真错误的概率。</p>
<p><strong>(2)确定检验水准</strong><br>
检验水准<span class="math inline">\alpha</span>是指当检验假设为真时，检验统计量落在拒绝域的概率，亦即犯弃真错误的概率。<span class="math inline">\alpha</span>的取值一般为0.01、0.05、0.1等。在样本容量<span class="math inline">n</span>一定时，若减小弃真错误的概率，则会增大取伪错误的概率，增大样本容量可以同时降低两类错误的概率。<br>
拒绝域是指由显著性水平围成的区域，也称否定域。拒绝域之外称为接受域。如果检验统计量落入拒绝域，则拒绝检验假设，否则接受检验假设。<br>
左侧检验、双侧检验和右侧检验的拒绝域和接受域如 <a href="#fig-4.6" class="quarto-xref">图&nbsp;<span>4.7</span></a> 所示。</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-4.6" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/fig4.6.png" class="img-fluid figure-img" width="606">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.7: 三种检验方式下的拒绝域和接受域
</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>(3)选择检验方法并计算相应检验统计量</strong><br>
对不同类型的资料和不同的分析目的，选用适当的检验方法，并计算相应的检验统计量。</p>
<p><strong>(4)确定界值或计算</strong><span class="math inline">p</span>值<br>
根据设定的检验水准，计算拒绝域界值，或根据检验统计量计算或查表确定其对应的p值。</p>
<p><strong>(5)做出推断结论</strong><br>
比较<span class="math inline">\alpha</span>对应的界值和检验统计量对应的界值或<span class="math inline">p</span>值与<span class="math inline">\alpha</span>的关系(参照 <a href="#fig-4.6" class="quarto-xref">图&nbsp;<span>4.7</span></a> )来判断样本是否落入拒绝域，从而做出拒绝或接受H<sub>0</sub>的决策。</p>
<p>R中假设检验结果的显著性水平可根据星号(*)的有无和个数来判断：三个星号(***)表示<span class="math inline">p ≤ 0.001</span>，两个星号(**)表示<span class="math inline">0.001＜ p ≤ 0.01</span>，一个星号(*)表示<span class="math inline">0.01＜ p ≤ 0.05</span>。</p>
</section>
<section id="检验功效及其计算" class="level4" data-number="4.2.3.2">
<h4 data-number="4.2.3.2" class="anchored" data-anchor-id="检验功效及其计算"><span class="header-section-number">4.2.3.2</span> 检验功效及其计算</h4>
<p>检验功效或统计功效(statistical power)，也称为敏感性(sensitivity)，是指备择假设为真时拒绝检验假设的概率(<span class="math inline">1－\beta</span>)，即甄别本质差异的能力(如 <a href="#fig-4.7" class="quarto-xref">图&nbsp;<span>4.8</span></a> 所示)。在样本容量一定的前提下，<span class="math inline">\alpha</span>越大，<span class="math inline">\beta</span>越小，<span class="math inline">1－\beta</span>越大；样本容量<span class="math inline">n</span>越大，方差<span class="math inline">s^2</span>越小，则<span class="math inline">\beta</span>越小，<span class="math inline">1－\beta</span>越大。</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-4.7" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/fig4.7.png" class="img-fluid figure-img" width="346">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.8: α、1－α、β和1－β的关系
</figcaption>
</figure>
</div>
</div>
</div>
<p>在环境调查和实验中，重视检验水准<span class="math inline">\alpha</span>而忽视检验功效<span class="math inline">1－\beta</span>是最容易犯的错误，这会导致获取的样本量不足以甄别本质差异，从而增大犯取伪错误的概率。<code>power.t.test()</code>函数可计算用于<em>t</em>检验的样本特征：样本容量、效应值、检验水准、检验功效和总体标准差，提供其中任意四个参数值以推断余下一个参数值。</p>
<div id="exm-4.23" class="theorem example">
<p><span class="theorem-title"><strong>例 4.23</strong></span> 鱼肉PCB安全水平 ≤ 0.05mg/kg。如果真正浓度接近0.2 mg/kg，此时需要以较高概率甄别这种差异。如果现在有12个样本用于分析PCB浓度，如何估计识别平均浓度在危险水平0.2 mg/kg上的检验功效？反之，如果设定一个较高的检验功效(如0.85)，如何计算所需的样本容量？<br>
</p>
</div>
<p>解：假设<span class="math inline">\sigma=0.5</span>，<span class="math inline">\alpha=0.05</span>，计算检验功效<span class="math inline">1－\beta</span>：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">12</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fl">0.15</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fl">0.05</span></span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">=</span> <span class="fl">0.5</span></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a><span class="fu">power.t.test</span>(<span class="at">n =</span> n, <span class="at">delta =</span> d, <span class="at">sd =</span> s, </span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">sig.level =</span> a, </span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">type =</span> <span class="st">"one.sample"</span>,</span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">alternative =</span> <span class="st">"one.sided"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     One-sample t test power calculation 

              n = 12
          delta = 0.15
             sd = 0.5
      sig.level = 0.05
          power = 0.2517193
    alternative = one.sided</code></pre>
</div>
</div>
<p>结果表明检验功效只有0.25。<br>
若希望检验功效达到0.85，计算结果显示样本容量需要82个：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">power.t.test</span>(<span class="at">power =</span> <span class="fl">0.85</span>, <span class="at">delta =</span> d, <span class="at">sd =</span> s, </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">sig.level =</span> a,</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">type =</span> <span class="st">"one.sample"</span>, </span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">alternative =</span> <span class="st">"one.sided"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     One-sample t test power calculation 

              n = 81.25206
          delta = 0.15
             sd = 0.5
      sig.level = 0.05
          power = 0.85
    alternative = one.sided</code></pre>
</div>
</div>
<p><code>power.prop.test()</code>函数用于双样本比例假设检验的检验功效计算，<code>power.anova.test()</code>函数用于平衡单因素方差分析的检验功效计算。R包pwr提供了更多的功效分析功能(如 <a href="#tbl-4.1" class="quarto-xref">表&nbsp;<span>4.1</span></a> 所示)。</p>
<div class="cell">
<div id="tbl-4.1" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-4.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
表&nbsp;4.1: pwr包提供的功效分析函数
</figcaption>
<div aria-describedby="tbl-4.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell table table-sm table-striped small">
<colgroup>
<col style="width: 20%">
<col style="width: 79%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">函数</th>
<th style="text-align: left;">功能</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">pwr.2p.test</td>
<td style="text-align: left;">计算n相等的两比率检验功效(与power.prop.test相同)</td>
</tr>
<tr class="even">
<td style="text-align: left;">pwr.2p2n.test</td>
<td style="text-align: left;">计算n不相等的两比率检验功效</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pwr.anova.test</td>
<td style="text-align: left;">计算平衡单因素方差分析的检验功效(与power.anova.test相同)</td>
</tr>
<tr class="even">
<td style="text-align: left;">pwr.chisq.test</td>
<td style="text-align: left;">计算χ2检验功效</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pwr.f2.test</td>
<td style="text-align: left;">计算广义线性模型的检验功效</td>
</tr>
<tr class="even">
<td style="text-align: left;">pwr.norm.test</td>
<td style="text-align: left;">计算方差已知的正态分布均值的检验功效</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pwr.p.test</td>
<td style="text-align: left;">计算单样本比率的检验功效</td>
</tr>
<tr class="even">
<td style="text-align: left;">pwr.r.test</td>
<td style="text-align: left;">计算相关系数的检验功效</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pwr.t.test</td>
<td style="text-align: left;">计算均值t检验的功效(单样本、两样本、配对样本)</td>
</tr>
<tr class="even">
<td style="text-align: left;">pwr.t2n.test</td>
<td style="text-align: left;">计算n不等的双样本均值t检验的功效</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="单正态总体均值与方差的假设检验" class="level4" data-number="4.2.3.3">
<h4 data-number="4.2.3.3" class="anchored" data-anchor-id="单正态总体均值与方差的假设检验"><span class="header-section-number">4.2.3.3</span> 单正态总体均值与方差的假设检验</h4>
<p><strong>(1)单正态总体均值的假设检验</strong><br>
</p>
<p>当总体方差<span class="math inline">\sigma^2</span>已知时,根据以下公式计算<span class="math inline">z</span>统计量:</p>
<p><span id="eq-4.18"><span class="math display">
  z=\frac{\bar{x}-\mu_0}{\sigma/\sqrt{n}}
\tag{4.18}</span></span></p>
<p>此种情况下，直接用BSDA包中<code>z.test()</code>函数检验样本均值与总体均值的差异显著性，或采用<code>qnorm()</code>函数计算拒绝域界值，再与统计量<span class="math inline">z</span>进行比较以做出判断。双侧检验的拒绝域为<span class="math inline">|z|≥z_{\alpha/2}</span>，左侧检验的拒绝域为<span class="math inline">z≥-z_{\alpha}</span>，右侧检验的拒绝域为<span class="math inline">z≤z_{\alpha}</span>。</p>
<p>当总体方差<span class="math inline">\sigma^2</span>未知时,根据以下公式计算<span class="math inline">t</span>统计量:</p>
<p><span id="eq-4.19"><span class="math display">
  t=\frac{\bar{x}-\mu_0}{s/\sqrt{n}}
\tag{4.19}</span></span></p>
<p>此种情况下，直接利用<code>t.test()</code>函数检验样本均值与总体均值的差异显著性，或采用<code>qt()</code>函数计算拒绝域界值，再与统计量<span class="math inline">t</span>进行比较以做出判断。双侧检验的拒绝域为<span class="math inline">|t|≥t_{\alpha/2,n-1}</span>，左侧检验的拒绝域为<span class="math inline">t≥-t_{\alpha,n-1}</span>，右侧检验的拒绝域为<span class="math inline">t≤t_{\alpha,n-1}</span>。</p>
<p><strong>(2)单正态总体方差的假设检验</strong></p>
<p>当总体均值<span class="math inline">\mu</span>已知时,根据以下公式计算<span class="math inline">c</span>统计量:</p>
<p><span id="eq-4.20"><span class="math display">
  c=\frac{\sum_{i=1}^{n}(x_i-\mu)^2}{\sigma_0^2}
\tag{4.20}</span></span></p>
<p>此时，先用<code>qchisq()</code>函数计算拒绝域界值，再与统计量<span class="math inline">c</span>进行比较以做出判断。双侧检验的拒绝域为<span class="math inline">c≤\chi_{\alpha/2,n}^2</span>或<span class="math inline">c≥\chi_{1-\alpha/2,n}^2</span>，左侧检验的拒绝域为<span class="math inline">c≥\chi_{1-\alpha,n}^2</span>，右侧检验的拒绝域为<span class="math inline">c≤\chi_{\alpha,n}^2</span>。</p>
<p>当总体均值<span class="math inline">\mu</span>未知时,根据以下公式计算<span class="math inline">c</span>统计量:</p>
<p><span id="eq-4.21"><span class="math display">
  c=\frac{\sum_{i=1}^{n}(x_i-\bar{x})^2}{\sigma_0^2}
\tag{4.21}</span></span></p>
<p>此时，先用<code>qchisq()</code>函数计算拒绝域界值，再与统计量<span class="math inline">c</span>进行比较以做出判断。双侧检验的拒绝域为<span class="math inline">c≤\chi_{\alpha/2,n-1}^2</span>或<span class="math inline">c≥\chi_{1-\alpha/2,n-1}^2</span>，左侧检验的拒绝域为<span class="math inline">c≥\chi_{1-\alpha,n-1}^2</span>，右侧检验的拒绝域为<span class="math inline">c≤\chi_{\alpha,n-1}^2</span>。</p>
<div id="exm-4.24" class="theorem example">
<p><span class="theorem-title"><strong>例 4.24</strong></span> 在新建金属冶炼厂周围随机取10个土样，测镉含量平均值为0.212mg/kg，标准差为0.130mg/kg。已知该地以往土壤中镉背景值为0.057mg/kg。试分析目前土壤中镉含量是否较以往为高？</p>
</div>
<p>解：建立假设：H<sub>0</sub>：<span class="math inline">\mu</span>≤0.057，H<sub>1</sub>：<span class="math inline">\mu</span>＞0.057；<br>
右侧检验，总体方差未知，<span class="math inline">n&lt;30</span>，根据<span class="math inline">t</span>分布进行检验；计算统计量：<br>
</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">10</span>; x <span class="ot">=</span> <span class="fl">0.212</span>; s <span class="ot">=</span> <span class="fl">0.130</span>; m <span class="ot">=</span> <span class="fl">0.057</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>(<span class="at">t =</span> (x <span class="sc">-</span> m) <span class="sc">/</span> (s <span class="sc">/</span> <span class="fu">sqrt</span>(n)))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.770408</code></pre>
</div>
</div>
<p>确定<span class="math inline">p</span>值：自由度<span class="math inline">\nu=n-1=9</span>，用<code>qt()</code>函数计算<span class="math inline">1-\alpha=0.95</span>、<span class="math inline">1-\alpha=0.99</span>时的界值：<br>
</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qt</span>(<span class="fl">0.95</span>, <span class="at">df =</span> n <span class="sc">-</span> <span class="dv">1</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.833113</code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qt</span>(<span class="fl">0.99</span>, <span class="at">df =</span> n <span class="sc">-</span> <span class="dv">1</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.821438</code></pre>
</div>
</div>
<p>得出结论：比较<span class="math inline">t</span>统计量与拒绝域界值，拒绝H<sub>0</sub>，差异具有极显著性，认为目前土壤中镉含量比以往高。</p>
<p>如果给出了样本具体的观测值，则可用<code>t.test()</code>或BSDA包中的<code>z.test()</code>直接检验。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(x, <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">alternative =</span> <span class="fu">c</span>(<span class="st">"two.sided"</span>, <span class="st">"less"</span>, <span class="st">"greater"</span>),</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">mu =</span> <span class="dv">0</span>, <span class="at">paired =</span> <span class="cn">FALSE</span>, <span class="at">var.equal =</span> <span class="cn">FALSE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>, ...)</span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a><span class="fu">z.test</span>(x, <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">alternative =</span> <span class="fu">c</span>(<span class="st">"two.sided"</span>, <span class="st">"less"</span>, <span class="st">"greater"</span>),</span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">mu =</span> <span class="dv">0</span>, <span class="at">sigma.x =</span> <span class="cn">NULL</span>, <span class="at">sigma.y =</span> <span class="cn">NULL</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>其中：x和y为两个正态样本，默认为单样本检验；alternative为检验类型，分别是”two.side”(双侧)、“greater”(右侧)、“less”(右侧)；mu为总体均值；paired表示是否为配对样本<span class="math inline">t</span>检验；var.equal表示双样本检验中是否等方差假设；conf.level为<span class="math inline">(1-\alpha)</span>，即置信水平。在总体标准差已知时选用<code>z.test()</code>，未知时选用<code>t.test()</code>；在总体分布近似正态分布但样本量<span class="math inline">n＜30</span>时，选用<code>t.test()</code>，在<span class="math inline">n≥30</span>时选用<code>z.test()</code>。</p>
<div id="exm-4.25" class="theorem example">
<p><span class="theorem-title"><strong>例 4.25</strong></span> 根据某地环保规定，倾入河流废水中某有毒化学物质的平均含量不得超过3ppm。该地环境监测机构对沿河某工厂进行检查，测定20日入河废水中该物质的含量(ppm)为：<br>
3.1, 3.2, 3.3, 2.9, 3.5, 3.4, 2.5, 4.3, 3.0, 3.4, 2.9, 3.6, 3.2, 3.0, 2.7, 3.5, 2.9, 3.3, 3.3, 3.1<br>
假定废水中该有毒物含量服从正态分布，试在检验水准<span class="math inline">\alpha=0.05</span>时判断该工厂是否符合当地环保规定。<br>
</p>
</div>
<p>解：总体方差未知，<span class="math inline">n＜30</span>，采用<span class="math inline">t</span>检验。直接采用<code>t.test()</code>函数:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">3.1</span>,<span class="fl">3.2</span>,<span class="fl">3.3</span>,<span class="fl">2.9</span>,<span class="fl">3.5</span>,<span class="fl">3.4</span>,<span class="fl">2.5</span>,<span class="fl">4.3</span>,<span class="fl">3.0</span>,<span class="fl">3.4</span>,<span class="fl">2.9</span>,<span class="fl">3.6</span>,</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>      <span class="fl">3.2</span>,<span class="fl">3.0</span>,<span class="fl">2.7</span>,<span class="fl">3.5</span>,<span class="fl">2.9</span>,<span class="fl">3.3</span>,<span class="fl">3.3</span>,<span class="fl">3.1</span>)</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(x, <span class="at">alternative =</span> <span class="st">"greater"</span>, <span class="at">mu =</span> <span class="dv">3</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    One Sample t-test

data:  x
t = 2.4013, df = 19, p-value = 0.01337
alternative hypothesis: true mean is greater than 3
95 percent confidence interval:
 3.057383      Inf
sample estimates:
mean of x 
    3.205 </code></pre>
</div>
</div>
<p>检验结果表明在<span class="math inline">\alpha=0.05</span>时，拒绝检验假设，认为该工厂不符合当地环保规定。</p>
<div id="exm-4.26" class="theorem example">
<p><span class="theorem-title"><strong>例 4.26</strong></span> 对某检测仪器检测水体中污染物A的精度要求是方差不超过1.5ppm。现用该仪器对污染物A浓度为100ppm的标准溶液检测10次，结果为104.8, 99.4, 102.1, 100.1, 102.2, 99.3, 98.6, 101.2, 101.0, 102.1。试问该仪器检测精度是否达到了预定要求(<span class="math inline">\alpha=0.01</span>)。<br>
</p>
</div>
<p>解：建立假设：H<sub>0</sub>为<span class="math inline">\sigma^2≤1.5</span>，H<sub>1</sub>为<span class="math inline">\sigma^2＞1.5</span>;<br>
基于<span class="math inline">\chi^2</span>分布进行检验，根据前面的公式计算统计量：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">=</span> <span class="fl">1.5</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fl">0.01</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">104.8</span>, <span class="fl">99.4</span>, <span class="fl">102.1</span>, <span class="fl">100.1</span>, <span class="fl">102.2</span>, <span class="fl">99.3</span>, <span class="fl">98.6</span>, <span class="fl">101.2</span>, <span class="fl">101.0</span>, <span class="fl">102.1</span>)</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">length</span>(x)</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>chi <span class="ot">=</span> <span class="fu">sum</span>((x <span class="sc">-</span> mu)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> s<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>chi</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 18.64889</code></pre>
</div>
</div>
<p>计算拒绝域界值：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qchisq</span>(a <span class="sc">/</span> <span class="dv">2</span>, n)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.155856</code></pre>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qchisq</span>(<span class="dv">1</span> <span class="sc">-</span> a <span class="sc">/</span> <span class="dv">2</span>, n)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25.18818</code></pre>
</div>
</div>
<p>根据界值判断，检验统计量落入拒绝域。因此，该仪器检测精度未达预定的方差要求。</p>
</section>
<section id="双正态总体均值与方差的假设检验" class="level4" data-number="4.2.3.4">
<h4 data-number="4.2.3.4" class="anchored" data-anchor-id="双正态总体均值与方差的假设检验"><span class="header-section-number">4.2.3.4</span> 双正态总体均值与方差的假设检验</h4>
<p>对于分别来自总体<span class="math inline">N(\mu_1,\sigma_1^2)</span>和总体<span class="math inline">N(\mu_2,\sigma_2^2)</span>的两个独立样本<span class="math inline">X_1</span>(<span class="math inline">n_1</span>个观测值)和<span class="math inline">X_2</span>(<span class="math inline">n_2</span>个观测值)，其均值差异和方差差异的显著性检验方法分别如下：</p>
<p><strong>(1)双正态总体均值的显著性检验</strong><br>
当两个总体方差已知时,根据以下公式计算<span class="math inline">z</span>统计量:</p>
<p><span id="eq-4.22"><span class="math display">
  z=\frac{\bar{x_1}-\bar{x_2}}{\sqrt{{\sigma_1^2}/{n_1}+{\sigma_2^2}/{n_2}}}
\tag{4.22}</span></span></p>
<p>当两个总体方差未知但<span class="math inline">n_1</span>和<span class="math inline">n_2</span>均≥50时,根据以下公式计算<span class="math inline">z</span>统计量:</p>
<p><span id="eq-4.23"><span class="math display">
  z=\frac{\bar{x_1}-\bar{x_2}}{\sqrt{{s_1^2}/{n_1}+{s_2^2}/{n_2}}}
\tag{4.23}</span></span></p>
<p>上述两种情况下，均可利用<code>BSDA::z.test()</code>函数直接检验，或利用<code>qnorm()</code>函数计算拒绝 域界值，再与统计量<span class="math inline">z</span>进行比较以做出判断。双侧检验的拒绝域为<span class="math inline">|z|≥z_{\alpha/2}</span>，左侧检验的拒绝域为<span class="math inline">z≥-z_{\alpha}</span>，右侧检验的拒绝域为<span class="math inline">z≤z_{\alpha}</span>。</p>
<p>当两个总体方差未知但<span class="math inline">\sigma_1^2=\sigma_2^2</span>时,根据以下公式计算<span class="math inline">t</span>统计量:</p>
<p><span id="eq-4.24"><span class="math display">
  t=\frac{\bar{x_1}-\bar{x_2}}{s_w\sqrt{1/{n_1}+1/{n_2}}}
\tag{4.24}</span></span></p>
<p>式中<span class="math inline">s_w</span>见 <a href="#eq-4.9" class="quarto-xref">式&nbsp;<span>4.9</span></a> 。<br>
此时直接用<code>t.test(x1, x2, var.equal = TRUE)</code>进行检验。如果两个样本的观测值未知，则需要借助<code>qt()</code>函数计算拒绝域界值，与统计量<span class="math inline">t</span>进行比较以做出判断。双侧检验的拒绝域为<span class="math inline">|t|≥t_{\alpha/2,n_1+n_2-2}</span>，左侧检验的拒绝域为<span class="math inline">t≥-t_{\alpha,n_1+n_2-2}</span>，右侧检验的拒绝域为<span class="math inline">t≤t_{\alpha,n_1+n_2-2}</span>。</p>
<p>当两个总体方差未知但<span class="math inline">n_1=n_2=n</span>时,根据以下公式计算<span class="math inline">t</span>统计量:</p>
<p><span id="eq-4.25"><span class="math display">
  t=\frac{\bar{x_1}-\bar{x_2}}{s_z/\sqrt{n}}
\tag{4.25}</span></span></p>
<p>式中<span class="math inline">s_w</span>见 <a href="#eq-4.11" class="quarto-xref">式&nbsp;<span>4.11</span></a> 。<br>
此时直接用<code>t.test(x1, x2, paired = TRUE)</code>进行检验。如果两个样本的观测值未知，则需要借助<code>qt()</code>函数计算拒绝域界值，与统计量<span class="math inline">t</span>进行比较以做出判断。双侧检验的拒绝域为<span class="math inline">|t|≥t_{\alpha/2,n-1}</span>，左侧检验的拒绝域为<span class="math inline">t≥-t_{\alpha,n-1}</span>，右侧检验的拒绝域为<span class="math inline">t≤t_{\alpha,n-1}</span>。<br>
当两个总体方差未知但<span class="math inline">\sigma_1^2≠\sigma_2^2</span>时,根据以下公式计算<span class="math inline">t</span>统计量:</p>
<p><span id="eq-4.26"><span class="math display">
  t=\frac{\bar{x_1}-\bar{x_2}}{\sqrt{s_1^2/{n_1}+s_2^2/{n_2}}}
\tag{4.26}</span></span></p>
<p>此时直接用<code>t.test(x1, x2)</code>进行检验。如果两个样本的观测值未知，则需要借助<code>qt()</code>函数计算拒绝域界值，与统计量<span class="math inline">t</span>进行比较以做出判断。双侧检验的拒绝域为<span class="math inline">|t|≥t_{\alpha/2,\nu}</span>，左侧检验的拒绝域为<span class="math inline">t≥-t_{\alpha,\nu}</span>，右侧检验的拒绝域为<span class="math inline">t≤t_{\alpha,\nu}</span>。其中自由度<span class="math inline">\nu</span>的计算见 <a href="#eq-4.13" class="quarto-xref">式&nbsp;<span>4.13</span></a> 。<br>
</p>
<div id="exm-4.27" class="theorem example">
<p><span class="theorem-title"><strong>例 4.27</strong></span> 测得某河流原水(x)和清水(y)含砷量的结果如下所示，试问两组均值之间的差异有无显著性。<br>
x：0.020, 0.016, 0.016, 0.016, 0.016, 0.200, 0.135, 0.220, 0.220, 0.160, 0.220, 0.220<br>
y：0.008, 0.008, 0.008, 0.006, 0.006, 0.006, 0.005, 0.005, 0.007, 0.007, 0.006, 0.006<br>
</p>
</div>
<p>解：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.020</span>, <span class="fl">0.016</span>, <span class="fl">0.016</span>, <span class="fl">0.016</span>, <span class="fl">0.016</span>, <span class="fl">0.200</span>, <span class="fl">0.135</span>, <span class="fl">0.220</span>,</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.220</span>, <span class="fl">0.160</span>, <span class="fl">0.220</span>, <span class="fl">0.220</span>)  </span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.008</span>, <span class="fl">0.008</span>, <span class="fl">0.008</span>, <span class="fl">0.006</span>, <span class="fl">0.006</span>, <span class="fl">0.006</span>, <span class="fl">0.005</span>, <span class="fl">0.005</span>,</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.007</span>, <span class="fl">0.007</span>, <span class="fl">0.006</span>, <span class="fl">0.006</span>)</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(x, y)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  x and y
t = 4.1507, df = 11.003, p-value = 0.001614
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 0.0540609 0.1761058
sample estimates:
mean of x mean of y 
0.1215833 0.0065000 </code></pre>
</div>
</div>
<p>结果拒绝H<sub>0</sub>，即认为两个样本代表的总体均值具有差异显著性。</p>
<p><strong>(2)双正态总体方差的显著性检验</strong><br>
当两个总体均值已知时，按以下公式计算统计量：</p>
<p><span id="eq-4.27"><span class="math display">
  F=\frac{n_1\sum_{i=1}^{n_1}(x_{1,i}-\mu_1^2)^2}{n_2\sum_{i=1}^{n_2}(x_{2,i}-\mu_2^2)^2}
\tag{4.27}</span></span></p>
<p>此时，双侧检验的拒绝域为<span class="math inline">F≤F_{\alpha/2,n_1,n_2}</span>或<span class="math inline">F≥F_{1-\alpha/2,n_1,n_2}</span>，左侧检验的拒绝域为<span class="math inline">F≥F_{1-\alpha,n_1,n_2}</span>，右侧检验的拒绝域为<span class="math inline">F≤F_{\alpha,n_1,n_2}</span>。</p>
<p>当两个总体均值未知时，按以下公式计算统计量：</p>
<p><span id="eq-4.28"><span class="math display">
  F=\frac{s_1^2}{s_2^2}
\tag{4.28}</span></span></p>
<p>此时，双侧检验的拒绝域为<span class="math inline">F≤F_{\alpha/2,n_1-1,n_2-1}</span>或<span class="math inline">F≥F_{1-\alpha/2,n_1-1,n_2-1}</span>，左侧检验的拒绝域为<span class="math inline">F≥F_{1-\alpha,n_1-1,n_2-1}</span>，右侧检验的拒绝域为<span class="math inline">F≤F_{\alpha,n_1-1,n_2-1}</span>。</p>
<p>以上两种情况，均可利用<code>var.test()</code>函数直接检验，亦可通过<code>qf()</code>函数计算拒绝域界值，再与统计量<span class="math inline">F</span>比较以做出判断。</p>
<div id="exm-4.28" class="theorem example">
<p><span class="theorem-title"><strong>例 4.28</strong></span> x和y(均服从正态分布)分别为两种检测方法对某污染物标准溶液的重复检测结果：<br>
x: 20.5, 19.8, 19.0, 19.7, 20.1, 20.4, 20.0, 19.9<br>
y: 19.8, 20.7, 19.5, 20.8, 19.6, 20.4, 20.2<br>
试问两种检测方法的精度(方差)有无差异(<span class="math inline">\alpha=0.05</span>)。</p>
</div>
<p>解：直接采用<code>var.test()</code>函数计算：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">20.5</span>, <span class="fl">19.8</span>, <span class="fl">19.0</span>, <span class="fl">19.7</span>, <span class="fl">20.1</span>, <span class="fl">20.4</span>, <span class="fl">20.0</span>, <span class="fl">19.9</span>)</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">19.8</span>, <span class="fl">20.7</span>, <span class="fl">19.5</span>, <span class="fl">20.8</span>, <span class="fl">19.6</span>, <span class="fl">20.4</span>, <span class="fl">20.2</span>)</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="fu">var.test</span>(x, y)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    F test to compare two variances

data:  x and y
F = 0.79319, num df = 7, denom df = 6, p-value = 0.7608
alternative hypothesis: true ratio of variances is not equal to 1
95 percent confidence interval:
 0.1392675 4.0600387
sample estimates:
ratio of variances 
         0.7931937 </code></pre>
</div>
</div>
<p>检验结果接受H<sub>0</sub>，即两样本总体方差比等于1。<br>
采用公式计算：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>nx <span class="ot">=</span> <span class="fu">length</span>(x); ny <span class="ot">=</span> <span class="fu">length</span>(y)</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>ssx <span class="ot">=</span> <span class="fu">var</span>(x); ssy <span class="ot">=</span> <span class="fu">var</span>(y)</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算方差比统计量</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>(<span class="at">f =</span> ssx <span class="sc">/</span> ssy)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7931937</code></pre>
</div>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fl">0.05</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算右侧界值</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qf</span>(<span class="fl">0.025</span>, nx <span class="sc">-</span> <span class="dv">1</span>, ny <span class="sc">-</span> <span class="dv">1</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.195366</code></pre>
</div>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算左侧界值</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qf</span>(<span class="fl">0.975</span>, nx <span class="sc">-</span> <span class="dv">1</span>, ny <span class="sc">-</span> <span class="dv">1</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.69547</code></pre>
</div>
</div>
<p>统计量f的值落在接受域，与<code>var.test()</code>直接检验的结果一致，表明这两种检测方法的精度没有差异显著性。</p>
</section>
<section id="总体比率的假设检验" class="level4" data-number="4.2.3.5">
<h4 data-number="4.2.3.5" class="anchored" data-anchor-id="总体比率的假设检验"><span class="header-section-number">4.2.3.5</span> 总体比率的假设检验</h4>
<p>总体比率<span class="math inline">p</span>可视为伯努利分布(亦即0-1分布)<span class="math inline">B(1,p)</span>的参数。对于来自伯努利分布<span class="math inline">B(1,p)</span>的一个样本<span class="math inline">X(x_i, i=1~n)</span>，当<span class="math inline">np</span>与<span class="math inline">n(1-p)</span>均<span class="math inline">＞5</span>时，其总体比率<span class="math inline">p</span>与已知总体比率<span class="math inline">p_0</span>的假设检验可用<code>prop.test()</code>进行检验；当<span class="math inline">np</span>或<span class="math inline">n(1-p)≤5</span>时，则使用<code>binom.test()</code>进行检验。<code>prop.test()</code>基于近似计算，而<code>binom.test()</code>执行精确计算。对于来自伯努利分布<span class="math inline">B(1,p)</span>的两个独立样本<span class="math inline">X_1 (x_{1,i},i=1\sim n_1)</span>和<span class="math inline">X_2 (x_{2,i},i=1\sim n_2)</span>，其总体比率<span class="math inline">p_1</span>和<span class="math inline">p_2</span>的假设检验可使用<code>prop.test()</code>进行检验。</p>
<div id="exm-4.29" class="theorem example">
<p><span class="theorem-title"><strong>例 4.29</strong></span> 按规定，某工厂排放的污水超标率不超过8%为合格。对该厂排放污水取样210次检测，结果有23次超标，问抽样检测结果是否达到合格规定要求？</p>
</div>
<p>解：H<sub>0</sub>为<span class="math inline">p≤0.08</span>，H<sub>1</sub>为<span class="math inline">p＞0.08</span><br>
采用<code>prop.test()</code>检验：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">210</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="dv">23</span></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">=</span> <span class="fl">0.08</span> </span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.test</span>(x, n, <span class="at">p =</span> p0, <span class="at">alternative =</span> <span class="st">"greater"</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    1-sample proportions test with continuity correction

data:  x out of n, null probability p0
X-squared = 2.1021, df = 1, p-value = 0.07355
alternative hypothesis: true p is greater than 0.08
95 percent confidence interval:
 0.07690104 1.00000000
sample estimates:
        p 
0.1095238 </code></pre>
</div>
</div>
<p>采用`<code>binom.test()</code>检验：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">binom.test</span>(x, n, <span class="at">p =</span> p0, <span class="at">alternative =</span> <span class="st">"greater"</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Exact binomial test

data:  x and n
number of successes = 23, number of trials = 210, p-value = 0.07812
alternative hypothesis: true probability of success is greater than 0.08
95 percent confidence interval:
 0.07602032 1.00000000
sample estimates:
probability of success 
             0.1095238 </code></pre>
</div>
</div>
<p>以上两种检验方法的结果均未拒绝H<sub>0</sub>，因此认为检测结果达到合格规定。</p>
<div id="exm-4.30" class="theorem example">
<p><span class="theorem-title"><strong>例 4.30</strong></span> 2019年某单位为了调查工业三废对某河流水质的污染情况，对该河流枯水期和丰水期水体中汞含量进行了抽样检查：枯水期取样356个，超标15个；丰水期取样360个，超标62个。试问枯水期和丰水期汞含量超标情况是否相同？<br>
</p>
</div>
<p>解：H<sub>0</sub>为<span class="math inline">p_1=p_2</span>，H<sub>1</sub>为<span class="math inline">p_1≠p_2</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">62</span>)</span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">356</span>, <span class="dv">360</span>)</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.test</span>(x, n)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    2-sample test for equality of proportions with continuity correction

data:  x out of n
X-squared = 30.22, df = 1, p-value = 3.858e-08
alternative hypothesis: two.sided
95 percent confidence interval:
 -0.17711583 -0.08305896
sample estimates:
    prop 1     prop 2 
0.04213483 0.17222222 </code></pre>
</div>
</div>
<p>检验结果拒绝H<sub>0</sub>，因此认为枯水期和丰水期水体中汞含量超标情况不同，丰水期更严重。</p>
</section>
<section id="基于列联表资料的假设检验" class="level4" data-number="4.2.3.6">
<h4 data-number="4.2.3.6" class="anchored" data-anchor-id="基于列联表资料的假设检验"><span class="header-section-number">4.2.3.6</span> 基于列联表资料的假设检验</h4>
<p>列联表(contigency table)也称交叉表，用于整理离散型变量的分组频数，连续型变量可通过分区间统计频数实现离散化。其中一维列联表就是单变量的频数分布表，二维列联表是两个变量的交叉频数分布表，而两个二分类变量的2行×2列的列联表又称为四格表(如 <a href="#tbl-4.2" class="quarto-xref">表&nbsp;<span>4.2</span></a> 所示，表中<span class="math inline">a</span>、<span class="math inline">b</span>、<span class="math inline">c</span>、<span class="math inline">d</span>为实际频数，记为<span class="math inline">A</span>；括号中为对应的理论频数，记为<span class="math inline">T</span>)，因为其中四个单元格中的频数是核心数据。依此类推，三个及以上变量对应的为三维及更高维的列联表，也称为行列表。很多实际问题都可以转化为列联表形式的频数资料来进行分析。</p>
<div class="cell" data-layout-align="center">
<div id="tbl-4.2" class="cell quarto-float anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-4.2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
表&nbsp;4.2: 四格表资料形式
</figcaption>
<div aria-describedby="tbl-4.2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/tbl4.2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="374"></p>
</figure>
</div>
</div>
</div>
</figure>
</div>
</div>
<p>列联表资料的检验是通过样本的实际频数<span class="math inline">A</span>与理论频数<span class="math inline">T</span>计算偏离程度来研究变量是否独立(独立性检验)、是否一致(齐性检验)等问题，常用的检验方法有Pearson<span class="math inline">\chi^2</span>检验、Fisher精确检验、McNemar检验等。一般而言，当样本量<span class="math inline">n≥40</span>且所有理论频数<span class="math inline">T≥5</span>时，采用Pearson<span class="math inline">\chi^2</span>检验(<code>chisq.test()</code>函数，设置参数correct=FALSE)；当样本量<span class="math inline">n≥40</span>但<span class="math inline">1≤T＜5</span>时，用带Yates连续性修正的<span class="math inline">\chi^2</span>检验(<code>chisq.test()</code>函数，默认参数correct=TRUE)；当样本量<span class="math inline">n＜40</span>，或理论频数<span class="math inline">T＜1</span>时，或<span class="math inline">\chi^2</span>检验检验结果表明<span class="math inline">p≈\alpha</span>(检验水准)，应采用Fisher精确检验(<code>fisher.test()</code>函数)；配对的二维列联表资料采用McNemar检验(<code>mcnemar.test()</code>函数)；三维列联表资料采用Cochran-Mantel-Haenszel<span class="math inline">\chi^2</span>检验(<code>mantelhaen.test()</code>函数)。</p>
<p><strong>(1)列联表资料的齐性检验</strong><br>
齐性检验是检验多个总体在某个变量的各个类别上的分布特征是否相同，例如不同季节的湖水总氮等污染物含量是否一致，不同功能区的土壤重金属含量是否一致等。多总体比率的差异显著性检验，可以转化为列联表资料，再应用Pearson<span class="math inline">\chi^2</span>检验方法执行齐性检验。</p>
<div id="exm-4.31" class="theorem example">
<p><span class="theorem-title"><strong>例 4.31</strong></span> 将 <a href="#exm-4.30" class="quarto-xref">例&nbsp;<span>4.30</span></a> 的数据改成四格表资料，如下所示：</p>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/tbl-exm-4.31.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="306"></p>
</figure>
</div>
</div>
</div>
<p>解：H<sub>0</sub>为<span class="math inline">p_1=p_2</span>，H<sub>1</sub>为<span class="math inline">p_1≠p_2</span>；</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>mt <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">62</span>, <span class="dv">341</span>, <span class="dv">298</span>), <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="st">"分组"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"枯水期"</span>, <span class="st">"丰水期"</span>),</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"频数"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"超标"</span>, <span class="st">"不超标"</span>)))</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(mt, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  mt
X-squared = 31.561, df = 1, p-value = 1.933e-08</code></pre>
</div>
</div>
<p>检验结果与 <a href="#exm-4.30" class="quarto-xref">例&nbsp;<span>4.30</span></a> 一致，拒绝H<sub>0</sub>。</p>
<p>采用带Yates连续性修正的<span class="math inline">\chi^2</span>检验，得到的<span class="math inline">p</span>值更大，即检验结果更保守，不易犯弃真错误。Fisher精确经验法基于超几何分布，特别适用于单元频数小的四格表和行列表资料。</p>
<div id="exm-4.32" class="theorem example">
<p><span class="theorem-title"><strong>例 4.32</strong></span> 某市工业区和居民区土壤铬含量超标和不超标结果如下表所示，试问两个区域的超标率差异有无显著性意义？</p>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/tbl-exm-4.32.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="261"></p>
</figure>
</div>
</div>
</div>
<p>解：H<sub>0</sub>为<span class="math inline">p_1=p_2</span>，H<sub>1</sub>为<span class="math inline">p_1≠p_2</span><br>
由于有实际频数和理论频数小于5，先采用带Yates连续性修正的<span class="math inline">\chi^2</span>检验：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>mt <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">22</span>, <span class="dv">10</span>, <span class="dv">2</span>, <span class="dv">6</span>), <span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="st">"分类"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"工业区"</span>, <span class="st">"居民区"</span>),</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"超标"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"超标"</span>, <span class="st">"不超标"</span>)))</span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(mt)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in chisq.test(mt): Chi-squared approximation may be incorrect</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test with Yates' continuity correction

data:  mt
X-squared = 3.444, df = 1, p-value = 0.06348</code></pre>
</div>
</div>
<p>检验结果发现接受H<sub>0</sub>，但<span class="math inline">p</span>接近检验水准<span class="math inline">\alpha</span>，改用Fisher精确检验：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fisher.test</span>(mt)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Fisher's Exact Test for Count Data

data:  mt
p-value = 0.04204
alternative hypothesis: true odds ratio is not equal to 1
95 percent confidence interval:
  0.9160508 73.9370368
sample estimates:
odds ratio 
  6.266107 </code></pre>
</div>
</div>
<p>Fisher精确检验结果结果拒绝H<sub>0</sub>。</p>
<p><strong>(2)列联表资料的独立性检验</strong><br>
列联表资料的独立性检验是检验两个变量是否独立，亦即是否存在相关性，R中采用<span class="math inline">\chi^2</span>检验方法，即<code>chisq.test()</code>函数。由于该函数亦可用于方差齐性检验，这让人容易混淆对独立性检验与方差齐性检验的理解，二者实际上存在本质区别：齐性检验是对不同总体分别抽样，而独立性检验是对同一总体进行抽样再分类；齐性检验基于各总体在某个变量不同分类上是否具有相同概率的假设，而独立性检验是基于事件独立的假设；齐性检验中的变量关系不对等，可分为自变量和因变量，而独立性检验中的变量关系平等。</p>
<div id="exm-4.33" class="theorem example">
<p><span class="theorem-title"><strong>例 4.33</strong></span> 某地水源受氟污染，为掌握氟污染对人体健康的危害，有关机构在2010年对该地区1176人进行了调查，发现802人患有釉斑症，各级发病程度与饮用水氟含量的频数资料如下表所示。试问饮用水氟含量与釉斑症的发病程度的有无相关性(独立性检验)？</p>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/tbl-exm-4.33.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="456"></p>
</figure>
</div>
</div>
</div>
<p>解：H<sub>0</sub>为饮用水氟含量与釉斑病发病程度无关，H<sub>1</sub>为饮用水氟含量与釉斑病发病程度有关；</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>mt <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">39</span>, <span class="dv">87</span>, <span class="dv">87</span>, <span class="dv">33</span>, <span class="dv">58</span>, <span class="dv">75</span>, <span class="dv">157</span>, <span class="dv">66</span>, <span class="dv">14</span>, <span class="dv">28</span>, <span class="dv">69</span>, <span class="dv">89</span>),</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="st">"氟含量"</span> <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"C"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>),</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"发病程度"</span><span class="ot">=</span><span class="fu">c</span>(<span class="st">"初显症"</span>,<span class="st">"1度"</span>,<span class="st">"2~3度"</span>)))</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(mt)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  mt
X-squared = 88.424, df = 6, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<p>检验结果拒绝H<sub>0</sub>，表明饮用水氟含量与釉斑病发病程度有关。</p>
<p><strong>(3)配对列联表资料的McNemar检验</strong><br>
对于配对的二维列联表资料，如每一对实验对象给予不同的处理，或同一实验对象先后给予不同的处理，McNemar检验通过频数变化来检验一致性，R中函数为<code>mcnemar.test()</code>。</p>
<div id="exm-4.34" class="theorem example">
<p><span class="theorem-title"><strong>例 4.34</strong></span> 将28份微生物样品按相同条件分别接种于甲乙两种培养基，“+”表示能够生长，“-”表示不能生长，最终接种培养结果整理汇总于下表中。试问两种培养基效果是否一致？</p>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./images/tbl-exm-4.34.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="260"></p>
</figure>
</div>
</div>
</div>
<p>解：H<sub>0</sub>为两种培养基效果一致，H<sub>1</sub>为两种培养基效果不一致；</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>mt <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">1</span>, <span class="dv">9</span>, <span class="dv">7</span>), <span class="at">nrow=</span><span class="dv">2</span>,</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="st">"乙培养基"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"阳性"</span>, <span class="st">"阴性"</span>),</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>                            <span class="st">"甲培养基"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"阳性"</span>, <span class="st">"阴性"</span>)))</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mcnemar.test</span>(mt, <span class="at">correct =</span> <span class="cn">TRUE</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    McNemar's Chi-squared test with continuity correction

data:  mt
McNemar's chi-squared = 4.9, df = 1, p-value = 0.02686</code></pre>
</div>
</div>
<p>结果拒绝H<sub>0</sub>，表明两种培养基效果不一致，乙培养基的效果优于甲培养基。</p>
</section>
<section id="分布函数的拟合优度检验" class="level4" data-number="4.2.3.7">
<h4 data-number="4.2.3.7" class="anchored" data-anchor-id="分布函数的拟合优度检验"><span class="header-section-number">4.2.3.7</span> 分布函数的拟合优度检验</h4>
<p>拟合优度(goodness-of-fit)检验用于检验样本所在总体的分布与某一理论分布是否一致。令某总体的分布函数为<span class="math inline">F(x)</span>且未知，<span class="math inline">X</span>为来自该总体的一个样本，<span class="math inline">x_i(i=1\sim n)</span>为观测值。则该类问题的假设为：H<sub>0</sub>为<span class="math inline">F(x)=F_0(x,\theta)</span>，H<sub>1</sub>为<span class="math inline">F(x)≠F_0(x,\theta)</span>，其中<span class="math inline">\theta</span>是分布的未知参数，在检验之前，需要对其进行估计。</p>
<p><strong>(1)Shapiro-Wilk正态性检验</strong><br>
该方法也称<em>W</em>检验，用于检验样本是否来自于正态总体，对异常值敏感，适用于小样本。R中执行该检验的函数为<code>shapiro.test()</code>。</p>
<div id="exm-4.35" class="theorem example">
<p><span class="theorem-title"><strong>例 4.35</strong></span> Shapiro-Wilk正态性检验示例。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">6</span>, <span class="at">sd =</span> <span class="dv">2</span>)    <span class="co"># 构造正态分布样本</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  x
W = 0.99086, p-value = 0.7339</code></pre>
</div>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">100</span>, <span class="at">min =</span> <span class="dv">4</span>, <span class="at">max =</span> <span class="dv">8</span>)    <span class="co"># 构造均匀分布样本</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(y)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  y
W = 0.97107, p-value = 0.0267</code></pre>
</div>
</div>
<p>以上代码演示了<code>shapiro.test()</code>函数对不同分布样本的检验，使用简单，检验结果正确。</p>
<p><strong>(2)Kolmogorov-Smirnov检验</strong><br>
该方法简称<em>K-S</em>检验，用于检验样本是否来自某一理论分布，适用于连续型随机变量分布的检验问题。该方法相对稳健，对异常值具有较好的抗干扰能力。R中执行该检验的函数为<code>ks.test()</code>。</p>
<div id="exm-4.36" class="theorem example">
<p><span class="theorem-title"><strong>例 4.36</strong></span> Kolmogorov-Smirnov检验示例。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">6</span>, <span class="at">sd =</span> <span class="dv">2</span>)    <span class="co"># 构造正态分布样本</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">80</span>, <span class="at">min =</span> <span class="dv">2</span>, <span class="at">max =</span> <span class="dv">8</span>)    <span class="co"># 构造均匀分布样本</span></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ks.test</span>(x, <span class="st">"pnorm"</span>, <span class="dv">6</span>, <span class="dv">2</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Asymptotic one-sample Kolmogorov-Smirnov test

data:  x
D = 0.057828, p-value = 0.8917
alternative hypothesis: two-sided</code></pre>
</div>
</div>
<p>检验结果接受H<sub>0</sub>，即x来自均值为6、方差为2的正态总体。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ks.test</span>(x, <span class="st">"pnorm"</span>, <span class="dv">5</span>, <span class="dv">2</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Asymptotic one-sample Kolmogorov-Smirnov test

data:  x
D = 0.23281, p-value = 3.92e-05
alternative hypothesis: two-sided</code></pre>
</div>
</div>
<p>检验结果拒绝H<sub>0</sub>，即x不是来自均值为5、方差为2的正态总体。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ks.test</span>(x, y)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Exact two-sample Kolmogorov-Smirnov test

data:  x and y
D = 0.2125, p-value = 0.03114
alternative hypothesis: two-sided</code></pre>
</div>
</div>
<p>检验结果表明x和y不是来自同一连续型随机变量分布。</p>
<p><strong>(3)总体分布的Pearson</strong><span class="math inline">\chi^2</span>检验<br>
Pearson<span class="math inline">\chi^2</span>检验是最常用的适用于所有理论分布的拟合优度检验方法。可用<code>chisq.test()</code>函数执行该检验，使用时需指定与样本(参数x不能包含负数)等长度的概率向量(参数p，总和必须为1)。</p>
<div id="exm-4.37" class="theorem example">
<p><span class="theorem-title"><strong>例 4.37</strong></span> 总体分布的Pearson χ2检验示例。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">10</span>, <span class="at">min =</span> <span class="dv">2</span>, <span class="at">max =</span> <span class="dv">8</span>)    <span class="co"># 构造均匀分布样本</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="fu">length</span>(x), <span class="fu">length</span>(x))</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(x, <span class="at">p =</span> p0)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Chi-squared test for given probabilities

data:  x
X-squared = 6.2747, df = 9, p-value = 0.7121</code></pre>
</div>
</div>
<p>检验结果表明样本x来自均匀分布总体。</p>
</section>
<section id="其他检验方法" class="level4" data-number="4.2.3.8">
<h4 data-number="4.2.3.8" class="anchored" data-anchor-id="其他检验方法"><span class="header-section-number">4.2.3.8</span> 其他检验方法</h4>
<p><strong>(1)游程检验</strong><br>
游程检验亦称“连贯检验”，是一种非参数检验方法，用于单个样本的随机性或两个总体的分布是否相同。R包tseries中的<code>runs.test()</code>函数可用于二分类或二进制序列的随机性检验。</p>
<p><strong>(2)白噪声检验</strong><br>
白噪声检验也称纯随机性检验，用于检验序列数据是否为纯随机序列，常用于时间序列分析、模型预测残差分析等。R中<code>Box.test()</code>函数用于执行白噪声检验。</p>
<p><strong>(3)Wilcoxon秩和检验和Wilcoxon符号秩检验</strong><br>
秩(rank)是样本中变量观测值从小到达排序后的次序号。Wilcoxon秩和检验和Wilcoxon符号秩检验都是利用样本数据的秩信息进行检验，属于非参数检验方法，用于不能满足t检验的场景，如总体分布不是正态分布，或总体分布类型未知。R中<code>wilcox.test()</code>函数执行这两种检验，其中参数paired默认为FALSE，执行Wilcoxon秩和检验；当paired设置为TRUE，则执行配对资料的Wilcoxon符号秩检验。<code>pairwise.wilcox.test()</code>函数执行两两比较的秩和检验和符号秩检验。</p>
<p><strong>(4)Kruskal-Wallis秩和检验(K-W检验)</strong><br>
K-W检验是用于三个及三个以上独立样本是否来自相同分布的非参数检验方法，前提要求总体是连续型分布，除位置参数不同外，分布相似。R中<code>kruskal.test()</code>函数执行该检验。</p>
<p><strong>(5)Friedman检验</strong><br>
Friedman检验也是检验三个及三个以上独立样本是否来自相同分布的非参数检验方法，但要求样本为配对资料。R中<code>friedman.test()</code>函数执行该检验。</p>
<p><strong>(6)Bartlett、Levene及Fligner-Killeen方差齐性检验</strong><br>
三者都是多样本方差齐性检验的方法，Bartlett方法为参数检验方法，用于正态分布数据，R中函数为<code>bartlett.test()</code>；Levene方法是非参数检验方法，可用于非正态分布数据，R中函数为car包中的<code>leveneTest()</code>函数；Fligner-Killeen方法也是非参数检验方法，R中函数为<code>fligner.test()</code>。</p>
<p>R及很多R包提供了针对各种场景下的假设检验函数，具体使用可根据需要查询相关函数或R包的使用方法。</p>
</section>
<section id="方差分析" class="level4" data-number="4.2.3.9">
<h4 data-number="4.2.3.9" class="anchored" data-anchor-id="方差分析"><span class="header-section-number">4.2.3.9</span> 方差分析</h4>
<p>在环境科学与工程研究工作中，经常需要同时对三个及三个以上的样本均值进行比较，如比较不同工艺去除污染物的效果，比较不同污染物的毒性等，比较不同季节大气中某种污染物的含量等。这里研究的工艺、污染物种类、污染物、季节即为因素(也称为控制变量，)，因素所处的状态称为水平，而研究者感兴趣的污染物去除效果、毒性、含量称为观测变量或研究变量。应用t检验分析多样本均值差异的显著性需要执行很多次，且容易增大分析误差，而应用方差分析(F检验法)可简化分析步骤。除此以外，方差分析还有很多用途，如分析多个因素之间的交互作用、回归模型的显著性检验等。</p>
<p>方差分析的前提要求是样本必须满足独立性、正态性和方差齐性。独立性是指各样本来自相互独立的随机总体，正态性是指各样本均来自正态总体，方差齐性是指各样本对应总体的方差相同。方差分析的基本思想是把全部观测值的总变异，按因素分组进行分析，计算每个因素对总变异的贡献，从而判定因素的重要性。例如，在单因素的完全随机设计的实验资料中，总变异可分为组内变异和组间变异；在配伍组设计的资料中，总变异可分为处理组间变异、配伍组间变异及误差三部分；在2×2析因设计资料中，总变异可分为两个因素的两个组间变异、两因素交互作用及误差四部分。</p>
<p>R中执行方差分析的函数为<code>aov()</code>，该函数的形式如下：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aov</span>(formula, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">projections =</span> <span class="cn">FALSE</span>, <span class="at">qr =</span> <span class="cn">TRUE</span>,</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">contrasts =</span> <span class="cn">NULL</span>, ...)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>formula是一个用公式指定的模型，如”y ~ x”，“y ~ a + b + c”，“y ~ a + b + a:b”等。其中常用的符号及其意义如 <a href="#tbl-4.3" class="quarto-xref">表&nbsp;<span>4.3</span></a> 所示。data是包含所有变量的数据框。projections为逻辑值，指定是否返回投影。qr为逻辑值，指定是否返回QR分解结果。contrasts是用于公式中某些因素的对比列表。…是传递给线性模型<code>lm()</code>函数的其他参数。</p>
<div class="cell">
<div id="tbl-4.3" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-4.3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
表&nbsp;4.3: R中formula中常用的符号及其意义
</figcaption>
<div aria-describedby="tbl-4.3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell table table-sm table-striped small">
<colgroup>
<col style="width: 5%">
<col style="width: 94%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">符号</th>
<th style="text-align: left;">含义</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">~</td>
<td style="text-align: left;">左边为因变量，右边为自变量。例如通过a、b和c预测y，代码为y ~ a + b + c</td>
</tr>
<tr class="even">
<td style="text-align: left;">+</td>
<td style="text-align: left;">分隔自变量</td>
</tr>
<tr class="odd">
<td style="text-align: left;">:</td>
<td style="text-align: left;">表示自变量的交互项。例如通过a、b及其交互项预测y，代码为y ~ a + b + a:b</td>
</tr>
<tr class="even">
<td style="text-align: left;">*</td>
<td style="text-align: left;">表示所有可能交互项的简洁方式。例如y ~ a * b * c等价于y ~ a + b + c + a:b + b:c + c:a</td>
</tr>
<tr class="odd">
<td style="text-align: left;">^</td>
<td style="text-align: left;">表示交互项达到某个次数。例如y ~ (a + b + c)^2等价于y ~ (a + b + c) * (a + b + c)</td>
</tr>
<tr class="even">
<td style="text-align: left;">.</td>
<td style="text-align: left;">点号，表示包含除因变量外的所有变量。例如数据包含变量y、a、b和c，代码y ~ . 等价于y ~ a + b + c</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-</td>
<td style="text-align: left;">表示从等式中移除某个变量。例如y ~ (a + b + c)^2 – a:b等价于y ~ a + b + c + b:c + c:a</td>
</tr>
<tr class="even">
<td style="text-align: left;">%in%</td>
<td style="text-align: left;">表示其左侧项嵌套如右侧项中。如y ~ a + b %in% a等价于y ~ a + a:b</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-1或+0</td>
<td style="text-align: left;">删除截距项。例如y ~ a - 1或y ~ a + 0，强制直线方程通过原点</td>
</tr>
<tr class="even">
<td style="text-align: left;">函数I()</td>
<td style="text-align: left;">避免公式中算术运算符和符号运算符产生混淆。例如y ~ a + (b + c)^2等价于y ~ a + b + c + b:c；相反, y ~ a + I((b + c)^2)等价于y ~ a + h，h是b与c之和的平方</td>
</tr>
<tr class="odd">
<td style="text-align: left;">函数引用</td>
<td style="text-align: left;">可以在表达式中用的数学函数。例如log(y) ~ a + b + c表示通过a、b和c来预测log(y)</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p><strong>(1)单因素方差分析(one-way ANOVA)</strong><br>
单因素方差分析就是研究一个因素的多个水平对观测变量是否产生显著性影响。</p>
<div id="exm-4.38" class="theorem example">
<p><span class="theorem-title"><strong>例 4.38</strong></span> 某湖不同季节湖水中氯化物含量(mg/L)监测结果如下所示。试问不同季节湖水的氯化物含量的差异有无显著意义？<br>
春：22.6, 22.8, 21.0, 16.9, 24.0, 21.9, 21.5, 21.2<br>
夏：19.1, 22.8, 24.5, 18.0, 15.2, 18.4, 20.1, 21.5<br>
秋：18.9, 13.6, 17.2, 15.1, 16.6, 14.2, 16.7, 19.6<br>
冬：19.0, 16.9, 17.6, 14.8, 13.1, 16.9, 16.2, 14.8<br>
</p>
</div>
<p>解：全部32个观测值之间的总变异包括了季节的影响以及随机误差；4个季节均值之间的差异是组间变异，反映了季节对湖水氯化物含量的可能影响，但也有随机误差的贡献；每个季节内8个观测值之间的差异是组内变异，与季节无关，反映的是随机误差的影响。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 宽表</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>  春 <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">22.6</span>, <span class="fl">22.8</span>, <span class="fl">21.0</span>, <span class="fl">16.9</span>, <span class="fl">24.0</span>, <span class="fl">21.9</span>, <span class="fl">21.5</span>, <span class="fl">21.2</span>),</span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>  夏 <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">19.1</span>, <span class="fl">22.8</span>, <span class="fl">24.5</span>, <span class="fl">18.0</span>, <span class="fl">15.2</span>, <span class="fl">18.4</span>, <span class="fl">20.1</span>, <span class="fl">21.5</span>),</span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>  秋 <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">18.9</span>, <span class="fl">13.6</span>, <span class="fl">17.2</span>, <span class="fl">15.1</span>, <span class="fl">16.6</span>, <span class="fl">14.2</span>, <span class="fl">16.7</span>, <span class="fl">19.6</span>),</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>  冬 <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">19.0</span>, <span class="fl">16.9</span>, <span class="fl">17.6</span>, <span class="fl">14.8</span>, <span class="fl">13.1</span>, <span class="fl">16.9</span>, <span class="fl">16.2</span>, <span class="fl">14.8</span>)</span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 转换为长表</span></span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb191-12"><a href="#cb191-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"season"</span>,</span>
<span id="cb191-13"><a href="#cb191-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"conc"</span>)</span>
<span id="cb191-14"><a href="#cb191-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-15"><a href="#cb191-15" aria-hidden="true" tabindex="-1"></a>ans <span class="ot">=</span> <span class="fu">aov</span>(conc <span class="sc">~</span> season, <span class="at">data =</span> df)</span>
<span id="cb191-16"><a href="#cb191-16" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ans)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value   Pr(&gt;F)    
season       3  164.3   54.77    10.4 9.06e-05 ***
Residuals   28  147.4    5.26                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>由结果可知，季节因素对氯化物浓度具有显著影响。<br>
当不满足方差齐性条件时(可用<code>bartlett.test()</code>检验)，使用<code>oneway.test()</code>函数执行方差分析：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">oneway.test</span>(conc <span class="sc">~</span> season, <span class="at">data =</span> df)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    One-way analysis of means (not assuming equal variances)

data:  conc and season
F = 11.423, num df = 3.00, denom df = 15.41, p-value = 0.0003383</code></pre>
</div>
</div>
<p>结果仍然表明季节对氯化物浓度具有显著影响。<br>
当不满足正态性(可用<code>shapiro.test()</code>检验)和方差齐性(可用<code>car::leveneTest()</code>检验)时，使用<code>kruskal.test()</code>函数：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kruskal.test</span>(conc <span class="sc">~</span> season, <span class="at">data =</span> df)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Kruskal-Wallis rank sum test

data:  conc by season
Kruskal-Wallis chi-squared = 16.399, df = 3, p-value = 0.0009392</code></pre>
</div>
</div>
<p>结果也表明季节对氯化物浓度具有显著影响。</p>
<p><strong>(2)双因素方差分析(two-way ANOVA)</strong><br>
双因素方差分析用于研究两个因素对观测变量有无显著性影响，包括两种类型：不考虑两个因素间的交互作用和考虑两个因素间的交互作用。交互作用是指两个因素存在联合作用，表现为相互促进或相互制约。如果两个因素对观测变量的影响是独立的，不需要考虑交互作用；如果两个因素对观测变量的影响不是独立的，则需要考虑交互作用。开展考虑因素交互作用的方差分析，要求两个因素的各个水平组合下有重复实验观测值。</p>
<div id="exm-4.39" class="theorem example">
<p><span class="theorem-title"><strong>例 4.39</strong></span> 某市2016-2017年不同地点不同季节的大气中飘尘浓度(mg/m3)日均值如下表所示：</p>
</div>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">地点</th>
<th style="text-align: center;">春</th>
<th style="text-align: center;">夏</th>
<th style="text-align: center;">秋</th>
<th style="text-align: center;">冬</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">A</td>
<td style="text-align: center;">0.614</td>
<td style="text-align: center;">0.475</td>
<td style="text-align: center;">0.667</td>
<td style="text-align: center;">1.150</td>
</tr>
<tr class="even">
<td style="text-align: center;">B</td>
<td style="text-align: center;">0.620</td>
<td style="text-align: center;">0.420</td>
<td style="text-align: center;">0.880</td>
<td style="text-align: center;">1.200</td>
</tr>
<tr class="odd">
<td style="text-align: center;">C</td>
<td style="text-align: center;">0.379</td>
<td style="text-align: center;">0.200</td>
<td style="text-align: center;">0.540</td>
<td style="text-align: center;">0.940</td>
</tr>
</tbody>
</table>
<p>试推断地点和季节两个因素对飘尘浓度有无显著影响。</p>
<p>解：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>  地点 <span class="ot">=</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>],</span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>  春   <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.614</span>, <span class="fl">0.620</span>, <span class="fl">0.379</span>),</span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>  夏   <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.475</span>, <span class="fl">0.420</span>, <span class="fl">0.200</span>),</span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a>  秋   <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.667</span>, <span class="fl">0.880</span>, <span class="fl">0.540</span>),</span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a>  冬   <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">1.150</span>, <span class="fl">1.200</span>, <span class="fl">0.940</span>)</span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb197-9"><a href="#cb197-9" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb197-10"><a href="#cb197-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">names_to =</span> <span class="st">"季节"</span>, <span class="at">values_to =</span> <span class="st">"飘尘浓度"</span>)</span>
<span id="cb197-11"><a href="#cb197-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb197-12"><a href="#cb197-12" aria-hidden="true" tabindex="-1"></a>ans <span class="ot">=</span> <span class="fu">aov</span>(飘尘浓度 <span class="sc">~</span> 季节 <span class="sc">+</span> 地点, <span class="at">data =</span> df)</span>
<span id="cb197-13"><a href="#cb197-13" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ans)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value   Pr(&gt;F)    
季节         3 0.8796 0.29318   88.76 2.32e-05 ***
地点         2 0.1574 0.07871   23.83   0.0014 ** 
Residuals    6 0.0198 0.00330                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>结果表明季节和地点两个因素都对飘尘浓度具有极显著影响，其中季节的影响大于地点的影响。</p>
<div id="exm-4.40" class="theorem example">
<p><span class="theorem-title"><strong>例 4.40</strong></span> 2015-2016年不同城市不同季节PM<sub>2.5</sub>浓度(μg/m^3)月均值如下表所示。试推断城市和季节两个因素及二者交互项对PM<sub>2.5</sub>浓度有无显著影响(假定数据符合正态性、独立性和方差齐性要求)。</p>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="./images/tbl-exm-4.40.png" class="img-fluid figure-img" style="width:120.0%"></p>
</figure>
</div>
</div>
</div>
<p>解：将数据整理成csv格式数据文件(本例中文件名为PM2.5-for-annova.csv，编码为UTF-8)，列名分别为pm25、city、month和season。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">=</span> <span class="st">"./data/PM2.5-for-anova.csv"</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">read_csv</span>(filename, <span class="at">col_names =</span> <span class="cn">TRUE</span>, <span class="at">col_types =</span> <span class="st">"nfff"</span>, </span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">"UTF-8"</span>))</span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>ans <span class="ot">=</span> <span class="fu">aov</span>(pm25 <span class="sc">~</span> city <span class="sc">*</span> season, <span class="at">data =</span> df)</span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(ans)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value   Pr(&gt;F)    
city         5  22497    4499  13.436 3.34e-08 ***
season       3  10894    3631  10.845 1.48e-05 ***
city:season 15   3293     220   0.656    0.813    
Residuals   48  16073     335                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>检验结果表明城市和季节两个因素对PM<sub>2.5</sub>浓度具有显著影响，但二者没有交互作用。</p>
<p>当数据不满足正态性和方差齐性条件时，可利用R包rcompanion提供的<code>scheirerRayHare()</code>函数执行Scheirer-Ray-Hare非参数检验：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rcompanion)</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scheirerRayHare</span>(pm25 <span class="sc">~</span> city <span class="sc">*</span> season, <span class="at">data =</span> df)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
DV:  pm25 
Observations:  72 
D:  0.9992765 
MS total:  438 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>            Df  Sum Sq      H p.value
city         5 17035.6 38.922 0.00000
season       3  5232.4 11.955 0.00754
city:season 15  2859.1  6.532 0.96935
Residuals   48  5948.3               </code></pre>
</div>
</div>
<p>以上数据集中季节变量中的3个月份可视为三次重复。如果是非重复区组设计实验得到的数据，可用<code>friedman.test()</code>进行方差分析。</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 3
# Groups:   season [4]
   season city   pm25
   &lt;fct&gt;  &lt;fct&gt; &lt;dbl&gt;
 1 春     北京   70.7
 2 春     重庆   45.7
 3 春     济南   77.3
 4 春     合肥   61  
 5 春     兰州   47  
 6 春     广州   32.7
 7 夏     北京   55.3
 8 夏     重庆   41.7
 9 夏     济南   68.3
10 夏     合肥   41.3
# ℹ 14 more rows</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Friedman rank sum test

data:  df1$pm25, df1$season and df1$city
Friedman chi-squared = 15, df = 3, p-value = 0.001817</code></pre>
</div>
</div>
<p><strong>(3)多重比较</strong><br>
当方差分析结果显示差异有显著性，并不代表所有的因素水平间都有显著性差异，此时需要通过多重比较(两两比较)才能明确具体水平间的差异显著性。多重比较的方法有很多，其中R预置了Tukey方法(<code>TukeyHSD()</code>函数)。R包agricolae提供了更多多重比较的方法，除了Tukey方法<code>HSD.test()</code>外，还有LSD方法<code>LSD.test()</code>(最小差数显著法)、Bonferroni方法<code>LSD.test()</code>(设置参数p.adj = “bonferroni”)、SNK方法<code>SNK.test()</code>(也称q检验)、Duncan方法<code>duncan.test()</code>(新复极差法)、Scheffé方法<code>scheffe.test()</code>、Dunnet方法<code>multcomp::glht()</code>等。Tukey方法一般用于较多组(≥6)且容量相同样本的多重比较，较LSD方法保守，不易发现差异显著性。Bonferroni方法般用于5组以下容量相同样本的多重比较。Dunnet方法用于多个实验组与一个对照组的比较。Scheffé方法适用于各种情况下的多重比较，特别是样本容量不同的情况。</p>
<div id="exm-4.41" class="theorem example">
<p><span class="theorem-title"><strong>例 4.41</strong></span> 对 <a href="#exm-4.38" class="quarto-xref">例&nbsp;<span>4.38</span></a> 中方差分析的结果做多重比较。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(agricolae)</span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 宽表</span></span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>  春 <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">22.6</span>, <span class="fl">22.8</span>, <span class="fl">21.0</span>, <span class="fl">16.9</span>, <span class="fl">24.0</span>, <span class="fl">21.9</span>, <span class="fl">21.5</span>, <span class="fl">21.2</span>),</span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a>  夏 <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">19.1</span>, <span class="fl">22.8</span>, <span class="fl">24.5</span>, <span class="fl">18.0</span>, <span class="fl">15.2</span>, <span class="fl">18.4</span>, <span class="fl">20.1</span>, <span class="fl">21.5</span>),</span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>  秋 <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">18.9</span>, <span class="fl">13.6</span>, <span class="fl">17.2</span>, <span class="fl">15.1</span>, <span class="fl">16.6</span>, <span class="fl">14.2</span>, <span class="fl">16.7</span>, <span class="fl">19.6</span>),</span>
<span id="cb206-8"><a href="#cb206-8" aria-hidden="true" tabindex="-1"></a>  冬 <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">19.0</span>, <span class="fl">16.9</span>, <span class="fl">17.6</span>, <span class="fl">14.8</span>, <span class="fl">13.1</span>, <span class="fl">16.9</span>, <span class="fl">16.2</span>, <span class="fl">14.8</span>)</span>
<span id="cb206-9"><a href="#cb206-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb206-10"><a href="#cb206-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 转换为长表</span></span>
<span id="cb206-11"><a href="#cb206-11" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb206-12"><a href="#cb206-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb206-13"><a href="#cb206-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"season"</span>,</span>
<span id="cb206-14"><a href="#cb206-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"conc"</span>)</span>
<span id="cb206-15"><a href="#cb206-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 方差分析</span></span>
<span id="cb206-16"><a href="#cb206-16" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">aov</span>(conc <span class="sc">~</span> season, <span class="at">data =</span> df)</span>
<span id="cb206-17"><a href="#cb206-17" aria-hidden="true" tabindex="-1"></a><span class="co"># R内置的Tukey方法多重比较</span></span>
<span id="cb206-18"><a href="#cb206-18" aria-hidden="true" tabindex="-1"></a>out1 <span class="ot">=</span> <span class="fu">TukeyHSD</span>(model); </span>
<span id="cb206-19"><a href="#cb206-19" aria-hidden="true" tabindex="-1"></a>out1</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = conc ~ season, data = df)

$season
         diff        lwr      upr     p adj
冬-春 -5.3250 -8.4573904 -2.19261 0.0004083
秋-春 -5.0000 -8.1323904 -1.86761 0.0008718
夏-春 -1.5375 -4.6698904  1.59489 0.5460365
秋-冬  0.3250 -2.8073904  3.45739 0.9918917
夏-冬  3.7875  0.6551096  6.91989 0.0132270
夏-秋  3.4625  0.3301096  6.59489 0.0260275</code></pre>
</div>
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># agricolae包中Tukey方法多重比较</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>out2 <span class="ot">=</span> <span class="fu">HSD.test</span>(model, <span class="st">"season"</span>)</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>out2<span class="sc">$</span>groups</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      conc groups
春 21.4875      a
夏 19.9500      a
秋 16.4875      b
冬 16.1625      b</code></pre>
</div>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co"># agricolae包中LSD方法多重比较</span></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>out3 <span class="ot">=</span> <span class="fu">LSD.test</span>(model, <span class="st">"season"</span>, <span class="at">p.adj =</span> <span class="st">"bonferroni"</span>)</span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>out3<span class="sc">$</span>groups</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      conc groups
春 21.4875      a
夏 19.9500      a
秋 16.4875      b
冬 16.1625      b</code></pre>
</div>
</div>
<p><code>TukeyHSD.test()</code>函数的检验结果与agricolae中的<code>HSD.test()</code>函数的结果相同，但结果展示形式不同，前者给出各次比较的均值差的区间估计和<span class="math inline">p</span>值，后者以字母形式标注组间差异显著性，字母相同表示无显著性差异，字母不同表示有显著性差异。本例中，Bonferroni方法与Tukey方法检验结果一致。<br>
此外，R内置的<code>pairwise.t.test()</code>函数基于<em>t</em>检验方法执行多重比较，并给出<span class="math inline">p</span>值。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(df)</span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairwise.t.test</span>(conc, season, <span class="at">p.adjust.method =</span> <span class="st">"bonferroni"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pairwise comparisons using t tests with pooled SD 

data:  conc and season 

   春      冬      秋     
冬 0.00044 -       -      
秋 0.00096 1.00000 -      
夏 1.00000 0.01579 0.03223

P value adjustment method: bonferroni </code></pre>
</div>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(df)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>如果需要对因素间交互作用进行可视化，可使用R中<code>interaction.plot()</code>函数，具体使用方法参考该函数的帮助信息。</p>
<div id="exr-4.3" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 4.3</strong></span> <br>
四个实验室测定浓度为0.100mg/L的铬标准溶液的结果分别为：A实验室0.099、0.098、0.101、0.099、0.100，B实验室0.099、0.097、0.101、0.098、0.099，C实验室为0.097、0.094、0.098、0.098、0.099，D实验室0.101、0.104、0.101、0.101、0.102。试分析在检验水准为0.01时，四个实验室测定结果是否存在显著性差异？如有显著性差异，进一步开展多重比较。</p>
</div>
</section>
</section>
</section>
<section id="相关分析与回归分析" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="相关分析与回归分析"><span class="header-section-number">4.3</span> 相关分析与回归分析</h2>
<p>现实世界中，各种因素(变量)交织在一起，相互依赖和制约，数学研究其中的确定性关系——函数关系，而统计学则研究其中的不确定性关系——相关关系。在相关关系分析的基础上，可进一步开展回归分析，建立因变量与其相关的自变量之间的回归模型。</p>
<section id="相关分析" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="相关分析"><span class="header-section-number">4.3.1</span> 相关分析</h3>
<section id="双变量简单相关系数的计算与检验" class="level4" data-number="4.3.1.1">
<h4 data-number="4.3.1.1" class="anchored" data-anchor-id="双变量简单相关系数的计算与检验"><span class="header-section-number">4.3.1.1</span> 双变量简单相关系数的计算与检验</h4>
<p>相关系数定量地表征两个变量间的线性相关程度及相关方向，其值范围在-1至+1之间，正数为正相关，负数为负相关；绝对值越接近于1表示相关性越高，反之则相关性越低，接近于0为零相关或无相关。</p>
<p>研究两个变量之间的相关关系，可以应用Pearson积矩相关系数(<span class="math inline">r</span>)、Spearman秩相关系数(<span class="math inline">\rho</span>)以及Kendall秩相关系数(<span class="math inline">\tau</span>)。Pearson积矩相关系数基于矩计算，要求两个变量是服从正态分布的连续型变量。Kendall秩相关系数利用原始数据的秩计算，适用于两个定序变量以及不服从正态分布的等间隔数据，是一种非参数统计分析方法。Spearman秩相关系数也利用原始数据的秩计算，适用于连续型和离散型变量，对变量分布类型不作要求，也是一种非参数统计分析方法，可用于使用Pearson积矩相关系数和Kendall秩相关系数的场合，但统计功效低于Pearson积矩相关系数。</p>
<p>R中<code>cor()</code>函数能够计算上述三种相关系数，其中参数method用于设置计算具体相关系数的类型；对于存在缺失值的样本，需要对use参数进行相关设置。对于数据框形式的多变量数据集，<code>cor()</code>函数会给出相关系数矩阵，相关系数矩阵的可视化参见 <a href="CH3.html#sec-cormatvis" class="quarto-xref"><span>小节 3.4.6.2</span></a> 相关内容。R中<code>cor.test()</code>函数用于对相关系数进行检验(H<sub>0</sub>：相关系数为0)。</p>
<div>
<p>在某交通点连续三天监测汽车流量和大气NO<sub>2</sub>浓度，每天采样三次，汽车流量(辆/h)监测数据为1500, 960, 1200, 1784, 1176, 1476, 1820, 1060, 1436；NO2浓度(mg/m^3)监测数据为0.1200, 0.0390, 0.1000, 0.2220, 0.1290, 0.1450, 0.1350, 0.0785, 0.0985。试求二者相关系数并进行检验。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1500</span>, <span class="dv">960</span>, <span class="dv">1200</span>, <span class="dv">1784</span>, <span class="dv">1176</span>, <span class="dv">1476</span>, <span class="dv">1820</span>, <span class="dv">1060</span>, <span class="dv">1436</span>)</span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.1200</span>, <span class="fl">0.0390</span>, <span class="fl">0.1000</span>, <span class="fl">0.2220</span>, <span class="fl">0.1290</span>, <span class="fl">0.1450</span>, <span class="fl">0.1350</span>, <span class="fl">0.0785</span>, <span class="fl">0.0985</span>)</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算pearseon相关系数</span></span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(x, y, <span class="at">method =</span> <span class="st">"pearson"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7988311</code></pre>
</div>
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算spearman相关系数</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(x, y, <span class="at">method =</span> <span class="st">"spearman"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7833333</code></pre>
</div>
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算kendall相关系数</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(x, y, <span class="at">method =</span> <span class="st">"kendall"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6111111</code></pre>
</div>
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算pearseon相关系数并进行检验</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(x, y, <span class="at">method =</span> <span class="st">"pearson"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  x and y
t = 3.5134, df = 7, p-value = 0.009814
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.2869339 0.9558528
sample estimates:
      cor 
0.7988311 </code></pre>
</div>
</div>
<p>检验结果表明pearson相关系数不等于0。</p>
</section>
<section id="多变量偏相关系数的计算与检验" class="level4" data-number="4.3.1.2">
<h4 data-number="4.3.1.2" class="anchored" data-anchor-id="多变量偏相关系数的计算与检验"><span class="header-section-number">4.3.1.2</span> 多变量偏相关系数的计算与检验</h4>
<p>偏相关分析是在三个及以上多变量的相关分析中，在消除其他变量影响的前提下考察两个变量之间的相关关系，因此也称为净相关分析。在三个变量的偏相关分析中，任意两个变量的偏相关系数是消除余下一个变量的影响得到的，称为一阶偏相关系数；在四个变量的偏相关分析中，任意两个变量的偏相关系数称为二阶偏相关系数。以此类推，还有更高阶的偏相关系数，但超过4个变量的情况下，较少采用偏相关分析。</p>
<p>R包ppcor提供了偏相关系数的计算和检验函数：<code>pcor()</code>和<code>pcor.test()</code>。下面对R内置数据集airquality的前四个变量(Ozone、Solar.R、Wind、Temp)进行相关分析和偏相关分析。</p>
<div id="exm-4.42" class="theorem example">
<p><span class="theorem-title"><strong>例 4.42</strong></span> 对airquality数据集进行相关和偏相关分析。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ppcor)</span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> airquality <span class="sc">%&gt;%</span> </span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Ozone<span class="sc">:</span>Temp) <span class="sc">%&gt;%</span> </span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算简单相关系数</span></span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(df, <span class="at">method =</span> <span class="st">"spearman"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Ozone     Solar.R        Wind       Temp
Ozone    1.0000000  0.34818647 -0.60513642  0.7729319
Solar.R  0.3481865  1.00000000 -0.06169636  0.2095369
Wind    -0.6051364 -0.06169636  1.00000000 -0.4993228
Temp     0.7729319  0.20953692 -0.49932278  1.0000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 计算偏相关系数</span></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pcor</span>(df, <span class="at">method =</span> <span class="st">"spearman"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$estimate
             Ozone     Solar.R        Wind        Temp
Ozone    1.0000000  0.34980011 -0.43451018  0.66817934
Solar.R  0.3498001  1.00000000  0.19474883 -0.08967312
Wind    -0.4345102  0.19474883  1.00000000 -0.04363683
Temp     0.6681793 -0.08967312 -0.04363683  1.00000000

$p.value
               Ozone      Solar.R         Wind         Temp
Ozone   0.000000e+00 0.0001926827 2.349034e-06 2.064670e-15
Solar.R 1.926827e-04 0.0000000000 4.243081e-02 3.537753e-01
Wind    2.349034e-06 0.0424308090 0.000000e+00 6.523181e-01
Temp    2.064670e-15 0.3537753412 6.523181e-01 0.000000e+00

$statistic
            Ozone    Solar.R       Wind       Temp
Ozone    0.000000  3.8623681 -4.9903112  9.2899174
Solar.R  3.862368  0.0000000  2.0538218 -0.9313381
Wind    -4.990311  2.0538218  0.0000000 -0.4518132
Temp     9.289917 -0.9313381 -0.4518132  0.0000000

$n
[1] 111

$gp
[1] 2

$method
[1] "spearman"</code></pre>
</div>
</div>
<p>从计算结果可以发现，Ozone与Solar.R、Wind和Temp三个变量的偏相关系数都具有显著性，其中与Solar.R的偏相关系数比简单相关系数略有增大，而与Wind和Temp两个变量的偏相关强度都有所减弱。因此，多变量的两两变量相关分析应采用偏相关分析，以消除其他变量的影响，从而真实呈现两两变量之间的相关性。</p>
</section>
<section id="多变量复相关系数的计算与检验" class="level4" data-number="4.3.1.3">
<h4 data-number="4.3.1.3" class="anchored" data-anchor-id="多变量复相关系数的计算与检验"><span class="header-section-number">4.3.1.3</span> 多变量复相关系数的计算与检验</h4>
<p>在三个及以上多变量的相关分析中，复相关分析是要考察其中一个变量<span class="math inline">y</span>(因变量)受其他一组变量<span class="math inline">x_i</span>(自变量)的综合影响。采用复相关系数(亦称多重相关系数)来量化表征一个变量与一组变量之间的相关程度，其取值范围为[0, 1]。复相关分析常用于多元线性回归分析。</p>
<p>计算复相关系数需要先建立<span class="math inline">y</span>与<span class="math inline">x_i</span>的多元线性回归方程，再基于多元线性回归方程代入<span class="math inline">x_i</span>的观测值，计算出<span class="math inline">y</span>的预测值<span class="math inline">\hat{y}</span>，然后计算<span class="math inline">y</span>与<span class="math inline">\hat{y}</span>的简单相关系数即为<span class="math inline">y</span>与<span class="math inline">x_i</span>的复相关系数。<a href="#exm-4.43" class="quarto-xref">例&nbsp;<span>4.43</span></a> 演示了R中三种计算复相关系数的方法。</p>
<div id="exm-4.43" class="theorem example">
<p><span class="theorem-title"><strong>例 4.43</strong></span> 计算airquality数据集中Ozone变量与Solar.R、Wind和Temp三个变量的复相关系数。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> airquality <span class="sc">%&gt;%</span> </span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a>fm <span class="ot">=</span> <span class="fu">lm</span>(Ozone <span class="sc">~</span> ., <span class="at">data =</span> df)</span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> df<span class="sc">$</span>Ozone</span>
<span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a>yp <span class="ot">=</span> fm<span class="sc">$</span>fitted.values</span>
<span id="cb227-8"><a href="#cb227-8" aria-hidden="true" tabindex="-1"></a>R1 <span class="ot">=</span> <span class="fu">cor</span>(y, yp)</span>
<span id="cb227-9"><a href="#cb227-9" aria-hidden="true" tabindex="-1"></a>R1</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7783923</code></pre>
</div>
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>R2 <span class="ot">=</span> <span class="fu">cov</span>(y, yp)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">var</span>(y) <span class="sc">*</span> <span class="fu">var</span>(yp))</span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>R2</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7783923</code></pre>
</div>
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>R3 <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">summary</span>(fm)<span class="sc">$</span>r.sq)</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>R3</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7783923</code></pre>
</div>
</div>
<p>以上三种方法的计算结果完全一致，其中第二种方法借助协方差计算函数<code>cov()</code>，第三种方法是取回归模型的决定系数(<span class="math inline">R^2</span>)的平方根。</p>
<p><a href="https://rpkgs.datanovia.com/rstatix/">rstatix</a>和<a href="https://easystats.github.io/easystats/index.html">easystats</a>是与tidyverse设计理念一致的tidy风格的统计分析工具包，整合了R及相关工具包的统计分析与推断的功能，具体功能和使用可阅读相关帮助信息。</p>
<div id="exr-4.4" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 4.4</strong></span> <br>
基于R内置数据集mtcars，选择mpg、disp、hp、drat、wt和qsec等6个变量，<br>
(1)计算两两相关系数矩阵并绘制相关系数矩阵图；<br>
(2)计算mpg、wt和qsec之间偏相关系数；<br>
(3)计算mpg与其他5个变量的复相关系数。</p>
</div>
</section>
</section>
<section id="回归分析" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="回归分析"><span class="header-section-number">4.3.2</span> 回归分析</h3>
<p>回归分析是一种定量描述变量间相互依赖关系的统计分析方法，常用于截面数据。一个自变量(也称预测变量)与一个因变量(也称响应变量)之间的回归分析称为一元回归分析(也称简单回归分析)，多个自变量与一个因变量之间的回归分析称为多元回归分析(也称多重回归分析)。根据自变量与因变量之间的关系类型，可分为线性回归分析和非线性回归分析。</p>
<p>相关分析只是定量描述了变量间相关关系的性质和程度，回归关系则是定量描述变量间相关依赖的函数形式。相关分析是回归分析的基础和前提，回归分析是相关分析的深入和继续，能够量化解释因变量对自变量的依赖性质和程度，并可在一定范围内进行预测。</p>
<section id="线性回归" class="level4" data-number="4.3.2.1">
<h4 data-number="4.3.2.1" class="anchored" data-anchor-id="线性回归"><span class="header-section-number">4.3.2.1</span> 线性回归</h4>
<p>线性回归是在因变量和自变量之间建立如下的线性回归模型：</p>
<p><span id="eq-4.29"><span class="math display">
  Y = X \cdot \beta + \epsilon
\tag{4.29}</span></span></p>
<p>其中<span class="math inline">Y</span>为因变量，<span class="math inline">X</span>为自变量(包含一个或多个自变量)，<span class="math inline">\beta</span>为回归系数(也称权重)<span class="math inline">\epsilon</span>为随机误差，且假定<span class="math inline">\epsilon \sim N(0,\sigma)</span>。每个自变量对应回归系数的符号(正或负)表明该自变量和因变量之间相关关系的方向，每个自变量的回归系数的绝对值表示在模型中其他自变量保持不变的情况下，该自变量变化一个单位，因变量的平均值就会发生多大的变化。</p>
<p>R中<code>lm()</code>函数用于求解回归系数，其算法是基于普通最小二乘法(OLS)。该函数和<code>aov()</code>函数一样采用formula参数来指定因变量和自变量。</p>
<div id="exm-4.44" class="theorem example">
<p><span class="theorem-title"><strong>例 4.44</strong></span> 以airquality数据集中Ozone为因变量、Solar.R为自变量建立一元线性回归模型。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>fm <span class="ot">=</span> <span class="fu">lm</span>(Ozone <span class="sc">~</span> Solar.R, <span class="at">data =</span> airquality)</span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fm)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Ozone ~ Solar.R, data = airquality)

Residuals:
    Min      1Q  Median      3Q     Max 
-48.292 -21.361  -8.864  16.373 119.136 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 18.59873    6.74790   2.756 0.006856 ** 
Solar.R      0.12717    0.03278   3.880 0.000179 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 31.33 on 109 degrees of freedom
  (42 observations deleted due to missingness)
Multiple R-squared:  0.1213,    Adjusted R-squared:  0.1133 
F-statistic: 15.05 on 1 and 109 DF,  p-value: 0.0001793</code></pre>
</div>
</div>
<p><code>summary()</code>给出的摘要信息中，Call部分显示了函数调用形式，Residuals部分给出了模型残差最小和最大值以及四分位数，Coefficients部分给出了回归系数的估计值、标准差、t检验统计量和显著性检验的<span class="math inline">p</span>值，其中Intercept为截距(亦称回归常数，即<span class="math inline">\beta_0</span>)，接下来是各个自变量的回归系数。最后一段信息给出了残差标准差和自由度、模型决定系数(<span class="math inline">\text{R}^2</span>)和校正决定系数(<span class="math inline">\text{R}_a^2</span>)以及模型显著性检验(F检验)的结果；如有缺失值，还会给出因数据缺失而删除的观测数。</p>
<p>每个自变量回归系数的<span class="math inline">p</span>值大于检验水准时，即没有显著性意义，表明样本不足以拒绝在总体上该自变量与因变量之间相关性为零的原假设；当<span class="math inline">p</span>值小于检验水准时，即有显著性意义，则表明样本足以拒绝在总体上该自变量与因变量之间相关性为零的原假设，该自变量可能值得添加到回归模型中。决定系数<span class="math inline">\text{R}^2</span>是自变量能够解释因变量变异的部分与因变量总变异的比例，即</p>
<p><span id="eq-4.30"><span class="math display">
  \text{R}^2 = \frac {\sum{(\hat {y}_i - \bar{y})^2}} {\sum{(y_i - \bar{y})^2}}
  = 1 - \frac {\sum{(\hat {y}_i - y_i)^2}} {\sum{(y_i - \bar{y})^2}}
\tag{4.30}</span></span></p>
<p><span class="math inline">\text{R}^2</span>常用于回归方程拟合优度的评价，但其只是相关性而非准确性的度量指标。随着回归方程中自变量个数的增加，<span class="math inline">\text{R}^2</span>会出现过高的估计，为此提出考虑自变量个数的<span class="math inline">\text{R}_a^2</span>，以避免对回归方程拟合优度的乐观估计(<span class="math inline">\text{R}_a^2</span>总是小于<span class="math inline">\text{R}^2</span>)。总是假定样本内观测数为<span class="math inline">n</span>，每个观测的变量数为<span class="math inline">k</span>，则</p>
<p><span id="eq-4.31"><span class="math display">
  \text{R}_a^2 = 1 - \frac {\sum{(\hat {y}_i - y_i)^2}/(n-k-1)} {\sum{(y_i - \bar{y})^2}/(n-1)}
  = 1 - (1 - \text{R}^2) \frac {n-1} {n-k-1}
\tag{4.31}</span></span></p>
<p>另一个<span class="math inline">\text{R}_a^2</span>的计算公式是将上式中<span class="math inline">(n-p-1)</span>改为<span class="math inline">(n-p)</span>，这在一个自变量的情况下，<span class="math inline">\text{R}_a^2 = \text{R}^2</span>。</p>
<p>从 <a href="#exm-4.44" class="quarto-xref">例&nbsp;<span>4.44</span></a> 中<code>summary()</code>函数的摘要结果来看，回归模型和两个回归系数都具有显著意义，但从<span class="math inline">\text{R}^2</span>来看，模型的拟合优度很低。下面，将Temp和Wind变量引入回归模型，观察回归系数和决定系数的变化。</p>
<div id="exm-4.45" class="theorem example">
<p><span class="theorem-title"><strong>例 4.45</strong></span> 以airquality数据中的Ozone为因变量，以 Solar.R、Temp及Wind为自变量，建立多元回归模型。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>fm1 <span class="ot">=</span> <span class="fu">lm</span>(Ozone <span class="sc">~</span> Solar.R <span class="sc">+</span> Temp <span class="sc">+</span> Wind, <span class="at">data =</span> airquality)</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fm1)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Ozone ~ Solar.R + Temp + Wind, data = airquality)

Residuals:
    Min      1Q  Median      3Q     Max 
-40.485 -14.219  -3.551  10.097  95.619 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -64.34208   23.05472  -2.791  0.00623 ** 
Solar.R       0.05982    0.02319   2.580  0.01124 *  
Temp          1.65209    0.25353   6.516 2.42e-09 ***
Wind         -3.33359    0.65441  -5.094 1.52e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 21.18 on 107 degrees of freedom
  (42 observations deleted due to missingness)
Multiple R-squared:  0.6059,    Adjusted R-squared:  0.5948 
F-statistic: 54.83 on 3 and 107 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>显然，引入两个新的自变量后，新模型的回归系数和决定系数都发生了变化，其中截距变为负值且绝对值增大，而Solar.R的回归系数明显减小。此外，<span class="math inline">\text{R}^2</span>明显增大，残差减小，说明回归模型的拟合优度得到了改善。从 <a href="#exm-4.45" class="quarto-xref">例&nbsp;<span>4.45</span></a> 的结果可以发现，新引入的自变量Temp和Wind与因变量Ozone的相关性更高，对其影响大于Solar.R。</p>
<p>回归模型建立后，除了利用<code>summary()</code>函数提取模型摘要信息外，还可以通过以下函数提取其他信息以进一步分析:</p>
<ul>
<li><code>coefficients()</code>: 提取回归模型的回归系数</li>
<li><code>residuals()</code>: 提取回归模型的残差</li>
<li><code>confint()</code>: 计算回归系数的置信区间(默认 95%)</li>
<li><code>fitted()</code>: 计算回归模型对建模数据集的拟合值</li>
<li><code>anova()</code>: 计算回归模型的方差分析表</li>
<li><code>AIC()</code>: 计算赤池信息统计量</li>
<li><code>BIC()</code>: 计算贝叶斯信息统计量</li>
<li><code>plot()</code>: 生成回归模型的诊断图形</li>
<li><code>predict()</code>: 利用回归模型对新数据集进行预测</li>
</ul>
<p>例如，利用<code>confint()</code>获取 <a href="#exm-4.45" class="quarto-xref">例&nbsp;<span>4.45</span></a> 中多元回归模型的回归系数的置信区间：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(fm1)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    2.5 %      97.5 %
(Intercept) -110.04538108 -18.6387768
Solar.R        0.01385613   0.1057851
Temp           1.14949967   2.1546862
Wind          -4.63087706  -2.0363055</code></pre>
</div>
</div>
<p>回归系数体现了自变量变化对因变量的影响方向和程度，是回归模型解释功能的重要部分。<br>
<code>predict()</code>基于已经建立的回归模型，用新的自变量数据预测对应的因变量的值。对于线性回归模型，该函数提供点预测和区间预测两种功能，执行区间预测只需设置参数interval和level值即可。interval设置为”confidence”时，计算置信区间(窄区间)，设置为”prediciton”时，计算公差区间(宽区间)。level默认值是0.95，即计算置信概率为95%的区间。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Solar.R =</span> <span class="fu">sample</span>(<span class="fu">na.omit</span>(airquality<span class="sc">$</span>Solar.R), <span class="dv">5</span>),</span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Temp =</span> <span class="fu">sample</span>(<span class="fu">na.omit</span>(airquality<span class="sc">$</span>Temp), <span class="dv">5</span>),</span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Wind =</span> <span class="fu">sample</span>(<span class="fu">na.omit</span>(airquality<span class="sc">$</span>Wind), <span class="dv">5</span>)</span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a>new_data</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Solar.R Temp Wind
1     167   81 10.3
2     190   65 13.8
3     223   92 11.5
4     284   73  9.7
5     273   82  7.4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 点预测</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fm1, <span class="at">newdata =</span> new_data)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        1         2         3         4         5 
45.131495  8.406312 62.654160 40.913915 62.791985 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 窄区间预测</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fm1, <span class="at">newdata =</span> new_data, <span class="at">interval =</span> <span class="st">"confidence"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        fit      lwr      upr
1 45.131495 40.56799 49.69500
2  8.406312  1.20245 15.61018
3 62.654160 53.64414 71.66418
4 40.913915 33.89565 47.93218
5 62.791985 56.71742 68.86655</code></pre>
</div>
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 宽区间预测</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fm1, <span class="at">newdata =</span> new_data, <span class="at">interval =</span> <span class="st">"prediction"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        fit        lwr       upr
1 45.131495   2.895862  87.36713
2  8.406312 -34.195550  51.00818
3 62.654160  19.709970 105.59835
4 40.913915  -1.656956  83.48479
5 62.791985  20.366481 105.21749</code></pre>
</div>
</div>
<p>需要注意的是，新数据集中变量名必须与建立回归模型的变量名一致。另外，预测使用的新数据，严格意义上，各自变量的值应在建立回归模型使用的自变量值域内，否则预测的准确性将难以保证。</p>
<p>除了对因变量进行预测，线性回归模型还可以反过来对自变量进行控制，即在确保因变量在某个概率下的置信区间时，如何控制自变量的取值范围，亦即反预测。一元线性回归模型的控制相对简单，但多元线性回归的控制就很复杂，有兴趣的读者可研读相关文献资料。</p>
<p>在多元线性回归中，经常需要考虑自变量之间的交互作用，这可以利用符号”:“或”*“来实现，例如考虑 <a href="#exm-4.45" class="quarto-xref">例&nbsp;<span>4.45</span></a> 中回归模型中Wind和Temp的交互作用对Ozone的影响：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a>fm2 <span class="ot">=</span> <span class="fu">lm</span>(Ozone <span class="sc">~</span> Solar.R <span class="sc">+</span> Temp <span class="sc">*</span> Wind, <span class="at">data =</span> airquality)</span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fm2)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Ozone ~ Solar.R + Temp * Wind, data = airquality)

Residuals:
    Min      1Q  Median      3Q     Max 
-38.888 -11.938  -3.084   8.753  94.235 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -245.08368   46.84632  -5.232 8.53e-07 ***
Solar.R        0.06599    0.02152   3.067 0.002745 ** 
Temp           3.91373    0.57217   6.840 5.26e-10 ***
Wind          14.38471    4.13249   3.481 0.000727 ***
Temp:Wind     -0.22795    0.05259  -4.334 3.34e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 19.61 on 106 degrees of freedom
  (42 observations deleted due to missingness)
Multiple R-squared:  0.6652,    Adjusted R-squared:  0.6526 
F-statistic: 52.66 on 4 and 106 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>结果表明Temp和Wind交互项的回归系数具有显著性，这表明因变量与其中一个自变量的关系依赖于另外一个自变量的水平，例如Ozone与Temp的关系依Wind不同而不同。同时，模型残差进一步减小，<span class="math inline">\text{R}^2</span>也增大了一些。</p>
</section>
<section id="非线性回归" class="level4" data-number="4.3.2.2">
<h4 data-number="4.3.2.2" class="anchored" data-anchor-id="非线性回归"><span class="header-section-number">4.3.2.2</span> 非线性回归</h4>
<p>非线性关系在现实世界中极为普遍，其中一些非线性关系可以通过数学变换(如对数变换)转变为线性关系，称之为本质线性关系；而无法通过数学变换将其转化为线性关系的，则称之为本质非线性关系。对于前一种情况，对变量进行数学变换，然后对变换后的新变量建立线性回归模型。对于后者，则需要采用非线性回归算法进行建模。</p>
<p>尽管本质线性关系的非线性问题可以使用线性回归模型，但往往会降低模型的可解释性。例如一级动力学方程<span class="math inline">C_t=C_t e^{-kt}</span> 、米氏方程<span class="math inline">v_0=v_{max} C/(k_m+C)</span>等，按其方程固有形式估计出的参数都有清晰的解释，如一级动力学模型中<span class="math inline">k</span>是反应速率，米氏方程中的<span class="math inline">v_{max}</span>是指最大反应速率。</p>
<p>统计分析中，可以利用多项式回归、样条回归、广义加法模型(GAM)等方法来拟合变量间的非线性关系，这里仅介绍基于<code>lm()</code>函数的多项式回归。</p>
<div id="exm-4.46" class="theorem example">
<p><span class="theorem-title"><strong>例 4.46</strong></span> 基于一个三次多项式方程构造一个包含50个观测的数据集，然后分别建立直线回归、2阶多项式回归和3阶多项式回归模型，并对拟合结果进行可视化。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 构造数据集</span></span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">seq</span>(<span class="fl">0.5</span>, <span class="dv">20</span>, <span class="at">by =</span> <span class="fl">0.5</span>)</span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> x,</span>
<span id="cb249-7"><a href="#cb249-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="dv">20</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> (x <span class="sc">-</span> <span class="fl">0.5</span>)<span class="sc">^</span><span class="dv">3</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">40</span>, <span class="at">mean =</span> <span class="dv">30</span>, <span class="at">sd =</span> <span class="dv">100</span>)</span>
<span id="cb249-8"><a href="#cb249-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb249-9"><a href="#cb249-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制散点图</span></span>
<span id="cb249-10"><a href="#cb249-10" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> <span class="fu">ggplot</span>(df,<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb249-11"><a href="#cb249-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb249-12"><a href="#cb249-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 建立直线回归方程并可视化拟合结果</span></span>
<span id="cb249-13"><a href="#cb249-13" aria-hidden="true" tabindex="-1"></a>fm1 <span class="ot">=</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> df)</span>
<span id="cb249-14"><a href="#cb249-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制fm1的拟合曲线</span></span>
<span id="cb249-15"><a href="#cb249-15" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> p <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(x, <span class="fu">fitted</span>(fm1)), <span class="at">size =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"blue"</span>)</span>
<span id="cb249-16"><a href="#cb249-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 建立2阶多项式回归方程并可视化拟合结果</span></span>
<span id="cb249-17"><a href="#cb249-17" aria-hidden="true" tabindex="-1"></a>fm2 <span class="ot">=</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">2</span>), <span class="at">data =</span> df)</span>
<span id="cb249-18"><a href="#cb249-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制fm2的拟合曲线</span></span>
<span id="cb249-19"><a href="#cb249-19" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> p <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(x, <span class="fu">fitted</span>(fm2)), <span class="at">size =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"green"</span>)</span>
<span id="cb249-20"><a href="#cb249-20" aria-hidden="true" tabindex="-1"></a><span class="co"># 建立3阶多项式回归方程并可视化拟合结果</span></span>
<span id="cb249-21"><a href="#cb249-21" aria-hidden="true" tabindex="-1"></a>fm3 <span class="ot">=</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">3</span>), <span class="at">data =</span> df)</span>
<span id="cb249-22"><a href="#cb249-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制fm3的拟合曲线</span></span>
<span id="cb249-23"><a href="#cb249-23" aria-hidden="true" tabindex="-1"></a>p <span class="ot">=</span> p <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(x, <span class="fu">fitted</span>(fm3)), <span class="at">size =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"red"</span>)</span>
<span id="cb249-24"><a href="#cb249-24" aria-hidden="true" tabindex="-1"></a>p    </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="CH4_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>下面利用<code>anova()</code>函数对三个模型进行显著性检验：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(fm1, fm2, fm3)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: y ~ x
Model 2: y ~ poly(x, 2)
Model 3: y ~ poly(x, 3)
  Res.Df     RSS Df Sum of Sq      F    Pr(&gt;F)    
1     38 7512978                                  
2     37  520393  1   6992585 900.96 &lt; 2.2e-16 ***
3     36  279405  1    240988  31.05 2.593e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>结果表明直线回归模型fm1没有显著性，而2阶和3阶多项式回归模型fm2和fm3都具有显著性。</p>
<p>很多领域针对特定问题已经建立了相应的数学模型，如一级动力学方程、米氏方程等，这类问题需要估计模型参数，此时，可以用R中基于非线性最小二乘法的函数<code>nls()</code>来解决。该函数通过迭代来求解参数，一般需要根据经验预先设定参数初始值：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">=</span> <span class="fu">nls</span>(y <span class="sc">~</span> a <span class="sc">*</span> <span class="fu">exp</span>(b <span class="sc">*</span> x), <span class="at">data =</span> df, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a =</span> ..., <span class="at">b =</span> ...), ...) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>参数初始值对迭代计算具有极大影响，其设定需要经验，主观性太强。为此，R提供了部分常用方程的自启动模型(Self-Satrt models)，避免人为设置初始参数。输入<code>?selfStart</code>，即可打开关于自启动模型的帮助页面，查询相关自启动模型参数设置的函数。下面是其中的部分自启动模型函数：<br>
- <code>SSfol(Dose, input, lKe, lKa, lCl)</code>：一级动力学房室模型<br>
- <code>SSbiexp(input, A1, lrc1, A2, lrc2)</code>：双指数模型<br>
- <code>SSgompertz(x, Asym, b2, b3)</code>：Gompertz增长曲线模型<br>
- <code>SSlogis(input, Asym, xmid, scal)</code>：逻辑斯蒂曲线模型<br>
- <code>SSmicmen(input, Vm, K)</code>：米氏方程模型</p>
<p>例如，对米氏方程采用自启动模型：<code>fit = nls(y ~ SSmicmen(x, vm, k), data = df)</code>。</p>
<div id="exm-4.47" class="theorem example">
<p><span class="theorem-title"><strong>例 4.47</strong></span> 利用nls函数求解一级动力学方程的参数。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 构造数据集</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="at">length.out =</span> <span class="dv">40</span>)</span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> x,</span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fl">5.5</span> <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.52</span> <span class="sc">*</span> x) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">40</span>, <span class="fl">0.08</span>, <span class="fl">0.2</span>))</span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 用nls求解参数</span></span>
<span id="cb253-8"><a href="#cb253-8" aria-hidden="true" tabindex="-1"></a>fm <span class="ot">=</span> <span class="fu">nls</span>(y <span class="sc">~</span> a <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>b <span class="sc">*</span> x), <span class="at">data =</span> df,</span>
<span id="cb253-9"><a href="#cb253-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">start =</span> <span class="fu">c</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="fl">0.1</span>)) </span>
<span id="cb253-10"><a href="#cb253-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fm)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: y ~ a * exp(-b * x)

Parameters:
  Estimate Std. Error t value Pr(&gt;|t|)    
a  5.54533    0.15719   35.28   &lt;2e-16 ***
b  0.53944    0.02468   21.86   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.1921 on 38 degrees of freedom

Number of iterations to convergence: 7 
Achieved convergence tolerance: 1.491e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制拟合图形</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df) <span class="sc">+</span></span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(x,y),<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(x, <span class="fu">fitted</span>(fm)),<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="CH4_files/figure-html/unnamed-chunk-85-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>从摘要信息中可见，参数a和b的求解结果非常接近于前面构造数据所使用的参数值；从拟合图形可见拟合程度较好。</p>
</section>
<section id="线性回归模型诊断与改善方法" class="level4" data-number="4.3.2.3">
<h4 data-number="4.3.2.3" class="anchored" data-anchor-id="线性回归模型诊断与改善方法"><span class="header-section-number">4.3.2.3</span> 线性回归模型诊断与改善方法</h4>
<p>基于OLS的线性回归模型有以下六个假设：<br>
<strong>(1)线性</strong>：因变量和自变量之间满足线性关系；<br>
<strong>(2)可加性</strong>：不同自变量对因变量的影响可直接相加；<br>
<strong>(3)独立性</strong>：自变量之间互不相关；反之，自变量之间存在多重共线性；<br>
<strong>(4)随机性</strong>：残差序列完全随机，特别是时间序列数据；反之，残差存在自相关；<br>
<strong>(5)正态性</strong>：残差满足正态分布；<br>
<strong>(6)方差齐性</strong>：残差的方差为常数，也称同方差性。</p>
<p>线性回归模型诊断包括模型残差分析(检验随机性、正态性和方差齐性)、自变量多重共线性分析以及其他影响因素的分析。</p>
<p><code>plot()</code>可以绘制线性回归模型(<code>lm()</code>返回的对象)的4个诊断图形，对残差的随机性(反映自变量与因变量有无线性关系)、正态性、方差齐性以及离群点(模型拟合误差很大的数据点)、强影响点(对模型参数估计影响过大的数据点)和高杠杆值点(自变量空间中的离群点，因变量不参与计算)，但无法检验独立性和多重共线性。</p>
<p>car包提供了更丰富的诊断函数，其中<code>qqPlot()</code>绘制分位数比较图检验正态性，<code>crPlot()</code>绘制残差成分与残差图执行残差分析，<code>durbinWatsonTest()</code>检验残差的随机性，<code>ncvTest()</code>检验残差的方差齐性，<code>spreadLevelPlot()</code>绘制拟合值与残差图来判断残差的方差齐性，<code>outlierTest()</code>检验离群点，<code>influencePlot()</code>绘制残差与帽子值(hat统计量)的气泡图来显示离群点、强影响点和高杠杆值点，<code>vif()</code>计算方差膨胀因子来检验多重共线性。</p>
<p>gvlma包中的<code>gvlma()</code>函数可以对线性模型的假设进行全局验证，同时检验偏度、峰度和异方差性。该函数返回的结果中，Global Stat项的决策结果直接给出该线性模型是否通过了综合检验。</p>
<div id="exm-4.48" class="theorem example">
<p><span class="theorem-title"><strong>例 4.48</strong></span> 利用gvlma函数对 <a href="#exm-4.46" class="quarto-xref">例&nbsp;<span>4.46</span></a> 中fm2和fm3模型进行综合检验。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gvlma)</span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gvlma</span>(fm2)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ poly(x, 2), data = df)

Coefficients:
(Intercept)  poly(x, 2)1  poly(x, 2)2  
      993.5       6445.6       2644.3  


ASSESSMENT OF THE LINEAR MODEL ASSUMPTIONS
USING THE GLOBAL TEST ON 4 DEGREES-OF-FREEDOM:
Level of Significance =  0.05 

Call:
 gvlma(x = fm2) 

                      Value   p-value                   Decision
Global Stat        21.41383 2.621e-04 Assumptions NOT satisfied!
Skewness            0.28416 5.940e-01    Assumptions acceptable.
Kurtosis            1.38066 2.400e-01    Assumptions acceptable.
Link Function      19.72332 8.950e-06 Assumptions NOT satisfied!
Heteroscedasticity  0.02569 8.727e-01    Assumptions acceptable.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gvlma</span>(fm3)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ poly(x, 3), data = df)

Coefficients:
(Intercept)  poly(x, 3)1  poly(x, 3)2  poly(x, 3)3  
      993.5       6445.6       2644.3        490.9  


ASSESSMENT OF THE LINEAR MODEL ASSUMPTIONS
USING THE GLOBAL TEST ON 4 DEGREES-OF-FREEDOM:
Level of Significance =  0.05 

Call:
 gvlma(x = fm3) 

                    Value p-value                Decision
Global Stat        5.3380  0.2543 Assumptions acceptable.
Skewness           1.3014  0.2540 Assumptions acceptable.
Kurtosis           0.2838  0.5942 Assumptions acceptable.
Link Function      1.6340  0.2012 Assumptions acceptable.
Heteroscedasticity 2.1188  0.1455 Assumptions acceptable.</code></pre>
</div>
</div>
<p>检验结果表明，二阶多项式模型fm2不满足假设，而三阶多项式模型fm3符合假设。</p>
<p>对于有很多自变量的多元线性回归模型，需要检验多重共线性。此时可以先借助car包中<code>vif()</code>计算出模型中每个自变量的VIF值，然后对其取平方根(<code>sqrt()</code>函数)，结果大于2的变量被认为存在多重共线性。</p>
<p>改善线性回归模型的方法包括：<br>
(1)删除离群点和强影响点，删除后需要重新建立回归模型；或采用稳健回归(MASS包中的<code>rlm()</code>函数)；<br>
(2)存在多重共线性的，可以采取逐步回归法(<code>step()</code>函数或MASS包中的<code>stepAIC()</code>函数)剔除自变量；或采用岭回归方法(ridge regression)或拉索回归(LASSO regression)，这两种回归分析需要借助glmnet包。另一个值得考虑的方法是利用主成分分析提取主成分，然后以主成分作为自变量建立回归模型，或直接采用pls包中的<code>pcr()</code>函数，该包中的<code>plsr()</code>函数执行偏最小二乘回归建模，特别适用于观测数较少而变量数过多的数据；<br>
(3)如果违背正态性假设，可采用非参数回归模型；或采用Box-Cox变量变换方法(car包中<code>powerTransform()</code>函数)；<br>
(4)如果存在异方差性，可利用car包中的<code>spreadLevelPlot()</code>函数来改善；<br>
(4)如果违背线性假设，可采用car包中的<code>boxTidwell()</code>函数来改善；如果存在显著的非线性关系，应采用非线性回归方法；<br>
(5)如果残差存在自相关性，应考虑采用时间序列分析方法或多层次回归方法。</p>
<p>线性混合模型(nlme包)和广义线性模型(glmnet包)可以用于很多不符合普通线性回归假设的情况，可以进一步学习并掌握。另外，quantreg包提供的分位数回归(<code>rq()</code>函数)是一种非参数回归方法，可以估算因变量的条件概率分布。</p>
<div id="exr-4.5" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 4.5</strong></span> 基于R内置数据集mtcars，选择mpg、disp、hp、drat、wt和qsec等6个变量，<br>
(1)以mpg为因变量，其他5个变量为自变量，建立多元线性回归模型；<br>
(2)利用gvlma包中的<code>gvlma()</code>函数对模型进行综合检验；<br>
(3)提出改善模型的方法。</p>
</div>
</section>
</section>
</section>
<section id="主成分分析与因子分析" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="主成分分析与因子分析"><span class="header-section-number">4.4</span> 主成分分析与因子分析</h2>
<p>主成分分析(PCA)和因子分析(FA)很相似，都是一种多变量降维分析方法。主成分分析属于数学分析方法，而因子分析属于统计分析方法。主成分分析方法主要用来解决多变量多重共线性问题，计算得到的主成分之间互相独立，计算结果唯一，常用于多元回归分析、机器学习建模等，并衍生出主成分回归(PCR)、偏最小二乘回归(PLSR)等回归分析模型。因子分析方法用来探索或验证公共因子的结构模型，重点在于找到并解释现有变量背后的少数控制因素(即公共因子)，而且这些控制因素具有实际意义但往往又难以观测，其计算结果不唯一。</p>
<section id="主成分分析" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="主成分分析"><span class="header-section-number">4.4.1</span> 主成分分析</h3>
<p>对于高维数据，每一个样本单位(一个观测)的特征(变量)数非常多，甚至多于样本含量(表现为数据表中列数远多于行数)，例如一个样品的红外光谱数据包含上千个波长的吸光度，基因数据的变量也是成千上万。这些变量间存在错综复杂的相关性，很难深入理解，也不能建立稳健的多元回归模型。主成分分析是一种应用广泛的数据降维算法，基于正交变换将<span class="math inline">n</span>个原始变量转换为n个正交的新变量，即主成分(PCs)。本质上，每个主成分是n个原始变量的线性组合，且各主成分之间互不相关。主成分对数据总方差的解释比例依次从大到小，一般选择累积方差可解释比例(累积贡献率)≥85%的前<span class="math inline">k</span>(通常<span class="math inline">k≤3</span>)个主成分数据代表原始数据用于后续的分析与建模，以免丢弃更多原始数据的信息。降维后的k个主成分只丢弃了原始数据的极少部分信息，但带来的好处是消除了数据中冗余的信息，并显著降低后续建模的计算量和模型的复杂度。</p>
<p>主成分分析不要求数据来自正态总体，但要求变量间存在相关性。主成分分析的步骤：<br>
(1)确认原始变量间存在相关性(可使用Bartlett球形检验或Kaiser-Meyer-Olkin检验，对应于R包psych中的<code>cortest.bartlett()</code>函数和<code>KMO()</code>函数)；<br>
(2)对原始数据进行标准化处理以无量纲化；<br>
(3)计算协方差或相关系数矩阵；<br>
(4)基于协方差或相关系数矩阵求解特征值和特征向量；<br>
(5)将特征值从大到小排列，根据累积贡献率确定前k个特征值；<br>
(6)以特征值对应的特征向量为权重构建主成分(以特征向量为权重将原始变量线性组合为新变量)；<br>
(7)计算每个主成分对应的贡献率；<br>
(8)根据主成分的特征值和特征向量进行解释。</p>
<p>实际上，基于原始数据计算得到的相关矩阵，与原始数据标准化处理后计算得到的协方差矩阵相同。</p>
<p>R中内置的<code>princomp()</code>函数和<code>prcomp()</code>函数都可用于主成分分析，前者基于协方差(参数cor = FALSE，输入数据需要标准化处理)或相关系数矩阵(参数cor = TRUE，输入数据不需要标准化处理)进行特征分解得到特征值与特征向量，而后者提供了标准化处理参数，利用奇异值分解(SVD)从原始数据矩阵直接求解特征值与特征向量，计算速度快，在数据规模很大时具有优势，一般作为首选的方法。此外，很多R包如FactoMineR、psych、MASS等都提供了主成分分析功能的函数。factoextra是一个用于对包括主成分分析在内的多元统计分析的结果进行解释和可视化的包。</p>
<div id="exm-4.49" class="theorem example">
<p><span class="theorem-title"><strong>例 4.49</strong></span> 利用<code>prcomp()</code>对iris数据集进行主成分分析。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> iris[ , <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 相关性检验</span></span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cortest.bartlett</span>(<span class="fu">cor</span>(df), <span class="at">n =</span> <span class="fu">nrow</span>(df))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$chisq
[1] 706.9592

$p.value
[1] 1.92268e-149

$df
[1] 6</code></pre>
</div>
</div>
<p>根据<span class="math inline">p</span>值拒绝变量间相关系数为0的假设，说明可以对数据进行主成分分析。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">KMO</span>(<span class="fu">cor</span>(df))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Kaiser-Meyer-Olkin factor adequacy
Call: KMO(r = cor(df))
Overall MSA =  0.54
MSA for each item = 
Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
        0.58         0.27         0.53         0.63 </code></pre>
</div>
</div>
<p>KMO检验比Bartlett球形检验严格，相关性越高，总MSA(Measure of Sampling Adequacy，抽样充足性测度)值越接近于1，反之则越接近于0，大于0.5即表明存在相关性。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>pca_iris <span class="ot">=</span> (<span class="fu">prcomp</span>(df,<span class="at">scale. =</span> <span class="cn">TRUE</span>, <span class="at">center =</span> <span class="cn">TRUE</span>))    <span class="co"># 标准化处理</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pca_iris)    <span class="co"># 对结果进行摘要</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Importance of components:
                          PC1    PC2     PC3     PC4
Standard deviation     1.7084 0.9560 0.38309 0.14393
Proportion of Variance 0.7296 0.2285 0.03669 0.00518
Cumulative Proportion  0.7296 0.9581 0.99482 1.00000</code></pre>
</div>
</div>
<p>以上结果表明第一个主成分对总方差的解释比例约73%，第二个主成分约23%，二者累计解释比例接近96%，后两个主成分的解释比例很低。因此可选择前2个主成分进行后续的分析与建模。<br>
可用<code>$sdev</code>单独返回标准差(本质上就是对应特征值的平方根)。方差本质上就是对应的特征值，方差比例就是通过特征值计算得到的。返回载荷矩阵通过<code>$rotation</code>：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>pca_iris<span class="sc">$</span>rotation</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    PC1         PC2        PC3        PC4
Sepal.Length  0.5210659 -0.37741762  0.7195664  0.2612863
Sepal.Width  -0.2693474 -0.92329566 -0.2443818 -0.1235096
Petal.Length  0.5804131 -0.02449161 -0.1421264 -0.8014492
Petal.Width   0.5648565 -0.06694199 -0.6342727  0.5235971</code></pre>
</div>
</div>
<p>载荷矩阵非常重要，因为通过载荷矩阵，可以将原始变量线性组合成各个主成分，从而得到主成分作为新变量的得分(新观测值)。下面来看主成分作为新变量的前6个观测：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pca_iris<span class="sc">$</span>x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           PC1        PC2         PC3          PC4
[1,] -2.257141 -0.4784238  0.12727962  0.024087508
[2,] -2.074013  0.6718827  0.23382552  0.102662845
[3,] -2.356335  0.3407664 -0.04405390  0.028282305
[4,] -2.291707  0.5953999 -0.09098530 -0.065735340
[5,] -2.381863 -0.6446757 -0.01568565 -0.035802870
[6,] -2.068701 -1.4842053 -0.02687825  0.006586116</code></pre>
</div>
</div>
<p>主成分分析结果的提取和可视化可借助factoextra包中的相关函数来实现，其中<code>get_eig()</code>提取主成分对应的特征值和总方差解释比例，<code>get_pca()</code>提取观测和变量的各种信息(坐标coord、相关系数cor、余弦平方cos2和贡献率contrib)；<code>fviz_screeplot()</code>用于绘制碎石图，可视化每个主成分对总方差的解释百分比，可用于确定最佳主成分数(根据折线图的拐点来判断)；<code>fviz_pca_ind()</code>基于前两个主成分来可视化样本中观测之间的距离；<code>fviz_pca_var()</code>基于矢量来可视化样本中变量的相关性；而<code>fviz_pca_biplot()</code>则是前两个函数的综合，同时可视化观测与变量。</p>
<p>绘制pca_iris的碎石图：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_screeplot</span>(pca_iris, <span class="at">xlab =</span> <span class="st">"主成分"</span>, <span class="at">ylab =</span> <span class="st">"方差解释百分比(%)"</span>, <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-4.8" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.8-1.png" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.9: 主成分分析的碎石图
</figcaption>
</figure>
</div>
</div>
</div>
<p>基于主成分可以绘制观测点图：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_ind</span>(pca_iris,</span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">mean.point =</span> F,  <span class="co"># 删除中心点</span></span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="st">"none"</span>,  <span class="co"># 删除标签</span></span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">habillage =</span> iris<span class="sc">$</span>Species,  <span class="co"># 分组</span></span>
<span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"orange"</span>,<span class="st">"blue"</span>,<span class="st">"red"</span>),  <span class="co"># 分组颜色标度</span></span>
<span id="cb271-6"><a href="#cb271-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">addEllipses =</span> T,  <span class="co"># 添加椭圆</span></span>
<span id="cb271-7"><a href="#cb271-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">ellipse.type =</span> <span class="st">"convex"</span>,  <span class="co"># 指定椭圆类型</span></span>
<span id="cb271-8"><a href="#cb271-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">repel =</span> T)  <span class="co"># 避免重叠</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-4.9" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.9-1.png" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.9-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.10: 主成分分析的样本散点图
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-4.9" class="quarto-xref">图&nbsp;<span>4.10</span></a> 本质上是iris数据集中150个观测在两个主成分空间中的投影点。</p>
<p>基于主成分还可以绘制变量图：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_var</span>(pca_iris, </span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">col.var=</span><span class="st">"contrib"</span>,  <span class="co"># 根据贡献度着色</span></span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">gradient.cols =</span> <span class="fu">c</span>(<span class="st">"green"</span>, <span class="st">"red"</span>),</span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">repel =</span> <span class="cn">TRUE</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-4.10" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.10-1.png" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.10-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.11: 主成分分析的变量相关圆图
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-4.10" class="quarto-xref">图&nbsp;<span>4.11</span></a> 中四个矢量代表4个原始变量，横轴(Dim1)代表第一个主成分PC1，纵轴(Dim2)代表第二主成分PC2。矢量与横轴和纵轴的夹角越小，意味着与对应主成分的相关性越强(同时也呈现了相关方向)；矢量在横轴和纵轴上的投影长度分别代表该变量对PC1和PC2的贡献程度。对于PC1，应横着看，其中Petal.Length贡献最大(红色)，其次是Petal.Width和Sepal.Length，这三个变量都是正向影响，而Sepal.Width的微弱负向影响可以忽略。对于PC2，四个变量都是负向影响，而Sepal.Width影响最大，其余三个的影响可以忽略。</p>
<p>可以用<code>get_pca_var()</code>提取变量的坐标(主成分空间)、相关系数、平方余弦和贡献度。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>var_res <span class="ot">=</span> <span class="fu">get_pca_var</span>(pca_iris) </span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 变量坐标</span></span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a>var_res<span class="sc">$</span>coord</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Dim.1       Dim.2       Dim.3       Dim.4
Sepal.Length  0.8901688 -0.36082989  0.27565767  0.03760602
Sepal.Width  -0.4601427 -0.88271627 -0.09361987 -0.01777631
Petal.Length  0.9915552 -0.02341519 -0.05444699 -0.11534978
Petal.Width   0.9649790 -0.06399985 -0.24298265  0.07535950</code></pre>
</div>
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 相关性系数，亦即变量坐标</span></span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a>var_res<span class="sc">$</span>cor</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Dim.1       Dim.2       Dim.3       Dim.4
Sepal.Length  0.8901688 -0.36082989  0.27565767  0.03760602
Sepal.Width  -0.4601427 -0.88271627 -0.09361987 -0.01777631
Petal.Length  0.9915552 -0.02341519 -0.05444699 -0.11534978
Petal.Width   0.9649790 -0.06399985 -0.24298265  0.07535950</code></pre>
</div>
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 平方余弦</span></span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>var_res<span class="sc">$</span>cos2</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Dim.1       Dim.2       Dim.3        Dim.4
Sepal.Length 0.7924004 0.130198208 0.075987149 0.0014142127
Sepal.Width  0.2117313 0.779188012 0.008764681 0.0003159971
Petal.Length 0.9831817 0.000548271 0.002964475 0.0133055723
Petal.Width  0.9311844 0.004095980 0.059040571 0.0056790544</code></pre>
</div>
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 贡献度</span></span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>var_res<span class="sc">$</span>contrib</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Dim.1       Dim.2     Dim.3     Dim.4
Sepal.Length 27.150969 14.24440565 51.777574  6.827052
Sepal.Width   7.254804 85.24748749  5.972245  1.525463
Petal.Length 33.687936  0.05998389  2.019990 64.232089
Petal.Width  31.906291  0.44812296 40.230191 27.415396</code></pre>
</div>
</div>
<p>可以利用<code>fviz_contrib()</code>函数可视化变量对指定主成分的贡献：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 可视化变量对PC1的贡献</span></span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_contrib</span>(pca_iris, <span class="at">choice =</span> <span class="st">"var"</span>, <span class="at">axes =</span> <span class="dv">1</span>)</span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 可视化变量对PC2的贡献</span></span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_contrib</span>(pca_iris, <span class="at">choice =</span> <span class="st">"var"</span>, <span class="at">axes =</span> <span class="dv">2</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-4.11" class="cell quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.11-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="fig-4.11-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-4.11-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.11-1.png" class="img-fluid figure-img" data-ref-parent="fig-4.11" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-4.11-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) PC1
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-4.11-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-4.11-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.11-2.png" class="img-fluid figure-img" data-ref-parent="fig-4.11" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-4.11-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) PC2
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.11-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.12: 变量对主成分的贡献率条形图
</figcaption>
</figure>
</div>
</div>
</section>
<section id="因子分析" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="因子分析"><span class="header-section-number">4.4.2</span> 因子分析</h3>
<p>因子分析是主成分分析方法的推广，其目的是从大量相关的原始变量中提取少数更具解释性的潜在变量，即公共因子。因子分析的结果是将全部原始变量的信息由少数公共因子的线性组合与一个特殊因子(表征公共因子不能解释的剩余信息)的和来表征。与主成分相比，公共因子具有更好的可解释性和实际意义。因子分析与主成分分析的算法相似，但主成分是原始变量的线性组合，解是唯一的，而公共因子通过线性组合与特殊因子构成原始变量，解不是唯一的。</p>
<p>因子分析分为R和Q两种类型，前者是对变量进行因子分析，后者是对观测(样品)进行因子分析。因子分析还分为探索性因子分析(EFA)和验证性因子分析(CFA)，前者用于从原始变量中发掘公共因子并建立因子模型解释原始变量，应用广泛；而后者是检验已有因子模型拟合原始变量的能力，判断是否与预先假设一致，研究数据之间因果联系的结构方程模型(Sructural Equation Model，SEM)可以看成是CFA和路径分析的结合。本书仅介绍EFA方法，该方法要求变量之间存在相关关系，通常要求样本含量(观测数)不能太小，一般最少不低于50，且必须大于变量数，最好是变量数的5倍以上。</p>
<p>探索性因子分析的步骤：<br>
(1)确认原始变量间存在较强相关关系(Bartlett球形检验或Kaiser-Meyer-Olkin检验)；<br>
(2)根据原始变量计算相关系数矩阵；<br>
(3)确定要提取的公因子数；<br>
(4)计算公因子及其载荷矩阵(常用方法有极大似然法、主轴因子法、最小二乘法、alpha因子分解法等)；<br>
(5)利用旋转方法(包括正交旋转和斜交旋转，前者要求数据服从多元正态分布)使因子具有更好解释性；<br>
(6)计算因子得分，用于后续分析、建模和解释。</p>
<p>R中<code>factanal()</code>函数执行基于极大似然法的因子分析。psych包中的<code>fa()</code>函数可执行基于极大似然法、主轴因子法、最小二乘法、alpha因子分解法等多种方法的因子分析。</p>
<div id="exm-4.50" class="theorem example">
<p><span class="theorem-title"><strong>例 4.50</strong></span> 以合肥市2021年冬季(2020年12月到2021年2月)6种空气污染物的日均浓度数据为例，演示psych包中fa函数在因子分析中的应用。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb282"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span>
<span id="cb282-2"><a href="#cb282-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb282-3"><a href="#cb282-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">read_csv</span>(<span class="st">"./data/hf-aqi-2021-winter.csv"</span>)</span>
<span id="cb282-4"><a href="#cb282-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df[ , <span class="dv">4</span><span class="sc">:</span><span class="dv">9</span>]</span>
<span id="cb282-5"><a href="#cb282-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 相关性检验</span></span>
<span id="cb282-6"><a href="#cb282-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cortest.bartlett</span>(<span class="fu">cor</span>(df), <span class="at">n =</span> <span class="fu">nrow</span>(df))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$chisq
[1] 157.8759

$p.value
[1] 6.526881e-26

$df
[1] 15</code></pre>
</div>
</div>
<p>根据p值，拒绝变量相关系数为0的假设，可以对数据进行因子分析。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">KMO</span>(<span class="fu">cor</span>(df))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Kaiser-Meyer-Olkin factor adequacy
Call: KMO(r = cor(df))
Overall MSA =  0.66
MSA for each item = 
PM2.5  PM10    CO   NO2   SO2 O3_8h 
 0.41  0.69  0.68  0.64  0.76  0.37 </code></pre>
</div>
</div>
<p>对于因子分析，KMO检验的总MSA值一般要求大于0.6，低于0.5则不建议进行因子分析。</p>
<p>确定提取多少个公因子对于因子分析非常关键，可用psych包中的<code>fa.parallel()</code>函数确定最佳的公因子数：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fa.parallel</span>(<span class="fu">cor</span>(df), <span class="at">fm =</span> <span class="st">"pa"</span>, <span class="at">fa =</span> <span class="st">"fa"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parallel analysis suggests that the number of factors =  3  and the number of components =  NA </code></pre>
</div>
<div class="cell-output-display">
<div id="fig-4.12" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.12-1.png" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.12-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.13: 平行分析碎石图
</figcaption>
</figure>
</div>
</div>
</div>
<p>该函数返回最佳公共因子数为3，同时返回一个平行分析的碎石图(<a href="#fig-4.12" class="quarto-xref">图&nbsp;<span>4.13</span></a>)。该函数中因子分解方法参数fm可选”minres”(最小残差法)、“ml”(极大似然估计法)、“uls”(与”minres”类似)、“wls”(加权最小二乘法)、“gls”(广义加权最小二乘法)以及 “pa”(主因子法)等，参数fa可选择”pc”、“fa”和”both”，以指定返回的结果和碎石图中显示主成分分析、因子分析或两者的结果。</p>
<p>接着利用<code>fa()</code>函数计算公共因子并返回载荷矩阵等信息。该函数除了要指定公共因子数参数nfactors外，还要指定公共因子解法参数fm以及载荷旋转方法参数rotate。fm参数设置同<code>fa.parallel()</code>函数。rotate参数包括正交旋转法(常用的有”varimax”、“quartimax”等)和斜交旋转法(常用的有”promax”、“oblimin”等)，前者使公共因子之间保持不相关，后者则让公共因子变得相关，常用于改善公共因子的可解释性。当rotate参数设置为”none”则不执行旋转，设置的详细信息参考函数帮助信息。下面采用主因子法(fm = “pa”)和最大方差法(rotate = “varimax”)求解：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a>fa_aqi <span class="ot">=</span> <span class="fu">fa</span>(<span class="fu">cor</span>(df), <span class="at">nfactors =</span> <span class="dv">3</span>, <span class="at">fm =</span> <span class="st">"pa"</span>, <span class="at">rotate =</span> <span class="st">"varimax"</span>)</span>
<span id="cb288-2"><a href="#cb288-2" aria-hidden="true" tabindex="-1"></a>fa_aqi</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Factor Analysis using method =  pa
Call: fa(r = cor(df), nfactors = 3, rotate = "varimax", fm = "pa")
Standardized loadings (pattern matrix) based upon correlation matrix
        PA1  PA2   PA3   h2   u2 com
PM2.5 -0.06 0.63  0.03 0.40 0.60 1.0
PM10   0.61 0.47 -0.02 0.60 0.40 1.9
CO    -0.77 0.29  0.07 0.67 0.33 1.3
NO2    0.93 0.07  0.04 0.88 0.12 1.0
SO2   -0.61 0.01 -0.47 0.59 0.41 1.9
O3_8h -0.01 0.02  0.47 0.22 0.78 1.0

                       PA1  PA2  PA3
SS loadings           2.21 0.71 0.45
Proportion Var        0.37 0.12 0.07
Cumulative Var        0.37 0.49 0.56
Proportion Explained  0.66 0.21 0.13
Cumulative Proportion 0.66 0.87 1.00

Mean item complexity =  1.3
Test of the hypothesis that 3 factors are sufficient.

df null model =  15  with the objective function =  1.83
df of  the model are 0  and the objective function was  0 

The root mean square of the residuals (RMSR) is  0 
The df corrected root mean square of the residuals is  NA 

Fit based upon off diagonal values = 1
Measures of factor score adequacy             
                                                   PA1  PA2   PA3
Correlation of (regression) scores with factors   0.96 0.77  0.67
Multiple R square of scores with factors          0.91 0.60  0.44
Minimum correlation of possible factor scores     0.82 0.20 -0.11</code></pre>
</div>
</div>
<p>返回结果首先给出的是标准化载荷矩阵，显示了三个因子对每个变量的标准化载荷。载荷大小表明因子对该变量的解释程度，其绝对值越接近1，解释程度越高，越接近0，解释程度越低，一般以0.5为临界值，PA1对PM10、CO、NO2和SO2的载荷绝对值都大于0.6，PA2仅对PM2.5的载荷绝对值大于0.6，PA3对SO2和O3_8h的载荷最大，但绝对值低于0.5。h2表示提取的因子对每个变量的解释程度，本例中三个因子对NO2的解释程度最高，而u2=1-h2，意义与h2相反。com是霍夫曼复杂度指数，反映原始变量受几个因子支配，本例中，对于PM10和SO2变量，都受两个因子的支配。</p>
<p>接下来的矩阵给出了三个因子的载荷平方和(SS Loadings)、所解释的方差(Proportion Var)、累积所解释的方差(Cumulative Var)、方差解释比例(Proportion Explained)和累积方差解释比例(Cumulative Proportion)。结果表明，三个因子所解释的累积方差只有0.56，其中PA1占比最大，为66%。</p>
<p>假设检验结果表明三个因子足以解释这些变量。</p>
<p>返回结果还包括因子得分充分性的测度，如相关性、R2、最小相关系数等。</p>
<p>利用<code>fa.diagram()</code>函数可以绘制出原始变量与公共因子之间的支配关系：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fa.diagram</span>(fa_aqi)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-4.14" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.14-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.14-1.png" class="img-fluid figure-img" width="384">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.14-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.14: 原始变量与公共因子之间的支配关系
</figcaption>
</figure>
</div>
</div>
</div>
<p>由 <a href="#fig-4.14" class="quarto-xref">图&nbsp;<span>4.14</span></a> 可见，前四个变量受第一个公共因子支配(红色表示载荷为负数)，PM2.5受第二个公共因子支配，O3_8h受第三个公共因子支配。在此基础上，可以尝试探究这三个公共因子的实际意义，PA1支配的4种污染物主要来自燃料燃烧、工业生产、机动车尾气排放等，可理解为初次污染物影响因子。PM2.5是PM10的组成部分，既有一次来源又有二次来源，还包括外源输入，因此PA2可能是综合的细颗粒物影响因子(PM10在PA2上的载荷为0.47)。O3是光化学反应产生的二次污染物，因此PA3可理解为二次污染物影响因子。</p>
<p>因子分子主要目的在于探究支配或影响原始变量的公共因子结构，而PCA方法则非常注重主成分的得分，以克服多变量多重共线性，用于建立定量模型。如果需要计算公共因子的得分，可以利用psych包中的<code>facotr.scores()</code>函数来计算，但计算结果因不同估计方法而不具有唯一性，而PCA中主成分的得分是唯一的。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb291"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" aria-hidden="true" tabindex="-1"></a>fs <span class="ot">=</span> <span class="fu">factor.scores</span>(df, fa_aqi, <span class="at">method =</span> <span class="st">"Thurstone"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>输入<code>fs$scores</code>即可浏览原始数据集中每个观测的公共因子变量的得分。</p>
<p>结构方程模型是一种建立、估计和检验研究系统中多变量间因果关系的模型方法，利用图形化模型来展示研究系统中变量间的因果网络关系，可以替代多元回归、因子分析、协方差分析等方法，已经成为多元数据分析的重要工具，并在地学、生态学、环境科学与工程、医学、社会学、经济学等领域中应用十分广泛。如果需要执行SEM分析，可安装lavaan包，并在<a href="https://lavaan.ugent.be/" class="uri">https://lavaan.ugent.be/</a>网站学习该包的使用。</p>
<div id="exr-4.6" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 4.6</strong></span> (1)安装pls工具包，导入该包中内置的gasoline数据集，该数据集包括60个汽油样品的近红外光谱数据(NIR矩阵)。NIR矩阵的401列对应401个波长(从900nm到1700nm间隔2nm一个波长)的漫反射系数，octane为对应的辛烷值(octane)。对NIR矩阵进行主成分分析，并对前2个主成分进行可视化；然后以octane为因变量，以前2个主成分为自变量建立线性回归模型，并进行综合检验。<br>
(2)基于内置数据集mtcars，执行因子分析；绘制前2个因子的载荷散点图，并标注对应的变量。</p>
</div>
</section>
</section>
<section id="聚类分析和判别分析" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="聚类分析和判别分析"><span class="header-section-number">4.5</span> 聚类分析和判别分析</h2>
<p>聚类分析和判别分析都属于分类研究方法。前者是在类型未知情况下，利用样品(观测)或变量间的相似性，对样品或变量进行分类(一般称之为簇)；后者是在类型已知情况下，利用样品的特征(变量)值按选定的判定规则进行归类。按照机器学习方法的分类方法，聚类分析属于无监督学习，而判别分析属于有监督学习，前者主要用于特征降维，后者主要用于分类任务。</p>
<section id="聚类分析" class="level3" data-number="4.5.1">
<h3 data-number="4.5.1" class="anchored" data-anchor-id="聚类分析"><span class="header-section-number">4.5.1</span> 聚类分析</h3>
<p>聚类分析也分为R型和Q型，前者对变量进行聚类，后者对样品进行聚类。通常，将聚集在一起的观测集合称之为一个簇(cluster)。聚类分析方法有很多种，包括基于划分的聚类(如k-means法等)、基于层次的聚类(如AGNES法等)、基于密度的聚类(如DBSACN法等)、基于网格或图的聚类(如STING法等)和基于模型的聚类(如EM法、SOM神经网络等)。聚类分析的目标就是使簇内相似度最高，簇间相似度最低。</p>
<p>聚类分析中相似度的测度有很多，例如欧氏距离、明氏距离(欧式距离的推广)、曼哈顿距离、马氏距离、切比雪夫距离、海明距离、余弦相似度、杰卡德相似系数(也称杰卡德指数)、杰卡德距离(杰卡德相似系数的补集，即与杰卡德相似系数之和为1)等。根据这些相似度的计算方法，可以编写相应的R语言聚类分析函数。</p>
<p>R语言已经预置了<code>kmeas()</code>和<code>hclust()</code>两个函数，分别用于执行k-means聚类和层次聚类(也称系统聚类)，此外，R包cluster、mclust、flexclust、fpc等还提供了更多类型的聚类分析方法。下面以R内置的iris数据集为例，利用cluster和factoextra包来演示Q型聚类分析。</p>
<div id="exm-4.51" class="theorem example">
<p><span class="theorem-title"><strong>例 4.51</strong></span> 对iris数据集进行聚类分析。</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> iris <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>先对各变量的观测值进行数值标准化：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a>dfs <span class="ot">=</span> <span class="fu">scale</span>(df)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>接着用<code>get_clust_tendency()</code>函数对聚类趋势进行评估：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a>ct <span class="ot">=</span> <span class="fu">get_clust_tendency</span>(dfs, <span class="dv">50</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>返回的结果为Hopkins统计量，该统计量的值越接近1，表明数据集的可聚类性越高，一般要求大于0.5。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>ct<span class="sc">$</span>hopkins_stat</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7997314</code></pre>
</div>
</div>
<p>下面用<code>eclust()</code>函数进行聚类分析。该函数先估计最佳聚类簇数，然后根据最佳聚类簇数和指定的聚类算法进行聚类。如果指定了参数k的值，则无需估计最佳聚类簇数，直接根据k的值进行聚类分析。实际上，<code>eclust()</code>估计最佳聚类簇数是调用cluster包中的<code>clusGap()</code>函数，该函数通过自举抽样方法计算从1到指定最大簇数(参数k.max，默认值为10)的Gap统计量来确定最佳聚类簇数。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 在1~6之间确定最佳簇数，并调用kmeans()函数执行聚类分析</span></span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a>kmc <span class="ot">=</span> <span class="fu">eclust</span>(df, <span class="at">FUNcluster =</span> <span class="st">"kmeans"</span>, <span class="at">k.max =</span> <span class="dv">6</span>, <span class="at">nboot =</span> <span class="dv">200</span>, </span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">seed =</span> <span class="dv">2022</span>, <span class="at">graph =</span> <span class="cn">FALSE</span>)</span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a>kmc<span class="sc">$</span>gap_stat</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Clustering Gap statistic ["clusGap"] from call:
cluster::clusGap(x = x, FUNcluster = fun_clust, K.max = k.max, B = nboot, verbose = verbose)
B=200 simulated reference sets, k = 1..6; spaceH0="scaledPCA"
 --&gt; Number of clusters (method 'firstSEmax', SE.factor=1): 3
         logW   E.logW        gap     SE.sim
[1,] 4.551642 4.639505 0.08786357 0.02798343
[2,] 3.808397 4.190886 0.38248862 0.02328599
[3,] 3.519407 4.011100 0.49169324 0.02410995
[4,] 3.446685 3.917451 0.47076570 0.02519009
[5,] 3.301023 3.836240 0.53521663 0.02487646
[6,] 3.248167 3.760672 0.51250510 0.02451569</code></pre>
</div>
</div>
<p>计算结果建议最佳簇数为3，这与iris数据集中的实际分类一致。 下面用factoextra包中的<code>fviz_gap_stat()</code>可视化最佳聚类簇数估计的结果，如 <a href="#fig-4.15" class="quarto-xref">图&nbsp;<span>4.15</span></a> 所示：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb299"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_gap_stat</span>(kmc<span class="sc">$</span>gap_stat)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-4.15" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.15-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.15-1.png" class="img-fluid figure-img" width="384">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.15-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.15: 通过Gap统计量估计最佳聚类簇数
</figcaption>
</figure>
</div>
</div>
</div>
<p>接着使用<code>fviz_cluster()</code>对样品聚类结果进行可视化，结果如 <a href="#fig-4.16" class="quarto-xref">图&nbsp;<span>4.16</span></a> 所示：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_cluster</span>(kmc, df)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-4.16" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.16-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.16-1.png" class="img-fluid figure-img" width="864">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.16-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.16: k-means聚类结果的样品簇分布
</figcaption>
</figure>
</div>
</div>
</div>
<p>已知iris中1-50、51-100以及101-150号样品分别归属为setosa、versicolor和virginica，查看哪些样品的聚类结果出现了偏差可以输入<code>view(as_tibble(kmc$cluster))</code>。</p>
<p>聚类结果有效性的评价方法分为外部评价法和内部评价法。外部评价法用于类别已知的数据集，包括纯度(Purity)、标准化互信息(Normalized Mutual Information)、兰德指数(Rand Index)、F值(F-score)等。内部评价法用于类别未知的数据集，同时考虑簇内和簇间相似度的评价指标有轮廓系数(Silhouette Coefficient)、CH指数(Calinski-Harabaz Index)、DB指数(Davies-Bouldin Index)、DV指数(Dunn Validity Index)等。这里只介绍轮廓系数的计算及其在R中的实现。对于某个样品，令a是其与同簇中其他样品的平均距离，b是与其距离最近的不同簇中样品的平均距离，则该样品的轮廓系数为</p>
<p><span id="eq-4.32"><span class="math display">
  s=\frac{b-a}{\text{max}⁡(a,b)}
\tag{4.32}</span></span></p>
<p>对于样品集合，其轮廓系数是所有样品轮廓系数的平均值。轮廓系数取值范围为[-1, 1]，取值越接近1表明聚类效果越好，越接近-1表明聚类效果越差。</p>
<p>cluster包中<code>silhouette()</code>函数用于计算轮廓系数：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb301"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a>sil <span class="ot">=</span> <span class="fu">silhouette</span>(kmc<span class="sc">$</span>cluster, <span class="fu">dist</span>(dfs))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>该函数返回以个n×3的矩阵(n为集合中样品总数)，给出每个样品所在的簇(列名为cluster)、最近的族(列名为neighbor)和轮廓系数(列名为sil_width)。</p>
<p>下面用fviz_silhouette()对轮廓系数进行可视化：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_silhouette</span>(sil)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  cluster size ave.sil.width
1       1   38          0.36
2       2   62          0.34
3       3   50          0.64</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-4.17" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.17-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.17-1.png" class="img-fluid figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.17-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.17: k-means聚类的轮廓系数
</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-4.17" class="quarto-xref">图&nbsp;<span>4.17</span></a> 显示簇3轮廓系数最大，簇1和簇2都较低，而且出现了负值。下面来查看负值对应的样品号：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a>sil <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row_ID =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb304-3"><a href="#cb304-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sil_width <span class="sc">&lt;</span> <span class="dv">0</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  cluster neighbor sil_width row_ID
    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; 
1       2        1  -0.226   51    
2       2        1  -0.0669  57    
3       2        1  -0.00928 66    
4       2        1  -0.124   87    
5       1        2  -0.0123  112   
6       1        2  -0.342   135   </code></pre>
</div>
</div>
<p>接下来采用层次聚类法(调用<code>hclust()函数</code>)进行聚类。为了与上面的k-means聚类结果进行公平的比较，最佳聚类簇数保持一致，即k = 3。但要注意，如果基于<code>hclust()</code>函数进行自举抽样估计，推荐聚类簇数为k = 5，按此簇数进行聚类，结果可以发现，簇数的增加主要是在原簇1和簇2下进行了细分。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb306"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" aria-hidden="true" tabindex="-1"></a>hc <span class="ot">=</span> <span class="fu">eclust</span>(df, <span class="at">FUNcluster =</span> <span class="st">"hclust"</span>, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">graph =</span> F)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>对样品聚类结果进行可视化，结果如 <a href="#fig-4.18" class="quarto-xref">图&nbsp;<span>4.18</span></a> 所示：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_cluster</span>(hc, df, <span class="at">labelsize =</span> <span class="dv">7</span>, <span class="at">pointsize =</span> <span class="dv">1</span>, <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>())</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-4.18" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.18-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.18-1.png" class="img-fluid figure-img" width="864">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.18-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.18: 层次聚类结果的样品簇分布
</figcaption>
</figure>
</div>
</div>
</div>
<p>计算轮廓系数并可视化，结果如 <a href="#fig-4.19" class="quarto-xref">图&nbsp;<span>4.19</span></a> 所示：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb308"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" aria-hidden="true" tabindex="-1"></a>sil_hc <span class="ot">=</span> <span class="fu">silhouette</span>(hc<span class="sc">$</span>cluster, <span class="fu">dist</span>(dfs))</span>
<span id="cb308-2"><a href="#cb308-2" aria-hidden="true" tabindex="-1"></a><span class="co">#rownames(sil_hc) = iris$Species</span></span>
<span id="cb308-3"><a href="#cb308-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_silhouette</span>(sil_hc)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  cluster size ave.sil.width
1       1   50          0.64
2       2   64          0.34
3       3   36          0.39</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-4.19" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.19-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.19-1.png" class="img-fluid figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.19-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.19: 层次聚类的轮廓系数
</figcaption>
</figure>
</div>
</div>
</div>
<p>比较 <a href="#fig-4.16" class="quarto-xref">图&nbsp;<span>4.16</span></a> 与 <a href="#fig-4.18" class="quarto-xref">图&nbsp;<span>4.18</span></a> ，可见k-means聚类和层次聚类的结果在簇1和簇2(层次聚类结果对应簇3和簇2)有差异，层次聚类结果略有改善。<a href="#fig-4.19" class="quarto-xref">图&nbsp;<span>4.19</span></a> 显示层次聚类方法的平均轮廓系数为0.45，略高于k-means聚类方法的0.44，且仍有个别样品的轮廓系数为负值，下面来查看这些样品：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a>sil_hc <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row_ID =</span> <span class="fu">rownames</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(sil_width <span class="sc">&lt;</span> <span class="dv">0</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  cluster neighbor sil_width row_ID
    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; 
1       2        3   -0.205  51    
2       2        3   -0.222  53    
3       2        3   -0.0557 57    
4       2        3   -0.0955 87    
5       3        2   -0.0326 112   </code></pre>
</div>
</div>
<p>结果显示只有5个样品的轮廓系数为负值，而k-means聚类结果则有6个样品为负值。</p>
<p>传统的k-means聚类算法不能用于非凸数据集，而且对噪声和离群点非常敏感，大数据集的聚类结果容易陷入局部最优。kernlab包提供的基于核函数的k均值算法(<code>kkmeans()</code>函数)能够克服经典k均值算法的缺点。此外，fpc包提供了很多灵活的聚类算法，其中就包括基于密度的聚类算法(<code>dbscan()</code>函数)，同时也提供了聚类簇数估计、聚类结果有效性评估以及可视化的功能。mclust包提供了基于模型的聚类分析方法(还具有分类和密度估计功能)，通过期望最大化(EM)算法拟合高斯有限混合模型。pvclust包提供了基于多尺度自举抽样方法来评估层次聚类算法的不确定性。</p>
</section>
<section id="判别分析" class="level3" data-number="4.5.2">
<h3 data-number="4.5.2" class="anchored" data-anchor-id="判别分析"><span class="header-section-number">4.5.2</span> 判别分析</h3>
<p>判别分析是在分类确定的条件下，根据样品的各种特征值(亦称判别变量)判定其类别归属问题的一种多元统计分析方法。判别分析需要先通过所谓的“训练样本”建立判别规则，然后利用判别规则对新的样品进行分类。 判别分析主要分为距离判别分析、Fisher判别分析和Bayes判别分析三大类。距离判别分析根据欧氏距离、马氏距离等测度建立判别规则。Fisher判别分析则是一种基于投影的方法，将高维数据投影到一维空间，并使得投影后的类间方差最大、类内方差最小，从而实现分类，包括线性判别分析(LDA)、二次判别分析(QDA)等。其中LDA假设每个类别的数据服从多元正态分布，且各类别的协方差矩阵相同，判别函数是线性的；而QDA则允许各类别的协方差矩阵不同，判别函数是非线性二次函数。Bayes判别分析(BDA)基于贝叶斯定理，利用先验概率和似然函数来计算后验概率，然后将样品划分到后验概率最大的类别中。</p>
<p>R中MASS包中的<code>lda()</code>和<code>qda()</code>函数分别用于执行LDA和QDA。mda包中的<code>mda()</code>函数用于混合判别分析(MDA)，该方法仍然假设各类别的协方差矩阵相同，但每个类别被假设为子类的高斯混合)；该包中的<code>fda()</code>函数则用于弹性判别分析(FDA)，这是LDA的一种扩展，用于处理非线性关系或多变量非正态分布。klaR包中的<code>rda()</code>函数用于正则化判别分析(RDA)，对于存在多重共线性的数据集更稳健。klaR包中的<code>NaiveBayes()</code>函数和e1071包中的<code>naiveBayes()</code>函数都可用于执行BDA。距离判别分析可用kknn包中的<code>kknn()</code>函数，该函数执行k最近邻算法(k-Nearest Neighbor)，这也是一种原理简单但高效的机器学习算法。</p>
<p>下面演示LDA和BDA在内置数据集iris上的应用。</p>
<div id="exm-4.52" class="theorem example">
<p><span class="theorem-title"><strong>例 4.52</strong></span> 对iris数据集应用LDA和BDA。</p>
</div>
<p>先加载相关的R包：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(klaR)</span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>载入iris数据集：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> iris </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>将数据集分割为训练集和测试集：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb314"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2022</span>)</span>
<span id="cb314-2"><a href="#cb314-2" aria-hidden="true" tabindex="-1"></a>dftr <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Species) <span class="sc">%&gt;%</span> <span class="fu">sample_n</span>(<span class="dv">40</span>) </span>
<span id="cb314-3"><a href="#cb314-3" aria-hidden="true" tabindex="-1"></a>dfte <span class="ot">=</span> <span class="fu">setdiff</span>(df,dftr)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>基于训练集建立LDA判别模型：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb315"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" aria-hidden="true" tabindex="-1"></a>m_lda <span class="ot">=</span> <span class="fu">lda</span>(Species <span class="sc">~</span> ., <span class="at">data =</span> dftr)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>对预测集进行预测：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a>pre_lda <span class="ot">=</span> <span class="fu">predict</span>(m_lda, dfte)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>比较实际分类和LDA模型分类结果：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">tbl_tr_lda =</span> <span class="fu">table</span>(dftr<span class="sc">$</span>Species, <span class="fu">predict</span>(m_lda, dftr)<span class="sc">$</span>class))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            
             setosa versicolor virginica
  setosa         40          0         0
  versicolor      0         39         1
  virginica       0          0        40</code></pre>
</div>
</div>
<p>训练集上，LDA方法将1个veriscolor类的样品错分为virginica类。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb319"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">tbl_te_lda =</span> <span class="fu">table</span>(dfte<span class="sc">$</span>Species, pre_lda<span class="sc">$</span>class))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            
             setosa versicolor virginica
  setosa         10          0         0
  versicolor      0          9         1
  virginica       0          1         9</code></pre>
</div>
</div>
<p>预测集上，LDA方法分别将versicolor和virginica类中的1个样品错分。</p>
<p>下面来计算LDA方法的判对率：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb321"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"训练判对率："</span>, <span class="fu">sum</span>(<span class="fu">diag</span>(<span class="fu">prop.table</span>(tbl_tr_lda))))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>训练判对率： 0.9916667</code></pre>
</div>
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)    <span class="co"># 换行</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb324"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb324-1"><a href="#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"预测判对率："</span>, <span class="fu">sum</span>(<span class="fu">diag</span>(<span class="fu">prop.table</span>(tbl_te_lda))))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>预测判对率： 0.9333333</code></pre>
</div>
</div>
<p>接下来采用klaR包中<code>NaiveBayes()</code>函数进行BDA。 基于训练集建立BDA模型：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a>m_bda <span class="ot">=</span> <span class="fu">NaiveBayes</span>(Species <span class="sc">~</span> ., <span class="at">data =</span> dftr)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>对预测集进行预测：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb327"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb327-1"><a href="#cb327-1" aria-hidden="true" tabindex="-1"></a>pre_bda <span class="ot">=</span> <span class="fu">predict</span>(m_bda, dfte)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>比较实际分类和BDA模型分类结果：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb328"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">tbl_tr_bda =</span> <span class="fu">table</span>(dftr<span class="sc">$</span>Species, <span class="fu">predict</span>(m_bda, dftr)<span class="sc">$</span>class))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            
             setosa versicolor virginica
  setosa         40          0         0
  versicolor      0         38         2
  virginica       0          3        37</code></pre>
</div>
</div>
<p>在训练集上，与LDA相比，BDA错分了5个样品。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb330"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">tbl_te_bda =</span> <span class="fu">table</span>(dfte<span class="sc">$</span>Species, pre_bda<span class="sc">$</span>class))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            
             setosa versicolor virginica
  setosa         10          0         0
  versicolor      0         10         0
  virginica       0          1         9</code></pre>
</div>
</div>
<p>在预测集上，与LDA相比，Bayes判别分析只错分了virginica类别中的1个样品。 下面来计算Bayes方法的判对率：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"训练判对率："</span>, <span class="fu">sum</span>(<span class="fu">diag</span>(<span class="fu">prop.table</span>(tbl_tr_bda))))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>训练判对率： 0.9583333</code></pre>
</div>
<div class="sourceCode cell-code" id="cb334"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb335"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb335-1"><a href="#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"预测判对率："</span>, <span class="fu">sum</span>(<span class="fu">diag</span>(<span class="fu">prop.table</span>(tbl_te_bda))))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>预测判对率： 0.9666667</code></pre>
</div>
</div>
<p>LDA模型可以通过<code>plot()</code>函数进行可视化，具体参考其帮助信息。klaR包中的<code>partimat()</code>函数可以基于指定的判别方法对数据集中所有判别变量的两两组合进行可视化，其中参数method可指定为”lda”、“qda”、“rpart”(决策树方法)、“naiveBayes”、“rda”、“sknn”(简单k最近邻方法)和”svmlight”(支持向量机方法，需要安装<a href="https://www.cs.cornell.edu/people/tj/svm_light/">SVMlight</a>软件)。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb337"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb337-1"><a href="#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(klaR)</span>
<span id="cb337-2"><a href="#cb337-2" aria-hidden="true" tabindex="-1"></a><span class="fu">partimat</span>(Species <span class="sc">~</span> ., <span class="at">data =</span> iris, <span class="at">method =</span> <span class="st">"lda"</span>, <span class="at">main =</span> <span class="st">"LDA"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-4.20" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.20-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.20-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.20: 线性判别分析可视化
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="fu">partimat</span>(Species <span class="sc">~</span> ., <span class="at">data =</span> iris, <span class="at">method =</span> <span class="st">"qda"</span>, <span class="at">main =</span> <span class="st">"QDA"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-4.21" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.21-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.21-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.21-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.21: 二次判别分析可视化
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb339"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb339-1"><a href="#cb339-1" aria-hidden="true" tabindex="-1"></a><span class="fu">partimat</span>(Species <span class="sc">~</span> ., <span class="at">data =</span> iris, <span class="at">method =</span> <span class="st">"rda"</span>, <span class="at">main =</span> <span class="st">"RDA"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-4.22" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.22-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.22-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.22-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.22: 稳健判别分析可视化
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(klaR)</span>
<span id="cb340-2"><a href="#cb340-2" aria-hidden="true" tabindex="-1"></a><span class="fu">partimat</span>(Species <span class="sc">~</span> ., <span class="at">data =</span> iris, <span class="at">method =</span> <span class="st">"naiveBayes"</span>, <span class="at">main =</span> <span class="st">"BDA"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-4.23" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.23-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.23-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.23-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.23: 贝叶斯判别分析可视化
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb341"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb341-1"><a href="#cb341-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(klaR)</span>
<span id="cb341-2"><a href="#cb341-2" aria-hidden="true" tabindex="-1"></a><span class="fu">partimat</span>(Species <span class="sc">~</span> ., <span class="at">data =</span> iris, <span class="at">method =</span> <span class="st">"rpart"</span>, <span class="at">main =</span> <span class="st">"RPART"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-4.24" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.24-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.24-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.24-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.24: 决策树判别分析可视化
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb342"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(klaR)</span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a><span class="fu">partimat</span>(Species <span class="sc">~</span> ., <span class="at">data =</span> iris, <span class="at">method =</span> <span class="st">"sknn"</span>, <span class="at">main =</span> <span class="st">"KNN"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-4.25" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-4.25-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="CH4_files/figure-html/fig-4.25-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-4.25-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;4.25: k最近邻判别分析可视化
</figcaption>
</figure>
</div>
</div>
</div>
<div id="exr-4.7" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 4.7</strong></span> (1)从<a href="https://archive.ics.uci.edu/dataset/109/wine" class="uri">https://archive.ics.uci.edu/dataset/109/wine</a>下载数据，基于葡萄酒化学分析变量进行聚类分析，然后根据class变量评价聚类分析的结果。<br>
(2)继续基于上述wine数据集，执行LDA和BDA。</p>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "已复制");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "已复制");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./CH3.html" class="pagination-link" aria-label="环境数据整理与可视化">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">环境数据整理与可视化</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./CH5.html" class="pagination-link" aria-label="R语言机器学习建模">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">R语言机器学习建模</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>环境数据分析与机器学习，邓大鹏 编著.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>本书采用<a href="https://quarto.org/">Quarto</a>构建.</p>
</div>
  </div>
</footer>




</body></html>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>环境数据分析与机器学习 - 2&nbsp; R语言编程基础</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./CH3.html" rel="next">
<link href="./CH1.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/kbd/kbd.js"></script>
<link href="site_libs/quarto-contrib/kbd/kbd.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="edaml.scss">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./CH1.html">基础知识</a></li><li class="breadcrumb-item"><a href="./CH2.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">R语言编程基础</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">环境数据分析与机器学习</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="搜索"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">前言</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">基础知识</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CH1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">绪论</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CH2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">R语言编程基础</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CH3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">环境数据整理与可视化</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">进阶知识</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CH4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">环境数据统计分析</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CH5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">R语言机器学习建模</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">高阶知识</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./CH6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">R语言深度学习建模</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">参考文献</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目录</h2>
   
  <ul>
  <li><a href="#帮助系统和工具包管理" id="toc-帮助系统和工具包管理" class="nav-link active" data-scroll-target="#帮助系统和工具包管理"><span class="header-section-number">2.1</span> 帮助系统和工具包管理</a>
  <ul>
  <li><a href="#帮助系统" id="toc-帮助系统" class="nav-link" data-scroll-target="#帮助系统"><span class="header-section-number">2.1.1</span> 帮助系统</a>
  <ul class="collapse">
  <li><a href="#帮助菜单" id="toc-帮助菜单" class="nav-link" data-scroll-target="#帮助菜单"><span class="header-section-number">2.1.1.1</span> 帮助菜单</a></li>
  <li><a href="#帮助命令" id="toc-帮助命令" class="nav-link" data-scroll-target="#帮助命令"><span class="header-section-number">2.1.1.2</span> 帮助命令</a></li>
  <li><a href="#帮助图形界面" id="toc-帮助图形界面" class="nav-link" data-scroll-target="#帮助图形界面"><span class="header-section-number">2.1.1.3</span> 帮助图形界面</a></li>
  </ul></li>
  <li><a href="#r包管理" id="toc-r包管理" class="nav-link" data-scroll-target="#r包管理"><span class="header-section-number">2.1.2</span> R包管理</a>
  <ul class="collapse">
  <li><a href="#查询r包" id="toc-查询r包" class="nav-link" data-scroll-target="#查询r包"><span class="header-section-number">2.1.2.1</span> 查询R包</a></li>
  <li><a href="#安装和更新r包" id="toc-安装和更新r包" class="nav-link" data-scroll-target="#安装和更新r包"><span class="header-section-number">2.1.2.2</span> 安装和更新R包</a></li>
  <li><a href="#加载卸载和删除r包" id="toc-加载卸载和删除r包" class="nav-link" data-scroll-target="#加载卸载和删除r包"><span class="header-section-number">2.1.2.3</span> 加载、卸载和删除R包</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#基本语法" id="toc-基本语法" class="nav-link" data-scroll-target="#基本语法"><span class="header-section-number">2.2</span> 基本语法</a>
  <ul>
  <li><a href="#变量命名" id="toc-变量命名" class="nav-link" data-scroll-target="#变量命名"><span class="header-section-number">2.2.1</span> 变量命名</a></li>
  <li><a href="#运算符号" id="toc-运算符号" class="nav-link" data-scroll-target="#运算符号"><span class="header-section-number">2.2.2</span> 运算符号</a>
  <ul class="collapse">
  <li><a href="#sec-math-symbol" id="toc-sec-math-symbol" class="nav-link" data-scroll-target="#sec-math-symbol"><span class="header-section-number">2.2.2.1</span> 赋值符号</a></li>
  <li><a href="#数学运算符号" id="toc-数学运算符号" class="nav-link" data-scroll-target="#数学运算符号"><span class="header-section-number">2.2.2.2</span> 数学运算符号</a></li>
  <li><a href="#关系运算符号" id="toc-关系运算符号" class="nav-link" data-scroll-target="#关系运算符号"><span class="header-section-number">2.2.2.3</span> 关系运算符号</a></li>
  <li><a href="#逻辑运算符号" id="toc-逻辑运算符号" class="nav-link" data-scroll-target="#逻辑运算符号"><span class="header-section-number">2.2.2.4</span> 逻辑运算符号</a></li>
  <li><a href="#其他运算符号" id="toc-其他运算符号" class="nav-link" data-scroll-target="#其他运算符号"><span class="header-section-number">2.2.2.5</span> 其他运算符号</a></li>
  </ul></li>
  <li><a href="#数据类型和数据结构" id="toc-数据类型和数据结构" class="nav-link" data-scroll-target="#数据类型和数据结构"><span class="header-section-number">2.2.3</span> 数据类型和数据结构</a>
  <ul class="collapse">
  <li><a href="#数据类型" id="toc-数据类型" class="nav-link" data-scroll-target="#数据类型"><span class="header-section-number">2.2.3.1</span> 数据类型</a></li>
  <li><a href="#数据结构" id="toc-数据结构" class="nav-link" data-scroll-target="#数据结构"><span class="header-section-number">2.2.3.2</span> 数据结构</a></li>
  <li><a href="#访问数据和获取子集" id="toc-访问数据和获取子集" class="nav-link" data-scroll-target="#访问数据和获取子集"><span class="header-section-number">2.2.3.3</span> 访问数据和获取子集</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#常用函数" id="toc-常用函数" class="nav-link" data-scroll-target="#常用函数"><span class="header-section-number">2.3</span> 常用函数</a>
  <ul>
  <li><a href="#常用数学函数" id="toc-常用数学函数" class="nav-link" data-scroll-target="#常用数学函数"><span class="header-section-number">2.3.1</span> 常用数学函数</a></li>
  <li><a href="#常用统计函数" id="toc-常用统计函数" class="nav-link" data-scroll-target="#常用统计函数"><span class="header-section-number">2.3.2</span> 常用统计函数</a></li>
  <li><a href="#常用字符串处理函数" id="toc-常用字符串处理函数" class="nav-link" data-scroll-target="#常用字符串处理函数"><span class="header-section-number">2.3.3</span> 常用字符串处理函数</a></li>
  <li><a href="#常用数据处理函数" id="toc-常用数据处理函数" class="nav-link" data-scroll-target="#常用数据处理函数"><span class="header-section-number">2.3.4</span> 常用数据处理函数</a></li>
  <li><a href="#常用日期时间处理函数" id="toc-常用日期时间处理函数" class="nav-link" data-scroll-target="#常用日期时间处理函数"><span class="header-section-number">2.3.5</span> 常用日期时间处理函数</a>
  <ul class="collapse">
  <li><a href="#生成日期时间对象函数" id="toc-生成日期时间对象函数" class="nav-link" data-scroll-target="#生成日期时间对象函数"><span class="header-section-number">2.3.5.1</span> 生成日期时间对象函数</a></li>
  <li><a href="#提取日期时间数据中的要素" id="toc-提取日期时间数据中的要素" class="nav-link" data-scroll-target="#提取日期时间数据中的要素"><span class="header-section-number">2.3.5.2</span> 提取日期时间数据中的要素</a></li>
  <li><a href="#获取当前日期和时间" id="toc-获取当前日期和时间" class="nav-link" data-scroll-target="#获取当前日期和时间"><span class="header-section-number">2.3.5.3</span> 获取当前日期和时间</a></li>
  <li><a href="#创建和操作时间间隔" id="toc-创建和操作时间间隔" class="nav-link" data-scroll-target="#创建和操作时间间隔"><span class="header-section-number">2.3.5.4</span> 创建和操作时间间隔</a></li>
  <li><a href="#时区操作函数" id="toc-时区操作函数" class="nav-link" data-scroll-target="#时区操作函数"><span class="header-section-number">2.3.5.5</span> 时区操作函数</a></li>
  </ul></li>
  <li><a href="#因子型数据处理函数" id="toc-因子型数据处理函数" class="nav-link" data-scroll-target="#因子型数据处理函数"><span class="header-section-number">2.3.6</span> 因子型数据处理函数</a></li>
  <li><a href="#其他常用函数" id="toc-其他常用函数" class="nav-link" data-scroll-target="#其他常用函数"><span class="header-section-number">2.3.7</span> 其他常用函数</a></li>
  </ul></li>
  <li><a href="#数据读写" id="toc-数据读写" class="nav-link" data-scroll-target="#数据读写"><span class="header-section-number">2.4</span> 数据读写</a>
  <ul>
  <li><a href="#纯文本数据读写" id="toc-纯文本数据读写" class="nav-link" data-scroll-target="#纯文本数据读写"><span class="header-section-number">2.4.1</span> 纯文本数据读写</a></li>
  <li><a href="#excel数据读写" id="toc-excel数据读写" class="nav-link" data-scroll-target="#excel数据读写"><span class="header-section-number">2.4.2</span> Excel数据读写</a></li>
  <li><a href="#r格式数据读写" id="toc-r格式数据读写" class="nav-link" data-scroll-target="#r格式数据读写"><span class="header-section-number">2.4.3</span> R格式数据读写</a></li>
  <li><a href="#其他格式数据读写" id="toc-其他格式数据读写" class="nav-link" data-scroll-target="#其他格式数据读写"><span class="header-section-number">2.4.4</span> 其他格式数据读写</a></li>
  <li><a href="#大数据文件读写" id="toc-大数据文件读写" class="nav-link" data-scroll-target="#大数据文件读写"><span class="header-section-number">2.4.5</span> 大数据文件读写</a></li>
  </ul></li>
  <li><a href="#控制结构和自定义函数" id="toc-控制结构和自定义函数" class="nav-link" data-scroll-target="#控制结构和自定义函数"><span class="header-section-number">2.5</span> 控制结构和自定义函数</a>
  <ul>
  <li><a href="#表达式" id="toc-表达式" class="nav-link" data-scroll-target="#表达式"><span class="header-section-number">2.5.1</span> 表达式</a></li>
  <li><a href="#分支结构" id="toc-分支结构" class="nav-link" data-scroll-target="#分支结构"><span class="header-section-number">2.5.2</span> 分支结构</a>
  <ul class="collapse">
  <li><a href="#ifelse" id="toc-ifelse" class="nav-link" data-scroll-target="#ifelse"><span class="header-section-number">2.5.2.1</span> <code>ifelse</code></a></li>
  <li><a href="#if和ifelse" id="toc-if和ifelse" class="nav-link" data-scroll-target="#if和ifelse"><span class="header-section-number">2.5.2.2</span> <code>if</code>和<code>if</code>…<code>else</code>…</a></li>
  </ul></li>
  <li><a href="#循环结构" id="toc-循环结构" class="nav-link" data-scroll-target="#循环结构"><span class="header-section-number">2.5.3</span> 循环结构</a>
  <ul class="collapse">
  <li><a href="#for循环" id="toc-for循环" class="nav-link" data-scroll-target="#for循环"><span class="header-section-number">2.5.3.1</span> <code>for</code>循环</a></li>
  <li><a href="#while和repeat循环" id="toc-while和repeat循环" class="nav-link" data-scroll-target="#while和repeat循环"><span class="header-section-number">2.5.3.2</span> <code>while</code>和<code>repeat</code>循环</a></li>
  <li><a href="#循环遍历的替代方法" id="toc-循环遍历的替代方法" class="nav-link" data-scroll-target="#循环遍历的替代方法"><span class="header-section-number">2.5.3.3</span> 循环遍历的替代方法</a></li>
  </ul></li>
  <li><a href="#自定义函数" id="toc-自定义函数" class="nav-link" data-scroll-target="#自定义函数"><span class="header-section-number">2.5.4</span> 自定义函数</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./CH1.html">基础知识</a></li><li class="breadcrumb-item"><a href="./CH2.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">R语言编程基础</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">R语言编程基础</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>与通用编程语言Python等不同，R是一种主要用于数据处理、统计分析、可视化以及沟通的统计编程语言和操作环境，语法通俗易懂，易于学习并掌握。R是属于GNU系统的一个自由、免费、源代码开放的软件，与SAS、SPSS等相比，用户可以在R中获得最新的统计方法和技术。R具有优秀的交互性，和Matlab一样，既可以从命令行运行，也可以编写脚本程序。此外，R通过R Markdown和Quarto，将文本、图表、代码及运行结果融为一体，形成沟通性极好的可重复的报告。</p>
<p>R在数据科学领域具有优势，其劣势在于代码执行效率低于编译执行的编程语言，内存管理也被用户诟病。但R语言可以通过Rcpp包实现R与C/C++的混合编程，来提高运算速度和执行效率。随着计算机硬件性能的极大提升，执行速度慢的劣势相对弱化。即使是大数据，R依然能够通过专门的工具包来处理和分析。来自全世界各行各业的专家持续地为R贡献了大量的专业且创新的工具包，为相应领域的专业人员提供了极为灵活和高效的数据处理、统计分析、可视化与建模技术，不断丰富和拓展R的功能。</p>
<p>R作为一套完整的数据(包括大数据)处理、分析、建模和可视化编程软件系统，其功能包括：数据导入和存储(支持多种数据格式以及大数据)、数据整理和转换、矩阵运算、统计分析、可视化(专业统计制图)以及统计学习、机器学习甚至深度学习建模。</p>
<p>R分为基础版和整洁版，前者一般称为base-R，后者一般称为tidy-R，基于tidyverse生态。本章基于RStudio集成开发环境来学习R语言的基础知识，包括帮助系统、工具包的管理、数据类型与结构、常用函数、数据读写、控制结构和自定义函数。</p>
<section id="帮助系统和工具包管理" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="帮助系统和工具包管理"><span class="header-section-number">2.1</span> 帮助系统和工具包管理</h2>
<section id="帮助系统" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="帮助系统"><span class="header-section-number">2.1.1</span> 帮助系统</h3>
<section id="帮助菜单" class="level4" data-number="2.1.1.1">
<h4 data-number="2.1.1.1" class="anchored" data-anchor-id="帮助菜单"><span class="header-section-number">2.1.1.1</span> 帮助菜单</h4>
<p>在RStudio的“Help”菜单中，点击“<strong>R Help</strong>”菜单项，会在工作界面右下区的<strong>Help</strong>标签内打开基于HTML格式的帮助系统页面，内容包括： R的学习资源、RStudio的学习资源、R的学习手册、包索引和关键字搜索、其他资料。利用以上资源可以系统地学习R和RStudio的使用。</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-2.1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-2.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/fig2.1.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-2.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;2.1: R和RStudio的帮助页面
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="帮助命令" class="level4" data-number="2.1.1.2">
<h4 data-number="2.1.1.2" class="anchored" data-anchor-id="帮助命令"><span class="header-section-number">2.1.1.2</span> 帮助命令</h4>
<p>在R中，用户可以在控制台中快捷地获取有关函数或R包的帮助信息。</p>
<p><strong>?包名::函数名</strong>：精确查询R包中函数的帮助信息，如<code>?ggplot2::qplot</code>执行。如果包已经加载，则直接执行<strong>?函数名</strong>，如<code>?qplot</code>。</p>
<p><strong>??关键词</strong>：通过关键词进行模糊搜索。等同于<strong>help.search(‘关键词’)</strong>，注意要加英文引号(单引号和双引号均可)。如<code>??mean</code>。</p>
<p><strong>help(package = 包名)</strong>：打开R包的帮助页面，如<code>help(package = mlr3)</code>。</p>
</section>
<section id="帮助图形界面" class="level4" data-number="2.1.1.3">
<h4 data-number="2.1.1.3" class="anchored" data-anchor-id="帮助图形界面"><span class="header-section-number">2.1.1.3</span> 帮助图形界面</h4>
<p>在RStudio工作界面中Help标签区，有一个关键字搜索的输入框(<a href="#fig-2.1" class="quarto-xref">图&nbsp;<span>2.1</span></a>)，也可通过单击“<strong>Help</strong>”菜单中“Search R Help”或使用组合键<kbd aria-hidden="true">Ctrl+Alt+F1</kbd><span class="visually-hidden">Ctrl+Alt+F1</span>快速定位至此，输入关键字来搜索相关的帮助信息。注意组合键可能与其他软件的冲突。</p>
<div id="exr-2.1" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 2.1</strong></span> (1)打开R分别查询函数<code>plot()</code>、<code>summary()</code>、<code>mean()</code>、<code>var()</code>、<code>sd()</code>的帮助信息。<br>
(2)查询stats包的帮助信息。</p>
</div>
</section>
</section>
<section id="r包管理" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="r包管理"><span class="header-section-number">2.1.2</span> R包管理</h3>
<p>众多工具包为R提供了很多专业功能的扩展。大多数R包集成了封装好的函数、数据和示例。目前，R已经拥有2万多个工具包(其中一些已经停止更新，甚至废弃)，主要存储在CRAN网站，该网站上的R包都经过了严格的审查。另外，Bioconductor网站提供了生物信息学相关的R包，github等网站上也有一些未经官方审查的R包。<br>
R安装后，内置的base、methods、datasets、utils、grDevices、graphics和stats等7个基础工具包随R的启动而自动加载，能够实现基本的数据处理、可视化和统计建模功能。但R的很多专业功能都是由第三方R包提供的，因此,必须掌握R包的查询、安装、更新、卸载和删除等操作。</p>
<section id="查询r包" class="level4" data-number="2.1.2.1">
<h4 data-number="2.1.2.1" class="anchored" data-anchor-id="查询r包"><span class="header-section-number">2.1.2.1</span> 查询R包</h4>
<p>CRAN网站提供了Task Views来归类众多的工具包，用户可从中查询相关的R包。例如有关空间数据分析的R包，可在Spatial和SpatioTemporal中查询。有关生态环境数据分析的R包，可在Environmetrics中查询。有关高性能计算和大数据处理的R包，可在HighPerformanceComputing中查询。有关机器学习的R包可在MachineLearning中查询。R包packagefinder提供了从R中控制台直接搜索CRAN网站上R包的功能。R包ctv提供了在本地安装任务分类视图和查询的功能。</p>
<p>查询本地已经安装的R包，可使用<code>installed.packages()</code>函数，或者在RStudio工作界面点击“Packages”标签。查看当前工作空间已经加载的R包，可在控制台输入<code>(.packages())</code>。<br>
输入<code>.packages(all.available = TRUE)</code> 可列出默认工具包安装目录中所有R包的名称列表。</p>
</section>
<section id="安装和更新r包" class="level4" data-number="2.1.2.2">
<h4 data-number="2.1.2.2" class="anchored" data-anchor-id="安装和更新r包"><span class="header-section-number">2.1.2.2</span> 安装和更新R包</h4>
<p>从CRAN网站安装R包使用函数<code>install.packages()</code>。该函数在安装R包时会自动分析并安装其依赖项(即其他R包)。例如安装tidyverse套件：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>该函数包含很多参数，重要的参数包括lib和repos，前者用于指定R包的安装目录(不指定即安装到默认的目录中)，后者用于指定包的来源。要查询本地安装包的目录，可以用<code>.libPaths()</code>函数。</p>
<p>从github网站下载安装R包，需要先安装remotes包或devtools包，然后通过二者提供的<code>install_github()</code>函数。除此以外，这两个包也提供了多个从其他途径下载和安装R包的函数，如<code>install_bioc()</code>函数可从Bioconductor网站下载安装R包。 例如，从<a href="https://github.com/mlr-org" class="uri">https://github.com/mlr-org</a>下载安装mlr3包：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"mlr-org/mlr3"</span>)  </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>或</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"mlr-org/mlr3"</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>在包名后用<code>::</code>连接函数名的做法，是一种无需加载R包即可调用其中函数的方法。这在仅使用某个R包中的一个或少数函数时，可以避免将整个包都加载到工作空间，以减少资源占用。同时，这种调用函数的方法也能够避免工作空间中同名函数的冲突。</p>
<p>可以将R包的安装包下载到本地进行安装，在RStudio中，点击“<strong>Tools</strong>”菜单中的“Install Packages…”，在弹出的对话框中，将“Install from”改为“Package Achive File”，然后点击“Browse”按钮找到已经下载到本地的R包压缩包，然后点击“Install”按钮即可。在安装Windows的电脑上，安装未编译的R包需要先安装Rtools软件，以提供本机编译功能。</p>
<p>更新已安装到本地的R包的函数为<code>update.packages()</code>。该函数会将本地安装的包与CRAN仓库中的包进行版本比较，如果有新版本，则提示更新。在RStudio中更新所有本地安装的包，通过点击“<strong>Tools</strong>”菜单中的“Check for Package Updates…”即可。</p>
</section>
<section id="加载卸载和删除r包" class="level4" data-number="2.1.2.3">
<h4 data-number="2.1.2.3" class="anchored" data-anchor-id="加载卸载和删除r包"><span class="header-section-number">2.1.2.3</span> 加载、卸载和删除R包</h4>
<p>加载R包使用<code>library()</code>函数或<code>require()</code>函数。二者都会在加载前检查是否已经安装了指定的包，如果没有，前者会报错，后者也会报错并返回逻辑值FALSE；如果有，则二者都执行加载，但后者还返回逻辑值TRUE。如加载ggplot2包：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>或</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggplot2)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>卸载R包是将指定的R包从当前工作空间中清除，而不是从磁盘中删除。卸载R包的方法是使用<code>detach()</code>函数。如卸载当前工作空间中的ggplot2包：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">detach</span>(package<span class="sc">:</span>ggplot2) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>注意<code>package:</code>前缀必须加上。该函数还可用于卸载当前工作空间中通过<code>attach()</code>函数加载的数据框对象。</p>
<p>需要删除已经安装的R包，使用<code>remove.packages()</code>函数。</p>
<div id="exr-2.2" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 2.2</strong></span> (1)在RStudio控制台用<code>install.packages()</code>函数完成tidyverse套件和remotes包的安装。<br>
(2)在RStudio控制台用remotes包中的<code>install_github()</code>函数完成mlr3包和mlr3verse套件的安装。<br>
(3)在RStudio控制台输入<code>?airquality</code>，查询数据集airquality的帮助信息，了解该数据集。<br>
(4)在RStudio控制台用<code>library()</code>函数加载ggplot2包，然后输入如下代码并观察结果：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(airquality, </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(Solar.R, Ozone, <span class="at">color =</span> Month)) <span class="sc">+</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
</section>
</section>
<section id="基本语法" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="基本语法"><span class="header-section-number">2.2</span> 基本语法</h2>
<section id="变量命名" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="变量命名"><span class="header-section-number">2.2.1</span> 变量命名</h3>
<p>R语言中有效的变量名(也包括对象名)称由英文字母、数字以及点号<code>.</code>或下划线<code>_</code>组成，英文字母区分大小写，不能包含空格。变量名称只能以字母或点号<code>.</code>开头，以点号<code>.</code>开头时，后面只能直接跟英文字母和下划线<code>_</code>。变量名中不可有空格。如<code>a</code>、<code>.a</code>、<code>.a1</code>、<code>a1</code>、<code>a.1</code>、<code>A_1</code>、<code>O3</code>、<code>o3_8h</code>等都是合法R变量名。而<code>a 1</code>、<code>1a</code>、<code>_a1</code>、<code>.1a</code>等都是无效变量名称。变量的命名要能够表明变量意义，建议变量名只采用小写字母、数字和下划线<code>_</code>，尽可能不采用点号<code>.</code>。</p>
<p>经常使用的常量建议以大写字母表示。无论是变量还是常量的命名，不应与R语言的保留关键字(如<code>if</code>、<code>ifelse</code>、<code>while</code>等)及常用函数名相同。</p>
<p>此外，R中还有几个关键字具有特殊含义，有特殊用途，要特别注意。<code>NA</code>一般用于缺失值(占位)，<code>NULL</code>表示空值(不占位)，<code>NaN</code>表示不是一个数(例如0/0的结果)，<code>Inf</code>和<code>-Inf</code>分别表示正无穷大(1/0)和负无穷大(-1/0)。<code>pi</code>是R规定的一个系统常量，即圆周率的值。<code>LETTERS</code>和<code>letters</code>分别存储了26个大写和小写英文字母。<code>month.name</code>和<code>month.abb</code>分别存储了十二个月份的英文名和缩写。</p>
</section>
<section id="运算符号" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="运算符号"><span class="header-section-number">2.2.2</span> 运算符号</h3>
<section id="sec-math-symbol" class="level4" data-number="2.2.2.1">
<h4 data-number="2.2.2.1" class="anchored" data-anchor-id="sec-math-symbol"><span class="header-section-number">2.2.2.1</span> 赋值符号</h4>
<p>左赋值：<code>&lt;-</code>(可用组合键<kbd> Alt </kbd> + <kbd> - </kbd>输入)或<code>=</code> 以及<code>&lt;&lt;-</code>，都是将右边的值赋给左边的变量。大多数情况下，<code>=</code>可以替代<code>&lt;-</code>，，例如<code>o3 &lt;- 43</code>或<code>o3 = 43</code>。但<code>=</code>多用于传值，而非赋值。此外，两者的作用域存在差异，例如：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'x' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
</div>
<p>因此，在函数的参数值传递中都建议使用<code>=</code>，以避免产生更多对象而占用内存。</p>
<p><code>&lt;&lt;-</code>用于将变量写入上一层环境中。例如将自定义函数中的局部变量写入上一层变量中：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>myplus <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> x</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> x</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">*</span> <span class="dv">2</span>        </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">myplus</span>(x)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>a</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>b</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'b' not found</code></pre>
</div>
</div>
<p>右赋值：<code>-&gt;</code>和<code>-&gt;&gt;</code>，即将左边的值赋给右边的变量，如<code>43 -&gt; o3</code>。<code>-&gt;&gt;</code>作用与<code>&lt;&lt;-</code>相同。</p>
<p>赋值符号左右都应添加一个空格。有时为了对齐赋值符号，可以在赋值符号左边添加多个空格。</p>
</section>
<section id="数学运算符号" class="level4" data-number="2.2.2.2">
<h4 data-number="2.2.2.2" class="anchored" data-anchor-id="数学运算符号"><span class="header-section-number">2.2.2.2</span> 数学运算符号</h4>
<p><code>+</code>、<code>-</code>、<code>*</code>、<code>/</code>、<code>%/%</code>、<code>%%</code>、<code>^</code>分别为加法、减法、乘法、除法、整除、整除求余和乘方运算。混合运算可用<code>( )</code>来确定运算优先级。</p>
<p>属于双目运算符(操作2个对象)的，都需要在其左右各添加一个空格，但<code>^</code>和所有括号(包括小括号、中括号和大括号)不需添加空格。所有单目运算符(操作1个对象)都不应添加空格，如作为正号和负号的<code>+</code>和<code>-</code>。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span><span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (<span class="dv">2</span> <span class="sc">-</span> <span class="dv">1</span> <span class="sc">*</span> <span class="dv">4</span>) <span class="sc">/</span> (<span class="sc">-</span><span class="dv">2</span>) <span class="sc">+</span> <span class="dv">4</span> <span class="sc">/</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">5</span> <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">-</span> <span class="dv">5</span> <span class="sc">%/%</span> <span class="dv">2</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11</code></pre>
</div>
</div>
</section>
<section id="关系运算符号" class="level4" data-number="2.2.2.3">
<h4 data-number="2.2.2.3" class="anchored" data-anchor-id="关系运算符号"><span class="header-section-number">2.2.2.3</span> 关系运算符号</h4>
<p><code>&gt;</code>、<code>&gt;=</code>、<code>&lt;</code>、<code>&lt;=</code>、<code>==</code>、<code>!=</code>分别表示大于、大于等于、小于、小于等于、等等于和不等于的关系运算。其返回值为逻辑值，即<code>TRUE</code>和<code>FALSE</code>，分别表示真或假。对于向量，逐元素(element-wise)进行比较，因此要求向量长度(即元素个数)相等。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">9</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">9</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>v <span class="sc">&gt;</span> t</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE FALSE FALSE FALSE</code></pre>
</div>
</div>
</section>
<section id="逻辑运算符号" class="level4" data-number="2.2.2.4">
<h4 data-number="2.2.2.4" class="anchored" data-anchor-id="逻辑运算符号"><span class="header-section-number">2.2.2.4</span> 逻辑运算符号</h4>
<p><strong><code>&amp;</code></strong>表示逐元素<strong>逻辑与</strong>运算，同为<code>TRUE</code>返回<code>TRUE</code>，否则都返回<code>FALSE</code>。。</p>
<p><strong><code>|</code></strong>分别逐元素<strong>逻辑或</strong>运算，同为<code>FALSE</code>返回<code>FALSE</code>，否则都返回<code>TRUE</code>。</p>
<p><strong><code>!</code></strong>表示逐元素执行<strong>逻辑非</strong>运算，即返回与每个元素相反的逻辑值，元素值为<code>TRUE</code>返回<code>FALSE</code>，元素值为<code>FALSE</code>返回<code>TRUE</code>。</p>
<p>显然，<strong>逻辑非</strong>运算符是单目运算符，而<strong>逻辑与</strong>和<strong>逻辑或</strong>运算符都是双目运算符。 关系运算和逻辑运算常常用于数据的条件过滤。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span><span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>a <span class="sc">&amp;</span> b</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE FALSE  TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>a <span class="sc">|</span> b</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE  TRUE FALSE  TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="sc">!</span>a</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE  TRUE  TRUE FALSE</code></pre>
</div>
</div>
<p>注意，逻辑值<code>TRUE</code>和<code>FALSE</code>可以作为整数<code>1</code>和<code>0</code>参与数学运算。如果将数值转换为逻辑值，<code>0</code>为<code>FALSE</code>，其他所有实数都是<code>TRUE</code>。<code>TRUE</code>可缩写为<code>T</code>，<code>FALSE</code>可缩写为<code>F</code>。<br>
统计airquality数据集中Ozone变量值大于等于100的数目：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(airquality<span class="sc">$</span>Ozone <span class="sc">&gt;=</span> <span class="dv">100</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7</code></pre>
</div>
</div>
</section>
<section id="其他运算符号" class="level4" data-number="2.2.2.5">
<h4 data-number="2.2.2.5" class="anchored" data-anchor-id="其他运算符号"><span class="header-section-number">2.2.2.5</span> 其他运算符号</h4>
<p><strong><code>:</code></strong>用于创建一系列间隔为1的等差数列向量，其左右不应留空格。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1  0  1  2  3  4  5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fl">1.5</span><span class="sc">:</span><span class="dv">2</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1.5 -0.5  0.5  1.5</code></pre>
</div>
</div>
<p><strong><code>%in%</code></strong>用于判断左边元素是否包含在右边的向量中，返回逻辑值，如包含。返回<code>TRUE</code>，否则返回 <code>FALSE</code>。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="dv">2</span>, <span class="st">"C"</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"C"</span>, <span class="st">"D"</span>, <span class="dv">1</span>, <span class="dv">2</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>a <span class="sc">%in%</span> b</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE  TRUE  TRUE</code></pre>
</div>
</div>
<p>此外，R自4.1版本开始提供了原生的管道符号<code>|&gt;</code>，和magrittr包提供的<code>%&gt;%</code>符号功能相同，即将左侧的输出结果传递给右侧命令，实现清晰的流程化数据操作，但原生管道符号占用资源更少。</p>
</section>
</section>
<section id="数据类型和数据结构" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="数据类型和数据结构"><span class="header-section-number">2.2.3</span> 数据类型和数据结构</h3>
<section id="数据类型" class="level4" data-number="2.2.3.1">
<h4 data-number="2.2.3.1" class="anchored" data-anchor-id="数据类型"><span class="header-section-number">2.2.3.1</span> 数据类型</h4>
<p>R的数据类型有数值型(numeric)、整数型(integer)、复数型(complex)、字符型(character)、逻辑型(logical)、因子型(factor)、日期和日期时间型(date和datetime)、时间序列型(ts)等。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="fl">1.23e3</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">=</span> <span class="dv">2</span>L;</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>e <span class="ot">=</span> <span class="st">"环境数据分析与机器学习"</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"A"</span>), </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>g <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="st">"2022/02/28"</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>h <span class="ot">=</span> <span class="fu">as.POSIXct</span>(<span class="st">"2022-02-28 12:20:20"</span>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>k <span class="ot">=</span> <span class="fu">as.POSIXlt</span>(<span class="st">"2022-02-28 12:20:20"</span>)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">ts</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">frequency =</span> <span class="dv">4</span>, <span class="at">start=</span><span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2</span>))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>a和b为数值型，c为整数型，d为逻辑型，e为字符型，f为因子型，g为日期型，h和k为日期时间型，m为时间序列型。在R中，一切皆为对象，这些数据类型都归属于某一类对象。<code>class()</code>和<code>typeof()</code>函数分别用于查看对象的类名和存储类型，<code>str()</code>函数则以紧凑的格式显示任何对象的结构。</p>
<div id="exr-2.3" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 2.3</strong></span> <br>
创建上述变量，并分别用<code>class()</code>、<code>typeof()</code>和<code>str()</code>三个函数查看这些变量的类名、存储类型以及对象结构。</p>
</div>
<p>POSIXct和POSIXlt类型的日期时间数据的区别在于数据结构不同。前者以向量形式存储自1970年1月1日0:00:00(UTC时区，比北京时间早8小时)以来的秒数，后者则是以列表形式存储日期时间的各个要素)。可以在创建后用解除类属性的函数<code>unclass()</code>查看区别。</p>
<p>数值型、整数型、字符型和逻辑型是基础数据类型，复数型、因子型、日期和日期时间型、时间序列型都是基础类型衍生出来的复合数据类型。</p>
<p>R提供了<code>is.~</code>和<code>as.~</code>系列函数(<code>~</code>为<code>numeric</code>、<code>integer</code>、<code>complex</code>、<code>character</code>、<code>logical</code>、<code>factor</code>、<code>ts</code>等)，前者用来判断某个变量是否为某数据类型，后者将其他类型的数据强制转换为某类型数据，如果不能强制转换，则会给出警示信息。<br>
例如，判断并统计airquality数据集中Ozone变量中缺失值的数目：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(airquality<span class="sc">$</span>Ozone))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 37</code></pre>
</div>
</div>
</section>
<section id="数据结构" class="level4" data-number="2.2.3.2">
<h4 data-number="2.2.3.2" class="anchored" data-anchor-id="数据结构"><span class="header-section-number">2.2.3.2</span> 数据结构</h4>
<p>这里的数据结构是指容纳数据的容器。R的基本数据结构有向量(vector)、矩阵(matrix)、数组(array)、列表(list)、数据框(data.frame)。</p>
<p>向量和矩阵是数组的特例，即一维和二维数组。数组是容纳同一类型数据的容器，以数值型(包括整数型)最为常见。矩阵具有独特的数学运算，尤其是在机器学习建模中非常重要。列表是最具包容性的数据结构，可以容纳任何不同类型和不同维度的数据，非常灵活，R中很多对象的底层结构都是列表。数据框是矩阵与列表的融合，既具有矩阵的形式(矩形表格)，又能容纳不同类型的数据，但要求每一列数据为同一类型，不同列数据类型可以不同，同时要求每列数据的行数相同。数据框是机器学习和深度学习中非常重要的数据结构，绝大多数的机器学习和深度学习算法都可以接受数据框格式学习数据集。数据框的列对应不同变量，行对应一个观测或样例。</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-2.2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-2.2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/fig2.2.png" class="img-fluid figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-2.2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;2.2: R的数据结构
</figcaption>
</figure>
</div>
</div>
</div>
<p>(1)创建向量</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="fl">5.5</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">9</span>) </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="at">by =</span> <span class="fl">0.5</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="at">length.out =</span> <span class="dv">4</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>e <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>), <span class="at">each =</span> <span class="dv">2</span>)</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>), <span class="at">times =</span> <span class="dv">2</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>c()</code>是连接(concatenate)函数，用于自由地将各种元素组合在一起，形成向量或列表。如果是创建向量，同时输入不同类型的数据，会强制转换为同一类型的数据。</p>
<div id="exr-2.4" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 2.4</strong></span> <br>
在RStudio的控制台输入以上代码，然后分别输入各变量(在控制台输入变量名，然后回车)，查看结果，思考并理解以上创建向量方法之间的差异。</p>
</div>
<p>向量的长度(即元素个数)可用<code>length()</code>函数获取。<code>names()</code>函数可以获取或者为向量中的元素提供名字(类似标签)。</p>
<p>(2)创建矩阵</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">4</span>, <span class="at">byrow =</span> <span class="cn">FALSE</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span><span class="dv">4</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="exr-2.5" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 2.5</strong></span> 在RStudio的控制台输入以上代码，然后分别输入各变量，查看结果，思考并理解以上创建矩阵方法之间的差异。</p>
</div>
<p>矩阵同样可以用<code>length()</code>获取长度，但通常用<code>dim()</code>获取矩阵的维数，用<code>nrow()</code>和<code>ncol()</code>分别获取矩阵的行数和列数，但不能用于向量。<code>NROW()</code>和<code>NCOL()</code>可以用于向量，这两个函数将向量视为一列的矩阵。矩阵可以有行名和列名，<code>dimnames()</code>可以同时查看和设置行名与列名， <code>rownames()</code>和<code>colnames()</code>分别用于查看和设置行名和列名。</p>
<p>向量和矩阵可以进行逐元素的各种数学运算(加、减、乘、除、整除、整除求余、乘方，运算符号见 <a href="#sec-math-symbol" class="quarto-xref"><span>小节 2.2.2.1</span></a> )以及求总和<code>sum()</code>、求连乘积<code>prod()</code>以及累积求和<code>cumsum()</code>和累积乘积<code>cumprod()</code>。<code>t()</code>函数用于矩阵的转置。</p>
<p>矩阵拥有专有的运算函数，如矩阵乘积<code>%*%</code>，内积运算<code>corssprod()</code>、外积运算<code>%o%</code>或<code>outer()</code>、Kronecker积<code>%x%</code>、特征值和特征向量求解<code>eigen()</code>、求逆和解矩阵方程<code>solve()</code>、矩阵行列式<code>det()</code>、QR分解并返回秩<code>qr()</code>、奇异值分解<code>svd()</code>、Cholesky因子分解<code>chol()</code>等，具体可参阅线性代数知识和R语言科学计算方面的书籍。</p>
<div id="exr-2.6" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 2.6</strong></span> 分别创建一个数值型向量和矩阵，然后分别执行向量和矩阵与标量的各种运算以及向量和矩阵与自身的各种数学运算，查看结果，思考并理解以上向量与矩阵的逐元素运算。</p>
</div>
<p>不等长的向量之间以及矩阵与向量之间可以通过自动补齐的方式进行数学运算，但会显示警示信息。只有维数相同的矩阵与矩阵之间才可以进行数学运算。</p>
<p>三维及三维以上的称为数组。图片数据的储存一般采用三维数组(行×列×页)形式来分别保存每一个像素点的R(红色)、G(绿色)、B(蓝色)的值。超过三维的数组在数据处理分析与建模中应用较少。</p>
<p>(3)创建列表</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"Tom"</span>, <span class="st">"Jack"</span>, <span class="st">"Amy"</span>, <span class="st">"Kate"</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">=</span> <span class="fu">list</span>(a, b)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">list</span>(<span class="at">A =</span> a, <span class="at">B =</span> b)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>e <span class="ot">=</span> <span class="fu">c</span>(<span class="at">A =</span> <span class="dv">10</span>, <span class="at">B =</span> <span class="fu">list</span>(<span class="st">"Tom"</span>,<span class="st">"Jack"</span>)) </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>f <span class="ot">=</span> <span class="fu">c</span>(<span class="at">A =</span> <span class="dv">10</span>, <span class="at">B =</span> <span class="fu">c</span>(<span class="st">"Tom"</span>, <span class="st">"Jack"</span>))  <span class="co"># 避免使用这种方式，其结果是字符向量</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>建议尽量使用<code>list()</code>函数创建列表。可以用<code>names()</code>查看和设置列表中每一个项目的名称。</p>
<div id="exr-2.7" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 2.7</strong></span> 分别创建不同的长度的一个数值型向量、一个字符型向量和一个数值型矩阵，然后用list函数将三个向量合并组装成一个列表。</p>
</div>
<p>(4)创建数据框</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">11</span>, <span class="dv">15</span><span class="sc">:</span><span class="dv">19</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">type =</span> a, <span class="at">mass =</span> b)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(df)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   10 obs. of  2 variables:
 $ type: chr  "A" "B" "C" "D" ...
 $ mass: num  2 4 7 9 11 15 16 17 18 19</code></pre>
</div>
</div>
<div id="exr-2.8" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 2.8</strong></span> 输入以上代码创建数据框df，然后用<code>rownames()</code>和<code>colnames()</code>查看和设置df的行名和列名，用str()查看df结构，用dim()查看df的维度。</p>
</div>
<p>同样，R也提供了相应的<code>is.~</code>和<code>as.~</code>系列函数(<code>~</code>为<code>vector</code>、<code>matrix</code>、<code>array</code>、<code>list</code>、<code>data.frame</code>等)，前者用于判断对象是否属于该数据结构对象，后者用于强制转换数据结构，转换不成功会有警示信息。<br>
tidyverse套件中的tibble包提供了增强版的数据框对象：<strong>tibble</strong>。data.table包则提供了高效处理大数据的超强版数据框对象：<strong>data.table</strong>，可以读写和处理几十GB级的数据集。如果需要经常需要处理大数据，建议学习和掌握data.table包的使用。内存无法加载的超大数据集，建议使用工具包disk.frame，该包提供了大型数据框对象<strong>disk.frame</strong>，将数据存储在磁盘上，以处理无法加载至内存的大规模数据。</p>
</section>
<section id="访问数据和获取子集" class="level4" data-number="2.2.3.3">
<h4 data-number="2.2.3.3" class="anchored" data-anchor-id="访问数据和获取子集"><span class="header-section-number">2.2.3.3</span> 访问数据和获取子集</h4>
<p>访问和获取向量、矩阵、数据框以及列表的元素和子集的方法有很多种，通用的方法是利用下标、元素对应的标签(名字)、列名和行名(矩阵和数据框)，以及利用<code>subset()</code>函数。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="fu">matrix</span>(a, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>c <span class="ot">=</span> <span class="fu">as.data.frame</span>(b, <span class="at">row.names =</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">col.names =</span> LETTERS[<span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>])</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">as.list</span>(c)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>获取向量子集或元素：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>a[<span class="dv">1</span>]; a[<span class="dv">5</span><span class="sc">:</span><span class="dv">7</span>]; a[<span class="dv">5</span><span class="sc">:</span><span class="dv">2</span>]; a[<span class="sc">-</span><span class="dv">3</span>]</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5 6 7</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5 4 3 2</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  2  4  5  6  7  8  9 10 11 12</code></pre>
</div>
</div>
<p>获取矩阵子集或元素：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>b[, <span class="dv">1</span>]; b[<span class="dv">2</span>, ]; b[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>]; b[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>), ]</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  2  5  8 11</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    4    7
[2,]    5    8
[3,]    6    9</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1  4  7 10</code></pre>
</div>
</div>
<p>注意<code>b[1]</code>和<code>b[, 1]</code>的不同。</p>
<p>获取数据框子集或元素：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>c[<span class="dv">1</span>]; c[, <span class="dv">1</span>]; c[<span class="sc">-</span><span class="dv">2</span>]; c[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">3</span>]; c<span class="sc">$</span>V1; c[<span class="st">"V1"</span>]; c[, <span class="st">"V1"</span>]</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  V1
a  1
b  2
c  3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  V1 V3 V4
a  1  7 10
b  2  8 11
c  3  9 12</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7 8</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  V1
a  1
b  2
c  3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3</code></pre>
</div>
</div>
<p>注意数据框获取子集方式的差异。</p>
<p><code>subset()</code>函数可以通过条件过滤的方式获取子集：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">subset</span>(c, V1 <span class="sc">&gt;</span> <span class="dv">2</span>, <span class="at">select =</span> <span class="fu">c</span>(V2, V4)) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  V2 V4
c  6 12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>d[<span class="dv">1</span>]; d[<span class="st">"V1"</span>]; d[[<span class="dv">1</span>]]; d<span class="sc">$</span>V1; d[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]; d[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>)]</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$V1
[1] 1 2 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$V1
[1] 1 2 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$V1
[1] 1 2 3

$V2
[1] 4 5 6</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$V1
[1] 1 2 3

$V3
[1] 7 8 9</code></pre>
</div>
</div>
<p>注意列表子集查询和提取子集各方式的差异</p>
<div id="exr-2.9" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 2.9</strong></span> <br>
在RStudio控制台输入以上代码，观察不同查询和获取子集方法结果的异同。</p>
</div>
</section>
</section>
</section>
<section id="常用函数" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="常用函数"><span class="header-section-number">2.3</span> 常用函数</h2>
<p>对于开展数据处理、分析和建模而言，掌握R的一些常用函数的使用是非常必要的。R基础包中的所有函数的使用手册下载网址为<a href="https://cran.r-project.org/doc/manuals/r-release/fullrefman.pdf" class="uri">https://cran.r-project.org/doc/manuals/r-release/fullrefman.pdf</a>。</p>
<section id="常用数学函数" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="常用数学函数"><span class="header-section-number">2.3.1</span> 常用数学函数</h3>
<p>Base-R提供的常用数学函数有：</p>
<ul>
<li><code>abs()</code>: 计算绝对值</li>
<li><code>sqrt()</code>: 计算平方根</li>
<li><code>log()</code>、<code>log10()</code>、<code>log2()</code>: 对数函数</li>
<li><code>exp()</code>: 指数函数</li>
<li><code>sin()</code>、<code>cos()</code>、<code>tan()</code>: 三角函数</li>
<li><code>round()</code>: 四舍五入指定保留位数</li>
<li><code>ceiling()</code>: 向上取整</li>
<li><code>floor()</code>: 向下取整</li>
<li><code>deriv()</code>: 求导数</li>
<li><code>integrate()</code>: 求积分</li>
</ul>
<p>例如通过向量x计算y = sin(x) + log(x + 1)：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">sin</span>(x) <span class="sc">+</span> <span class="fu">log</span>(x <span class="sc">+</span> <span class="dv">1</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="常用统计函数" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="常用统计函数"><span class="header-section-number">2.3.2</span> 常用统计函数</h3>
<p>Base-R提供的常用统计函数有：</p>
<ul>
<li><code>sum()</code>: 求和</li>
<li><code>mean()</code>: 计算算术平均值</li>
<li><code>median()</code>: 计算中位数</li>
<li><code>sd()</code>: 计算标准差</li>
<li><code>var()</code>: 计算方差</li>
<li><code>mad()</code>: 计算绝对中位差</li>
<li><code>min()</code>、<code>max()</code>: 计算最小值、最大值</li>
<li><code>range()</code>: 计算值域，返回最小值和最大值</li>
<li><code>quantile()</code>: 计算百分位数</li>
<li><code>scale()</code>: 去中心化或标准化</li>
<li><code>diff()</code>: 滞后差分</li>
<li><code>difftime()</code>: 计算时间间隔</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2024</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">sd =</span> <span class="dv">2</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 483.0135</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.830135</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.96555</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.044973</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.181914</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1.548572  8.945637</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(x, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.75</span>, <span class="fl">0.90</span>))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     10%      25%      50%      75%      90% 
2.099641 3.560076 4.965550 6.343973 7.264369 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">diff</span>(y)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 1 1 1 1 1 1 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">diff</span>(y, <span class="at">lag =</span> <span class="dv">2</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 2 2 2 2 2 2 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scale</span>(y, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]
 [1,] -1.4863011
 [2,] -1.1560120
 [3,] -0.8257228
 [4,] -0.4954337
 [5,] -0.1651446
 [6,]  0.1651446
 [7,]  0.4954337
 [8,]  0.8257228
 [9,]  1.1560120
[10,]  1.4863011
attr(,"scaled:center")
[1] 5.5
attr(,"scaled:scale")
[1] 3.02765</code></pre>
</div>
</div>
<p>R提供了众多的概率分布函数，如表2-3所示。在这些概率分布的R命名前添加<code>d</code>、<code>p</code>、<code>q</code>、<code>r</code>前缀，分别表示概率密度函数(由x轴对应值计算分布曲线上对应的概率密度)、分布函数(由x轴对应值计算累积概率密度)、分位数函数(由累积概率密度计算x轴对应值)以及随机数生成函数(根据指定参数生成符合该分布类型的随机数集合)。</p>
<div class="cell">
<div id="tbl-2.1" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-2.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
表&nbsp;2.1: R内置的概率分布函数
</figcaption>
<div aria-describedby="tbl-2.1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: center;">分布类型</th>
<th style="text-align: center;">R命名</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">贝塔分布</td>
<td style="text-align: center;">beta</td>
</tr>
<tr class="even">
<td style="text-align: center;">二项分布</td>
<td style="text-align: center;">binom</td>
</tr>
<tr class="odd">
<td style="text-align: center;">柯西分布</td>
<td style="text-align: center;">cauchy</td>
</tr>
<tr class="even">
<td style="text-align: center;">卡方分布</td>
<td style="text-align: center;">chisq</td>
</tr>
<tr class="odd">
<td style="text-align: center;">指数分布</td>
<td style="text-align: center;">exp</td>
</tr>
<tr class="even">
<td style="text-align: center;">F分布</td>
<td style="text-align: center;">f</td>
</tr>
<tr class="odd">
<td style="text-align: center;">伽马分布</td>
<td style="text-align: center;">gamma</td>
</tr>
<tr class="even">
<td style="text-align: center;">几何分布</td>
<td style="text-align: center;">geom</td>
</tr>
<tr class="odd">
<td style="text-align: center;">超几何分布</td>
<td style="text-align: center;">hyper</td>
</tr>
<tr class="even">
<td style="text-align: center;">逻辑斯谛分布</td>
<td style="text-align: center;">logis</td>
</tr>
<tr class="odd">
<td style="text-align: center;">对数正态分布</td>
<td style="text-align: center;">lnorm</td>
</tr>
<tr class="even">
<td style="text-align: center;">负二项分布</td>
<td style="text-align: center;">nbinom</td>
</tr>
<tr class="odd">
<td style="text-align: center;">正态分布</td>
<td style="text-align: center;">norm</td>
</tr>
<tr class="even">
<td style="text-align: center;">泊松分布</td>
<td style="text-align: center;">pois</td>
</tr>
<tr class="odd">
<td style="text-align: center;">学生t分布</td>
<td style="text-align: center;">t</td>
</tr>
<tr class="even">
<td style="text-align: center;">均匀分布</td>
<td style="text-align: center;">unif</td>
</tr>
<tr class="odd">
<td style="text-align: center;">韦布尔分布</td>
<td style="text-align: center;">weibull</td>
</tr>
<tr class="even">
<td style="text-align: center;">威尔考克斯分布</td>
<td style="text-align: center;">wilcox</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<p>例如生成均值为3、标准差为1的30个正态分布随机数：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">30</span>, <span class="at">mean =</span> <span class="dv">3</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1.624290 2.826074 5.711602 1.926553 1.951247 3.504240 4.445891 3.017523
 [9] 3.909281 3.671286 2.344481 2.746054 1.947971 3.636906 2.971663 3.883622
[17] 1.081594 3.069935 1.597498 1.954728 4.311735 2.693475 1.078335 3.797105
[25] 3.379924 1.464083 4.055746 4.033470 3.497045 2.649191</code></pre>
</div>
</div>
<p>计算分位数1.96对应的正态分布概率密度：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dnorm</span>(<span class="fl">1.96</span>)  </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.05844094</code></pre>
</div>
</div>
<p>计算分位数1.96左侧的曲线下面积：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pnorm</span>(<span class="fl">1.96</span>)  </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9750021</code></pre>
</div>
</div>
<p>计算分位数1.96右侧的曲线下面积：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="fl">1.96</span>)  </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0249979</code></pre>
</div>
</div>
<p>计算累积概率密度为0.975的分位数：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qnorm</span> (<span class="fl">0.975</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.959964</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-2.3" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-2.3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/fig2.3.png" class="img-fluid figure-img" style="width:75.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-2.3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
图&nbsp;2.3: 标准正态分布各函数功能
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="常用字符串处理函数" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="常用字符串处理函数"><span class="header-section-number">2.3.3</span> 常用字符串处理函数</h3>
<p>Base-R提供的常用字符串处理函数如下：</p>
<ul>
<li><code>nchar()</code>: 计算字符数量</li>
<li><code>substr()</code>、<code>substring()</code>: 提取或替代字符串</li>
<li><code>paste()</code>、<code>paste0()</code>: 连接字符串</li>
<li><code>format()</code>: 把对象转换为字符串</li>
<li><code>\</code>: 转义字符，如换行：<code>\n</code></li>
<li><code>chartr()</code>: 字符转换</li>
<li><code>strsplit()</code>: 分割字符串</li>
<li><code>grep()</code>、<code>grepl()</code>: 按正则表达式规则查找</li>
<li><code>sub()</code>、<code>gsub()</code>: 按正则表达式规则替换</li>
<li><code>tolower()</code>、<code>toupper()</code>: 小写和大写字母转换</li>
<li><code>strtrim()</code>: 将字符串修建为指定宽度</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">substr</span>(<span class="st">"abcdef"</span>, <span class="dv">2</span>, <span class="dv">4</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "bcd"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"A"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">sep =</span> <span class="st">"-"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "A-1" "A-2" "A-3" "A-4" "A-5"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste0</span>(<span class="st">"A"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "A1" "A2" "A3" "A4" "A5"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">strsplit</span>(<span class="st">"a.b.c"</span>, <span class="at">split =</span> <span class="st">"."</span>)  <span class="co"># split参数为正则表达式</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "" "" "" "" ""</code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 上述操作不能实现按`.`分割字符串, 因为在正则表达式语法中，`.`表示任何字符</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">strsplit</span>(<span class="st">"a.b.c"</span>, <span class="at">split =</span> <span class="st">"[.]"</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "a" "b" "c"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># `[.]`表示字符`.`</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>str <span class="ot">&lt;-</span> <span class="st">"Now is the time      "</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sub</span>(<span class="st">" +$"</span>, <span class="st">""</span>, str)  <span class="co"># 找到结尾多余空格并用""替代，实质就是删除</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Now is the time"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>str <span class="ot">&lt;-</span> <span class="st">"Hello, World!"</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gsub</span>(<span class="st">"World"</span>, <span class="st">"R"</span>, str)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Hello, R!"</code></pre>
</div>
</div>
<p>tidyverse套件中的stringr包是一个强大的字符串处理工具包，主要函数有：</p>
<ul>
<li><code>str_length()</code>: 获取字符串长度</li>
<li><code>str_c()</code>: 拼接字符串</li>
<li><code>str_detect()</code>: 字符包含检查</li>
<li><code>str_dup()</code>: 字符多次重复</li>
<li><code>str_extract()</code>: 提取第一个匹配的字符</li>
<li><code>str_extract_all()</code>: 提取所有匹配的字符</li>
<li><code>str_match()</code>: 返回第一个匹配的字符矩阵</li>
<li><code>str_match_all()</code>: 返回所有匹配的字符矩阵</li>
<li><code>str_locate()</code>: 提取第一个匹配字符的位置</li>
<li><code>str_locate_all()</code>: 提取所有匹配字符的位置</li>
<li><code>str_pad()</code>: 字符补齐</li>
<li><code>str_glue()</code>: 字符创格式化输出</li>
<li><code>str_replace_na()</code>: 用字符串”NA”替换NA</li>
<li><code>str_replace()</code>: 替换第一个匹配的字符</li>
<li><code>str_replace_all()</code>: 替换所有匹配的字符</li>
<li><code>str_which()</code>: 返回匹配模式的字符位置</li>
<li><code>str_remove()</code>: 删除第一个匹配的字符</li>
<li><code>str_remove_all()</code>: 提取是所有匹配的字符</li>
<li><code>str_split()</code>: 分割字符串</li>
<li><code>str_split_fixed()</code>: 指定分割块数分割字符</li>
<li><code>str_sub()</code>: 指定位置截取字符</li>
<li><code>str_subset()</code>: 截取匹配模式的字符</li>
<li><code>str_sort()</code>: 排序并返回字符向量</li>
<li><code>str_order()</code>: 排序并返回字符索引</li>
<li><code>str_trim()</code>: 删除字符串两边空格</li>
<li><code>str_squish()</code>: 删除字符串中多余空格</li>
<li><code>str_to_lower()</code>: 字符转小写</li>
<li><code>str_to_upper()</code>: 字符转大写</li>
<li><code>str_to_title()</code>: 字符串转标题</li>
<li><code>str_to_sentence()</code>: 字符串转语句</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 拼接字符串</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(<span class="st">"Hello"</span>, <span class="st">"World"</span>)  <span class="co"># 默认无分隔符拼接</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "HelloWorld"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(<span class="st">"Hello"</span>, <span class="st">"World"</span>, <span class="at">sep =</span> <span class="st">" "</span>)  <span class="co"># 指定分隔符拼接</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Hello World"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 分割字符串</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(<span class="st">"one,two,three"</span>, <span class="at">pattern =</span> <span class="st">","</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "one"   "two"   "three"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取字符串中的数字</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract</span>(<span class="st">"There are 42 apples"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "42"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 替换字符串中的数字为#</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(<span class="st">"There are 42 apples"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>, <span class="st">"#"</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "There are # apples"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 检测字符串是否包含数字</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(<span class="st">"There are 42 apples"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 返回匹配字符的位置</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_locate</span>(<span class="st">"banana"</span>, <span class="st">"a"</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     start end
[1,]     2   2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 补齐字符串</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_pad</span>(<span class="st">"Jack"</span>, <span class="at">width =</span> <span class="dv">7</span>, <span class="at">side =</span> <span class="st">"right"</span>, <span class="at">pad =</span> <span class="st">"S"</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "JackSSS"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 删除部分字符</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_remove</span>(<span class="st">"banana"</span>, <span class="st">"a"</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "bnana"</code></pre>
</div>
</div>
</section>
<section id="常用数据处理函数" class="level3" data-number="2.3.4">
<h3 data-number="2.3.4" class="anchored" data-anchor-id="常用数据处理函数"><span class="header-section-number">2.3.4</span> 常用数据处理函数</h3>
<ul>
<li><code>length()</code>: 返回长度</li>
<li><code>sort()</code>、<code>order()</code>: 排序，返回排序结果或索引</li>
<li><code>dim()</code>: 返回数组和数据框的维度</li>
<li><code>rev()</code>: 逆序，返回逆序后的结果</li>
<li><code>subset()</code>: 提取子集</li>
<li><code>unique()</code>: 提取唯一元素</li>
<li><code>nrow()</code>、<code>ncol()</code>: 返回数组的行数和列数</li>
<li><code>NROW()</code>、<code>NCOL()</code>: 返回包括0长度和1维向量的行数和列数</li>
<li><code>rep()</code> 生成重复的序列</li>
<li><code>seq()</code>、<code>seq.POSIXt()</code>、<code>seq.Date()</code>、<code>seq_len()</code>、<code>seq_along()</code>: 生成数值、时间和日期的等差序列</li>
<li><code>colnames()</code>、<code>rownames()</code>: 查询和设置矩阵、数据框的列名和行名<br>
</li>
<li><code>cbind()</code>、<code>rbind()</code>: 对矩阵、数据框进行列合并和行合并</li>
<li><code>names()</code> 查询和设置对象的名称</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="sc">-</span><span class="dv">3</span><span class="sc">:</span><span class="dv">0</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] -3 -2 -1  0  1  2  2  3  3  4  4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(x, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  4  4  3  3  2  2  1  0 -1 -2 -3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">order</span>(x)  <span class="co"># 在排序位置上给出相应元素原先的位置序号</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  5  6  7  8  1  2  9  3 10  4 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  1  2  3  4 -3 -2 -1  0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">nrow =</span> <span class="dv">3</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(y)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(y)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ncol</span>(y)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">times =</span> <span class="dv">2</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 1 2 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">each =</span> <span class="dv">2</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 2 2 3 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">length.out =</span> <span class="dv">5</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 1 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">by =</span> <span class="fl">0.5</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0 0.5 1.0 1.5 2.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">4</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0000000 0.6666667 1.3333333 2.0000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq_along</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  2  3  4  5  6  7  8  9 10 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq_along</span>(y)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  2  3  4  5  6  7  8  9 10 11 12</code></pre>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(y) <span class="ot">=</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(y)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "A" "B" "C" "D"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(x) <span class="ot">=</span> <span class="st">"vec"</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "vec" NA    NA    NA    NA    NA    NA    NA    NA    NA    NA   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(x) <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">"V"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x))</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "V1"  "V2"  "V3"  "V4"  "V5"  "V6"  "V7"  "V8"  "V9"  "V10" "V11"</code></pre>
</div>
</div>
</section>
<section id="常用日期时间处理函数" class="level3" data-number="2.3.5">
<h3 data-number="2.3.5" class="anchored" data-anchor-id="常用日期时间处理函数"><span class="header-section-number">2.3.5</span> 常用日期时间处理函数</h3>
<p>时间序列数据中，日期和时间是关键变量。Base-R提供了日期与时间数据的处理函数，但lubridate包更高效和专业，并且使用广泛，主要操作函数如下：</p>
<section id="生成日期时间对象函数" class="level4" data-number="2.3.5.1">
<h4 data-number="2.3.5.1" class="anchored" data-anchor-id="生成日期时间对象函数"><span class="header-section-number">2.3.5.1</span> 生成日期时间对象函数</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd</span>(<span class="st">"2024-03-09"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-03-09"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mdy</span>(<span class="st">"March 9, 2024"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-03-09"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dmy</span>(<span class="st">"09/03/2024"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-03-09"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd_hms</span>(<span class="st">"2024-03-09 12:15:00"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-03-09 12:15:00 UTC"</code></pre>
</div>
</div>
</section>
<section id="提取日期时间数据中的要素" class="level4" data-number="2.3.5.2">
<h4 data-number="2.3.5.2" class="anchored" data-anchor-id="提取日期时间数据中的要素"><span class="header-section-number">2.3.5.2</span> 提取日期时间数据中的要素</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">year</span>(<span class="fu">ymd</span>(<span class="st">"2024-02-29"</span>))  <span class="co"># 提取年</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2024</code></pre>
</div>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">month</span>(<span class="fu">ymd</span>(<span class="st">"2024-02-29"</span>))  <span class="co"># 提取月</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">day</span>(<span class="fu">ymd</span>(<span class="st">"2024-02-29"</span>))  <span class="co"># 提取日</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 29</code></pre>
</div>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hour</span>(<span class="fu">ymd_hms</span>(<span class="st">"2024-02-29 11:15:30"</span>))  <span class="co"># 提取时</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">minute</span>(<span class="fu">ymd_hms</span>(<span class="st">"2024-02-29 11:15:30"</span>))  <span class="co"># 提取分</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15</code></pre>
</div>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">second</span>(<span class="fu">ymd_hms</span>(<span class="st">"2024-02-29 11:15:30"</span>))  <span class="co"># 提取秒</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 30</code></pre>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">yday</span>(<span class="fu">ymd</span>(<span class="st">"2024-02-29"</span>))  <span class="co"># 提取年日, 1~365</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 60</code></pre>
</div>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mday</span>(<span class="fu">ymd</span>(<span class="st">"2024-02-29"</span>))  <span class="co"># 提取月日，1~31</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 29</code></pre>
</div>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wday</span>(<span class="fu">ymd</span>(<span class="st">"2024-02-29"</span>))  <span class="co"># 提取周日，1~7</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
</div>
</section>
<section id="获取当前日期和时间" class="level4" data-number="2.3.5.3">
<h4 data-number="2.3.5.3" class="anchored" data-anchor-id="获取当前日期和时间"><span class="header-section-number">2.3.5.3</span> 获取当前日期和时间</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">today</span>()  <span class="co"># 获取当前日期</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-04-06"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">now</span>()  <span class="co"># 获取当前日期时间</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-04-06 14:12:07 CST"</code></pre>
</div>
</div>
</section>
<section id="创建和操作时间间隔" class="level4" data-number="2.3.5.4">
<h4 data-number="2.3.5.4" class="anchored" data-anchor-id="创建和操作时间间隔"><span class="header-section-number">2.3.5.4</span> 创建和操作时间间隔</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">duration</span>(<span class="dv">1</span>, <span class="st">"days"</span>)  <span class="co"># 创建以秒单位的Duration对象</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "86400s (~1 days)"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">period</span>(<span class="dv">1</span>, <span class="st">"days"</span>)  <span class="co"># 创建或解析Period对象</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1d 0H 0M 0S"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">interval</span>(<span class="fu">ymd</span>(<span class="st">"2024-03-09"</span>), <span class="fu">ymd</span>(<span class="st">"2024-03-10"</span>))  <span class="co"># 创建Interval对象</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2024-03-09 UTC--2024-03-10 UTC</code></pre>
</div>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 日期时间数据运算</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd_hms</span>(<span class="st">"2024-01-01 00:00:00"</span>) <span class="sc">-</span> <span class="fu">years</span>(<span class="dv">1</span>) <span class="sc">+</span> <span class="fu">months</span>(<span class="dv">2</span>) <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">5</span>) <span class="sc">+</span> <span class="fu">hours</span>(<span class="dv">2</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2023-03-06 02:00:00 UTC"</code></pre>
</div>
</div>
</section>
<section id="时区操作函数" class="level4" data-number="2.3.5.5">
<h4 data-number="2.3.5.5" class="anchored" data-anchor-id="时区操作函数"><span class="header-section-number">2.3.5.5</span> 时区操作函数</h4>
<p><code>force_tz()</code>：强制改变日期时间对象的时区，而不改变时间。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"2024-02-29 11:15:30"</span>)</span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>dt</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-02-29 11:15:30 UTC"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">force_tz</span>(dt, <span class="st">"Asia/Shanghai"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-02-29 11:15:30 CST"</code></pre>
</div>
</div>
<p><code>with_tz()</code>：将日期时间对象转换为另一个时区，同时改变时间。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with_tz</span>(dt, <span class="st">"Asia/Shanghai"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-02-29 19:15:30 CST"</code></pre>
</div>
</div>
<p><code>tz()</code>：获取或设置日期时间对象的时区。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tz</span>(dt)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "UTC"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tz</span>(dt) <span class="ot">&lt;-</span> <span class="st">"Asia/Shanghai"</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tz</span>(dt)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Asia/Shanghai"</code></pre>
</div>
</div>
</section>
</section>
<section id="因子型数据处理函数" class="level3" data-number="2.3.6">
<h3 data-number="2.3.6" class="anchored" data-anchor-id="因子型数据处理函数"><span class="header-section-number">2.3.6</span> 因子型数据处理函数</h3>
<p>R的因子型数据对象可以非常便利地处理分类变量和实验数据。R中因子型数据实际保存为整数，因此对因子进行字符型操作时，可能导致错误。安全的做法是在用字符型数据处理函数操作前，用<code>as.character()</code>函数将因子转换为字符。</p>
<ul>
<li><code>factor()</code>、<code>ordered()</code>: 创建无序和有序因子数据</li>
<li><code>table()</code>: 统计因子数据各水平的频数</li>
<li><code>levels()</code>: 查询因子数据的水平</li>
<li><code>cut()</code>: 分割连续变量并转换成因子</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">=</span> <span class="fu">substring</span>(<span class="st">"environment"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)</span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>ss</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "e" "n" "v" "i" "r" "o" "n" "m" "e" "n" "t"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>ff <span class="ot">=</span> <span class="fu">factor</span>(ss, <span class="at">levels =</span> letters)</span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>ff</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] e n v i r o n m e n t
Levels: a b c d e f g h i j k l m n o p q r s t u v w x y z</code></pre>
</div>
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(ff)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ff
a b c d e f g h i j k l m n o p q r s t u v w x y z 
0 0 0 0 2 0 0 0 1 0 0 0 1 3 1 0 0 1 0 1 0 1 0 0 0 0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>ffo <span class="ot">=</span> <span class="fu">ordered</span>(ff)</span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>ffo</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] e n v i r o n m e n t
Levels: e &lt; i &lt; m &lt; n &lt; o &lt; r &lt; t &lt; v</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2024</span>)  <span class="co"># 设定随机数字发生器状态，以实现可重复性</span></span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">1</span>L<span class="sc">:</span><span class="dv">10</span>L, <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>x
 1  2  3  4  5  6  7  8  9 10 
13 13 11 13  9  6  5  4 16 10 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(y <span class="ot">&lt;-</span> <span class="fu">cut</span>(x, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">10</span>)))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 (0,3]  (3,7] (7,10] 
    37     33     30 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(y)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(y)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "(0,3]"  "(3,7]"  "(7,10]"</code></pre>
</div>
</div>
<p>在因子水平较多时，往往需要对因子水平进行排序、合并等操作，forcats包提供了一些处理复杂因子型数据的函数，可在安装后利用<code>help(package = forcats)</code>查看帮助信息。</p>
</section>
<section id="其他常用函数" class="level3" data-number="2.3.7">
<h3 data-number="2.3.7" class="anchored" data-anchor-id="其他常用函数"><span class="header-section-number">2.3.7</span> 其他常用函数</h3>
<ul>
<li><code>set.seed()</code>: 设置随机数字发生器状态</li>
<li><code>cat()</code>: 以连接的方式输出信息</li>
<li><code>print()</code>: 打印对象，泛型函数</li>
<li><code>ls()</code>: 列出当前环境中的对象</li>
<li><code>getwd()</code>、<code>setwd()</code>: 获取和设置当前工作目录</li>
<li><code>dir()</code>、<code>list.files()</code>: 列出指定目录中的子目录和文件</li>
<li><code>rm()</code>、<code>rm(list=ls())</code>: 删除环境中指定或所有变量</li>
<li><code>file.exists()</code>、<code>file.rename()</code>: 检查文件是否存在和文件改名</li>
<li><code>dir.exsits()</code>、<code>dir.create()</code>: 检查目录是否存在和创建目录</li>
<li><code>file.copy()</code>、<code>file.remove()</code>: 文件复制和文件删除</li>
<li><code>file.path()</code>、<code>file.size()</code>: 返回文件所在目录和大小</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb241"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 用print()输出</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">sin</span>(pi<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">cos</span>(pi<span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 用print()输出x</span></span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(y)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 用cat()拼接输出</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"π/2的正弦函数值为"</span>, x, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) <span class="co"># 必须添加"\n"以强制换行</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>π/2的正弦函数值为 1 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"π/3的余弦函数值为"</span>, y, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)  </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>π/3的余弦函数值为 0.5 </code></pre>
</div>
</div>
</section>
</section>
<section id="数据读写" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="数据读写"><span class="header-section-number">2.4</span> 数据读写</h2>
<p>少量或小规模的数据可以在R中用键盘直接输入，如<code>a = c(1,2,4)</code>。也可利用函数<code>scan()</code>在控制台从键盘接收数值和字符输入，或从文件导入数据；如<code>a = scan()``，b = scan(what = "")</code>。输入空行时(不输入数据直接按<kbd> Enter </kbd>键)结束输入。<code>readlines()</code>和<code>readLines()</code>函数可在控制台从键盘接收单行和多行字符串。后者还可以从一个连接(connection)对象(文件、网络链接、压缩文件等)接收文本。<code>readLines()</code>函数在控制台的结束需要按<kbd> Esc </kbd>键。</p>
<p>当数据以各种格式的文件形式存在时，R及相关的包提供了丰富的接口来读写各种格式的数据，如文本数据(常见的如csv格式文件)、EXCEL表格数据、各种关系型数据库、NetCDF格式数据、XML格式数据、JSON格式数据、Matlab格式数据、统计软件SPSS、SAS以及stata格式的数据等。 R拥有自己的数据文件格式：rds和RData(或rda)，能够将数据更快地加载到R的工作空间，rds格式只能存储一个变量，而rda或RData格式可以保存不同类型的多个数据对象乃至整个工作空间中的内容。</p>
<section id="纯文本数据读写" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="纯文本数据读写"><span class="header-section-number">2.4.1</span> 纯文本数据读写</h3>
<p>纯文本数据是最常见的一种数据格式，最常见的是以空格或逗号隔开。R提供<code>read.table()</code>函数及其各种变体函数(如<code>read.csv()</code>等)来读入纯文本数据，通过<code>write.table()</code>函数及各种变体函数(如<code>write.csv()</code>等)来保存纯文本数据。tidyverse套件中的readr包提供了丰富且效率更高的数据读写函数，其命名一般为<code>read_*</code>和<code>write_*</code>形式，这里的<code>*</code>代表不同类型数据的格式，如<code>csv</code>、<code>tsv</code>、<code>rds</code>等。这里介绍<code>read_csv()</code>和<code>write_csv()</code>两个函数的使用。</p>
<p>读取csv格式数据文件的函数：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_csv</span>(</span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>  file,  <span class="co"># 文件名，包括具体路径，需要用英文引号</span></span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="cn">TRUE</span>,  <span class="co"># 指定第一行是否为列名，如果赋值字符串向量则指定列名</span></span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_types =</span> <span class="cn">NULL</span>,  <span class="co"># 指定列的数据类型</span></span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_select =</span> <span class="cn">NULL</span>,  <span class="co"># 选择读入的列</span></span>
<span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="cn">NULL</span>,  <span class="co"># 指定存储数据文件路径的列名</span></span>
<span id="cb249-7"><a href="#cb249-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">locale =</span> <span class="fu">default_locale</span>(),  <span class="co"># 区域设置，关系到时区、编码、小数点标记等</span></span>
<span id="cb249-8"><a href="#cb249-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">na =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"NA"</span>),  <span class="co"># 指定为缺失值的字符</span></span>
<span id="cb249-9"><a href="#cb249-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">comment =</span> <span class="st">""</span>,  <span class="co"># 指定为注释的字符串，其后文本将被忽略</span></span>
<span id="cb249-10"><a href="#cb249-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">trim_ws =</span> <span class="cn">TRUE</span>,  <span class="co"># 解析数据前是否消除前导和尾随的空格</span></span>
<span id="cb249-11"><a href="#cb249-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">skip =</span> <span class="dv">0</span>,  <span class="co"># 指定跳过读取的行数</span></span>
<span id="cb249-12"><a href="#cb249-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_max =</span> <span class="cn">Inf</span>,  <span class="co"># 指定读取的最大行数</span></span>
<span id="cb249-13"><a href="#cb249-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">guess_max =</span> <span class="fu">min</span>(<span class="dv">1000</span>, n_max),  <span class="co"># 指定猜测列类型的最大行数</span></span>
<span id="cb249-14"><a href="#cb249-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">name_repair =</span> <span class="st">"unique"</span>,  <span class="co"># 修复列名，默认是确保列名的唯一性</span></span>
<span id="cb249-15"><a href="#cb249-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_threads =</span> <span class="fu">readr_threads</span>(),  <span class="co"># 指定初始解析和延迟读取数据的线程数</span></span>
<span id="cb249-16"><a href="#cb249-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">progress =</span> <span class="fu">show_progress</span>(),  <span class="co"># 是否显示进度条</span></span>
<span id="cb249-17"><a href="#cb249-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">show_col_types =</span> <span class="fu">should_show_types</span>(),  <span class="co"># 是否显示猜测的列名</span></span>
<span id="cb249-18"><a href="#cb249-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">skip_empty_rows =</span> <span class="cn">TRUE</span>,  <span class="co"># 是否忽略空行</span></span>
<span id="cb249-19"><a href="#cb249-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">lazy =</span> <span class="fu">should_read_lazy</span>()  <span class="co"># 是否延迟读取</span></span>
<span id="cb249-20"><a href="#cb249-20" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>以上为<code>read_csv()</code>函数及其参数。其他类似函数的用法与此大同小异，具体可以查阅帮助信息。 例如，读取当前目录下data子目录中的so2-2021-hf.csv数据文件：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"./data/so2-2021-hf.csv"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>注意，R中输入文件目录中的“”具有转义功能，所以要用“/”或“\”替代。上面的代码将该文件读入到df变量中。 保存csv格式数据文件的函数：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(</span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>  x,  <span class="co"># 指定要存储的变量</span></span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>  file,  <span class="co"># 指定存储的文件名，可包含路径</span></span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">na =</span> <span class="st">"NA"</span>,  <span class="co"># 指定缺失值使用的字符串，默认是NA</span></span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">append =</span> <span class="cn">FALSE</span>,  <span class="co"># 指定数据添加到文件的方式，默认是覆盖，如为True则追加到现有文件中</span></span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="sc">!</span>append,  <span class="co"># 指定是否保存列名</span></span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">quote =</span> <span class="fu">c</span>(<span class="st">"needed"</span>, <span class="st">"all"</span>, <span class="st">"none"</span>),  <span class="co"># 指定处理包含需要引号的字符的字段的方式</span></span>
<span id="cb251-8"><a href="#cb251-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">escape =</span> <span class="fu">c</span>(<span class="st">"double"</span>, <span class="st">"backslash"</span>, <span class="st">"none"</span>),  <span class="co"># 当数据中有引号时的转义方式</span></span>
<span id="cb251-9"><a href="#cb251-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">eol =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,  <span class="co"># 指定行结束字符</span></span>
<span id="cb251-10"><a href="#cb251-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">num_threads =</span> <span class="fu">readr_threads</span>(),  <span class="co"># 同read_csv</span></span>
<span id="cb251-11"><a href="#cb251-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">progress =</span> <span class="fu">show_progress</span>()  <span class="co"># 同read_csv</span></span>
<span id="cb251-12"><a href="#cb251-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>以上为<code>write_csv()</code>函数及其参数，其他类似函数的用法与此基本相同，具体可以查阅帮助信息。 例如，将内置数据集airquality存储到当前子目录data中：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(airquality, <span class="st">"./data/aqdata.csv"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="excel数据读写" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="excel数据读写"><span class="header-section-number">2.4.2</span> Excel数据读写</h3>
<p>tidyverse套件中的readxl包提供了读取Excel格式数据文件的函数： <code>read_excel()</code>、<code>read_xls()</code>和<code>read_xlsx()</code>。其<code>中read_excel()</code>函数的形式及其参数如下所示：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_excel</span>(</span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>  path,  <span class="co"># 指定文件名，包含路径</span></span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sheet =</span> <span class="cn">NULL</span>,  <span class="co"># 指定要读取的工作表(Excel文件可包含多个工作表)</span></span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">range =</span> <span class="cn">NULL</span>,  <span class="co"># 指定工作表的读取范围</span></span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_names =</span> <span class="cn">TRUE</span>,  <span class="co"># 指定第一行是否为列名</span></span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">col_types =</span> <span class="cn">NULL</span>,  <span class="co"># 指定各列数据类型</span></span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">na =</span> <span class="st">""</span>,  <span class="co"># 指定解释为缺失值的字符</span></span>
<span id="cb253-8"><a href="#cb253-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">trim_ws =</span> <span class="cn">TRUE</span>,  <span class="co"># 是否消除前导和尾随空格</span></span>
<span id="cb253-9"><a href="#cb253-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">skip =</span> <span class="dv">0</span>,  <span class="co"># 指定跳过读取的行数</span></span>
<span id="cb253-10"><a href="#cb253-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_max =</span> <span class="cn">Inf</span>,  <span class="co"># 指定读取的最大行数</span></span>
<span id="cb253-11"><a href="#cb253-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">guess_max =</span> <span class="fu">min</span>(<span class="dv">1000</span>, n_max),  <span class="co"># 指定猜测列类型的最大行数</span></span>
<span id="cb253-12"><a href="#cb253-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">progress =</span> <span class="fu">readxl_progress</span>(),  <span class="co"># 是否显示进度条</span></span>
<span id="cb253-13"><a href="#cb253-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">.name_repair =</span> <span class="st">"unique"</span>  <span class="co"># 修复列名，默认是确保列名的唯一性</span></span>
<span id="cb253-14"><a href="#cb253-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>其他两个函数的用法与<code>read_excel()</code>基本相同。 例如读取当前目录下子目录data中的pollutants-2021-hf.xlsx数据文件中第二个表格：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">"./data/pollutants-2021-hf.xlsx"</span>,</span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sheet =</span> <span class="dv">2</span>, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>如果要将R的数据框变量写为Excel格式文件，可利用xlsx包中的<code>write.xlsx()</code>函数。</p>
</section>
<section id="r格式数据读写" class="level3" data-number="2.4.3">
<h3 data-number="2.4.3" class="anchored" data-anchor-id="r格式数据读写"><span class="header-section-number">2.4.3</span> R格式数据读写</h3>
<p>读写包含单个变量的rds格式数据：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(a, <span class="st">"a.rds"</span>)    <span class="co"># 将a的内容保存到a.rds文件中</span></span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(a)    <span class="co"># 从当前空间删除a</span></span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">"a.rds"</span>)    <span class="co"># 从a.rds文件读入其中保存的数据，并赋值给变量b</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>读写包含多个变量的RData(或rda)类型数据文件的函数为<code>load()</code>和<code>save()</code>。<code>save.image()</code>是<code>save()</code>的变体，用于将当前环境所有变量都写入RData文件。R和RStudio在退出时默认将当前工作环境所有变量保存到当前目录下的<strong>.RData</strong>文件中。为了区别以及方便，用户自己保存的变量建议用<strong>rda</strong>作为扩展名。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>; b <span class="ot">=</span> letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]; c <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"PM10"</span>, <span class="st">"PM2.5"</span>, <span class="st">"O3"</span>)</span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(a, b, c, <span class="at">file =</span> <span class="st">"air.rda"</span>)    <span class="co"># 将三个变量写入文件，"file =" 不可省略</span></span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())    <span class="co"># 删除环境中所有变量</span></span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"air.rda"</span>)    <span class="co"># 读取数据文件，其中变量全部加载入当前工作空间</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="其他格式数据读写" class="level3" data-number="2.4.4">
<h3 data-number="2.4.4" class="anchored" data-anchor-id="其他格式数据读写"><span class="header-section-number">2.4.4</span> 其他格式数据读写</h3>
<p>NetCDF(Network Common Data Form)是美国大学大气研究协会(UCAR)的Unidata项目科学家针对科学数据的特点开发的网络通用数据格式，是一种面向数组型、跨平台并适于网络共享的数据的描述和编码标准。NetCDF已经广泛应用于大气科学、水文、海洋学、环境模拟、地球物理等诸多领域。 在R中导入NetCDF格式数据(扩展名为nc)需要借助ncdf4包，具体操作可参考该包的帮助信息。</p>
<p>XML是可扩展标记语言(eXtensible Markup Language)，被设计用于传输和存储数据。利用XML包，可以读取和处理XML数据文件。</p>
<p>JSON是JavaScript Object Notation的缩写，剂JavaScript对象表示法，是一种存储和交换文本信息的语法。JSON类似XML，但比XML更小、更快，更易解析。jsonlite和rjson是R语言处理json数据的最常用的两个工具包。</p>
<p>R的foreign包中提供了读取SPSS、SAS、Stata、Minitab、S、Weka等多个统计软件的数据文件的函数以及保存为相关格式数据文件的函数。R.matlab包提供了读写mat格式数据文件并从R内部调用Matlab的功能。imager包提供了多种图像处理的函数，帮助R对图像数据进行分析。</p>
<p>在RStudio的“<strong>File</strong>”菜单中，有一个“Import Dataset”菜单项，其中不仅有导入文本和Excel数据的选项，也有导入SPSS、SAS和Stata格式数据的选项(通过haven包实现)。在RStudio的“Environment”窗口的工具栏上也可以找到这些选项。</p>
<p>R拥有多种面向关系型数据库管理系统(DBMS)的接口(包)，包括SQL Server、Access、MySQL、Oracle、PostgreSQL、DB2、Sybase、Teradata、以及SQLite。其中一些包通过原生的数据库驱动提供访问功能，另一些则是通过ODBC或JDBC来实现访问的。</p>
</section>
<section id="大数据文件读写" class="level3" data-number="2.4.5">
<h3 data-number="2.4.5" class="anchored" data-anchor-id="大数据文件读写"><span class="header-section-number">2.4.5</span> 大数据文件读写</h3>
<p>在处理较大规模的数据文件时(文件大小1GB以上)，data.table包提供的<code>fread()</code>和<code>fwrite()</code>函数的读写速度具有显著的优势。同时该包还提供了更高效的各种操作数据的函数。结合bigmemory包的内存管理，可以实现大数据的高效处理。在CRAN网站的“Task View”中的<a href="https://CRAN.R-project.org/view=HighPerformanceComputing">HighPerformanceComputing</a>任务分类中可以查阅大数据读写、处理与分析相关的R包。其中fst包使用多线程的方式读写fst格式的数据文件。大数据保存为csv格式会占用很大的磁盘空间，可利用fst包中的<code>write_fst()</code>函数将导入的csv格式数据另存为fst格式文件，再用<code>read_fst()</code>读取fst文件，既可减少数据磁盘占用，又能加快读取速度。ff、disk.frame等R包提供了对太大而无法加载到内存中的数据集的访问功能以及许多更高级别的功能。</p>
<p>更大规模的海量数据通常采用分布式文件系统、NoSQL数据库、云数据库等方式存储。Spark和Hadoop是两个著名的大数据框架，Spark处理速度快且易于使用，而Hadoop安全性高且成本低廉。R包sparklyr提供了Spark的R接口，该包支持连接到本地和远程的Spark集群，提供了一个兼容dplyr包的后端，并提供使用Spark内置机器学习算法的接口。有关R与Spark结合来处理大数据的内容，可参阅<a href="https://spark.rstudio.com">R interface to Apache Spark</a>提供的信息。</p>
</section>
</section>
<section id="控制结构和自定义函数" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="控制结构和自定义函数"><span class="header-section-number">2.5</span> 控制结构和自定义函数</h2>
<section id="表达式" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="表达式"><span class="header-section-number">2.5.1</span> 表达式</h3>
<p>R的任何一个语句都可以看成是一个表达式。R允许一行可以有多个表达式，但必须以分号隔开。如：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="dv">5</span>; b <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">each =</span> <span class="dv">3</span>)</span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>c <span class="ot">=</span> <span class="fu">mean</span>(b)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>为了提高代码的可读性和格式规范性，通常不建议一行有多个表达式。当表达式长度超过行宽时， 表达式会自动续行。 如果上一行不是完整的表达式，如末尾是加减乘除等运算符，或有未配对的括号，则下一行为上一行的继续。若干个表达式可以组成一个复合表达式，复合表达式的值为最后一个表达式的值， 组合用大括号表示, 如：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>  c <span class="ot">=</span> a<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> b<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>  c</span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
</div>
<p>复合表达式常常用于分支结构、循环结构以及自定义函数。</p>
</section>
<section id="分支结构" class="level3" data-number="2.5.2">
<h3 data-number="2.5.2" class="anchored" data-anchor-id="分支结构"><span class="header-section-number">2.5.2</span> 分支结构</h3>
<section id="ifelse" class="level4" data-number="2.5.2.1">
<h4 data-number="2.5.2.1" class="anchored" data-anchor-id="ifelse"><span class="header-section-number">2.5.2.1</span> <code>ifelse</code></h4>
<p><code>ifelse</code>是一个结构紧凑的判断语句，其形式为：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(test, yes, no)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>参数test是一个返回逻辑值的对象或表达式，如果返回<code>TRUE</code>，则选择yes项，否则选择no项。如：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="sc">-</span><span class="dv">2</span><span class="sc">:</span><span class="dv">2</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">ifelse</span>(x <span class="sc">&gt;=</span> <span class="dv">0</span>, <span class="fu">sqrt</span>(x), <span class="cn">NA</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>上面的代码先对x中的元素执行≥0的比较，其返回值为<code>TRUE</code>或<code>FALSE</code>，如果为<code>TRUE</code>，则计算并返回该元素的平方根，如果为<code>FALSE</code>，则返回<code>NA</code>。</p>
</section>
<section id="if和ifelse" class="level4" data-number="2.5.2.2">
<h4 data-number="2.5.2.2" class="anchored" data-anchor-id="if和ifelse"><span class="header-section-number">2.5.2.2</span> <code>if</code>和<code>if</code>…<code>else</code>…</h4>
<p><code>if</code>语句执行一个条件判断，当返回值为<code>TRUE</code>时执行其后的表达式，否则不执行。如</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">30</span>L</span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.integer</span>(x)) {</span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(<span class="st">"x是一个整数"</span>)</span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "x是一个整数"</code></pre>
</div>
</div>
<p><code>if</code>…<code>else</code>…对条件判断返回的TRUE和FALSE都进行响应。如：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"tmall"</span>, <span class="st">"jingdong"</span>, <span class="st">"taobao"</span>)</span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="st">"tmall"</span></span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(a <span class="sc">%in%</span> x) {</span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(<span class="st">"x包含a"</span>)</span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb264-6"><a href="#cb264-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(<span class="st">"不包含a"</span>)</span>
<span id="cb264-7"><a href="#cb264-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "x包含a"</code></pre>
</div>
</div>
<p><code>if</code>…<code>else</code>…还可以嵌套，以对更多判断做出响应，如：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.6</span>, <span class="fl">0.3</span>, <span class="fl">0.9</span>)</span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq</span>(<span class="at">along =</span> x)){</span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x[i] <span class="sc">&lt;=</span> <span class="fl">0.2</span>){</span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Small</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(x[i] <span class="sc">&lt;=</span> <span class="fl">0.8</span>){</span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Medium</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb266-8"><a href="#cb266-8" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb266-9"><a href="#cb266-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Large</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb266-10"><a href="#cb266-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb266-11"><a href="#cb266-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Small
Medium
Medium
Large</code></pre>
</div>
</div>
<p>R是向量化语言，应尽可能少用标量运算，而采用向量化运算。例如，有一个向量x，现在要通过x来计算得到另一个等长向量y， 计算规则为y中元素当且仅当x的对应元素为正数时等于1， 否则等于0。 下面的代码是错误的：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">2</span>)  <span class="co"># 随机生成10个符合均值为0、标准差为2的正态分布数据</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(x <span class="sc">&gt;</span> <span class="dv">0</span>) y <span class="ot">=</span> <span class="dv">1</span> <span class="cf">else</span> y <span class="ot">=</span> <span class="dv">0</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in if (x &gt; 0) y = 1 else y = 0: the condition has length &gt; 1</code></pre>
</div>
</div>
<p>原因是<code>x &gt; 0</code>返回的是一个包含多个值的逻辑向量，而后续的赋值操作传递的是一个标量。 正确的向量化运算的代码为：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">integer</span>(<span class="fu">length</span>(x))    <span class="co"># 生成一个与x等长的元素均为0的整数向量</span></span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a>y[x <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb270-4"><a href="#cb270-4" aria-hidden="true" tabindex="-1"></a>y</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0 0 0 0 0 1 0 0 0 0</code></pre>
</div>
</div>
<p>采用向量的下标(或称索引)来实现判断是一种良好的编程习惯。<code>x &gt; 0</code>返回一个与x等长度的逻辑型向量，同时对应y的每一个下标，值为<code>TRUE</code>的下标位置上的y元素被赋值1。 R中的<code>switch()</code>函数也可以建立多分支结构，但嵌套的<code>if</code>…<code>else</code>…结构更容易理解，逻辑也更清晰。因此，尽可能避免使用<code>swtich()</code>创建多分支结构。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="st">"air"</span></span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="cf">switch</span>(x,</span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">water =</span> <span class="st">"COD"</span>,</span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">air   =</span> <span class="st">"SO2"</span>,</span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">"未知选项"</span>)</span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(res)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SO2"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="st">"soil"</span></span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="cf">switch</span>(x,</span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">water =</span> <span class="st">"COD"</span>,</span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">air   =</span> <span class="st">"SO2"</span>,</span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">"未知选项"</span>)</span>
<span id="cb274-6"><a href="#cb274-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(res)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "未知选项"</code></pre>
</div>
</div>
</section>
</section>
<section id="循环结构" class="level3" data-number="2.5.3">
<h3 data-number="2.5.3" class="anchored" data-anchor-id="循环结构"><span class="header-section-number">2.5.3</span> 循环结构</h3>
<section id="for循环" class="level4" data-number="2.5.3.1">
<h4 data-number="2.5.3.1" class="anchored" data-anchor-id="for循环"><span class="header-section-number">2.5.3.1</span> <code>for</code>循环</h4>
<p><code>for</code>循环可以实现基本的计数循环，也能对容器对象中的各个元素逐一进行操作。例如，前面向量计算的问题也可以采用for循环来解决：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb276"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">3</span>)</span>
<span id="cb276-2"><a href="#cb276-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="fu">integer</span>(<span class="fu">length</span>(x))</span>
<span id="cb276-3"><a href="#cb276-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(x)){  <span class="co"># seq_along()函数生成与x长度相等的从1开始的整数序列</span></span>
<span id="cb276-4"><a href="#cb276-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x[i] <span class="sc">&gt;</span> <span class="dv">0</span>) y[i] <span class="ot">=</span> <span class="dv">1</span> <span class="cf">else</span> y[i] <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb276-5"><a href="#cb276-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>显然，<code>for</code>循环很容易理解，但执行效率低，而且没有向量化运算简洁和优雅。</p>
<p>虽然R可以直接遍历向量中的元素，但有时会导致向量属性丢失，如日期时间类型的向量。此时，应采用下标访问的方法。此外，在循环中可以通过<code>next</code>命令(而非函数)直接进入下一轮循环，用<code>break</code>命令跳出循环。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb277"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建日期类型向量</span></span>
<span id="cb277-2"><a href="#cb277-2" aria-hidden="true" tabindex="-1"></a>date_vec <span class="ot">=</span> <span class="fu">as.POSIXct</span>(<span class="fu">c</span>(<span class="st">"2024-01-01"</span>, <span class="st">"2024-02-01"</span>,</span>
<span id="cb277-3"><a href="#cb277-3" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"2024-03-01"</span>, <span class="st">"2024-04-01"</span>))</span>
<span id="cb277-4"><a href="#cb277-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用下标遍历向量</span></span>
<span id="cb277-5"><a href="#cb277-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(date_vec)) {</span>
<span id="cb277-6"><a href="#cb277-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 如果日期在3月和4月，就跳出整个循环</span></span>
<span id="cb277-7"><a href="#cb277-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">format</span>(date_vec[i], <span class="st">"%m"</span>) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"03"</span>, <span class="st">"04"</span>)) {</span>
<span id="cb277-8"><a href="#cb277-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb277-9"><a href="#cb277-9" aria-hidden="true" tabindex="-1"></a>  }  </span>
<span id="cb277-10"><a href="#cb277-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 如果日期在2月，就跳过本轮循环，不打印日期</span></span>
<span id="cb277-11"><a href="#cb277-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">format</span>(date_vec[i], <span class="st">"%m"</span>) <span class="sc">==</span> <span class="st">"02"</span>) {</span>
<span id="cb277-12"><a href="#cb277-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb277-13"><a href="#cb277-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb277-14"><a href="#cb277-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 打印日期</span></span>
<span id="cb277-15"><a href="#cb277-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(date_vec[i])</span>
<span id="cb277-16"><a href="#cb277-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2024-01-01 CST"</code></pre>
</div>
</div>
</section>
<section id="while和repeat循环" class="level4" data-number="2.5.3.2">
<h4 data-number="2.5.3.2" class="anchored" data-anchor-id="while和repeat循环"><span class="header-section-number">2.5.3.2</span> <code>while</code>和<code>repeat</code>循环</h4>
<p><code>while</code>循环在条件为<code>TRUE</code>时才进行循环，如果第一次条件判断返回<code>FALSE</code>就一次也不执行循环内的语句。而<code>repeat</code>循环是无条件循环，其循环内的语句中一般采用<code>if</code>语句和<code>break</code>命令结合，当<code>if</code>判断条件为<code>TRUE</code>时跳出循环，所以<code>repeat</code>语句至少需要执行一次循环内的语句。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="co"># while循环</span></span>
<span id="cb279-2"><a href="#cb279-2" aria-hidden="true" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb279-3"><a href="#cb279-3" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (i <span class="sc">&lt;=</span> <span class="dv">3</span>) {</span>
<span id="cb279-4"><a href="#cb279-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"这是第"</span>, i, <span class="st">"次while循环"</span>))</span>
<span id="cb279-5"><a href="#cb279-5" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">=</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb279-6"><a href="#cb279-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "这是第 1 次while循环"
[1] "这是第 2 次while循环"
[1] "这是第 3 次while循环"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb281"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="co"># repeat循环</span></span>
<span id="cb281-2"><a href="#cb281-2" aria-hidden="true" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb281-3"><a href="#cb281-3" aria-hidden="true" tabindex="-1"></a><span class="cf">repeat</span> {</span>
<span id="cb281-4"><a href="#cb281-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"这是第"</span>, i, <span class="st">"次repeat循环"</span>))</span>
<span id="cb281-5"><a href="#cb281-5" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">=</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb281-6"><a href="#cb281-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&gt;</span> <span class="dv">3</span>) {</span>
<span id="cb281-7"><a href="#cb281-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb281-8"><a href="#cb281-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb281-9"><a href="#cb281-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "这是第 1 次repeat循环"
[1] "这是第 2 次repeat循环"
[1] "这是第 3 次repeat循环"</code></pre>
</div>
</div>
<p>在R中应尽量避免使用循环，因为其速度比向量化运算慢一个数量级以上，处理大数据时，运算效率低的劣势更为明显。</p>
</section>
<section id="循环遍历的替代方法" class="level4" data-number="2.5.3.3">
<h4 data-number="2.5.3.3" class="anchored" data-anchor-id="循环遍历的替代方法"><span class="header-section-number">2.5.3.3</span> 循环遍历的替代方法</h4>
<p>对矩阵以及数据框类型的大数据集，采用循环遍历其中每个元素的方法，其时间成本非常大。为此，R提供了<code>apply</code>系列函数来替代循环语句，实现高效运算。</p>
<ul>
<li><code>apply()</code>: 按行或列对数组元素应用函数，返回向量</li>
<li><code>lapply()</code>: 对列表或向量元素应用函数，返回列表</li>
<li><code>sapply()</code>: 与<code>lapply()</code>相同，但简化输出</li>
<li><code>tapply()</code>: 按因子水平分类并应用函数</li>
<li><code>mapply()</code>: <code>sapply()</code>的多元版本</li>
<li><code>rapply()</code>: <code>lapply()</code>的递归版本</li>
<li><code>eapply()</code>: 运用函数遍历“环境”的具名元素</li>
<li><code>vapply()</code>: 类似<code>sapply()</code>，可设定返回值的类型</li>
</ul>
<p><code>apply</code>系列函数在遍历不同对象中元素的同时，按指定维度或范围应用指定的函数来进行运算，然后返回运算结果。<code>apply</code>函数形式如下：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(X,           <span class="co"># 数据对象</span></span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>  MARGIN,          <span class="co"># 1表示按**行**运算，2表示按**列**运算</span></span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a>  FUN,             <span class="co"># 执行运算的函数名，可以是自定义的函数</span></span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a>  ...,             <span class="co"># 其他参数</span></span>
<span id="cb283-5"><a href="#cb283-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">simplify =</span> <span class="cn">TRUE</span>  <span class="co"># 输出结果是否简化</span></span>
<span id="cb283-6"><a href="#cb283-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>例如，对R内置的鸢尾花分类数据集iris的前4列执行求均值、标准差运算：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">2</span>, mean)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
    5.843333     3.057333     3.758000     1.199333 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">2</span>, sd)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
   0.8280661    0.4358663    1.7652982    0.7622377 </code></pre>
</div>
</div>
<p>tapply函数对数据按指定的因子水平分组后再应用指定的函数。例如对iris数据集按鸢尾花类别名称(三类，即三个水平)计算Sepal.length列的平均值：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb288"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tapply</span>(iris<span class="sc">$</span>Sepal.Length, iris<span class="sc">$</span>Species, mean)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    setosa versicolor  virginica 
     5.006      5.936      6.588 </code></pre>
</div>
</div>
<p>可通过查阅帮助信息以进一步学习和掌握这些函数的用法。注意不同apply函数返回结果的类型可能不同。</p>
<p>R还提供了<code>rowSums()</code>、<code>colSums()</code>、<code>rowMeans()</code>、<code>colMeans()</code>四个函数以替代循环计算矩阵和数据框的行和、列和、行均值、列均值。</p>
<p>tidyverse中的purrr包提供了泛函式编程功能，可以实现更优雅的循环迭代。函数的函数称为泛函，在编程中表示函数作用在函数上，或者说函数包含其它函数作为参数。其中<code>map()</code>和<code>map_*()</code>系列函数依次将指定函数应用于一个向量或列表中的每个元素上，<code>map2()</code>和<code>map2_*()</code>系列函数依次将指定函数应用于两个向量中的每对元素上，<code>pmap()</code>和<code>pmap_*()</code>系列函数将指定函数应用于多个向量(封装成列表对象或数据框对象)中的每组元素上，<code>imap()</code>和<code>imap_*()</code>系列函数将指定函数应用于向量或列表的元素及其索引上。<code>map()</code>、<code>map2()</code>及<code>pmap()</code>默认返回列表，<code>imap()</code>返回向量。添加后缀<code>_int</code>、<code>_dbl</code>、<code>_lgl</code>、<code>_chr</code>、<code>_df</code>则返回相应的类型，添加<code>_df</code>、<code>_dfr</code>、<code>_dfc</code>则返回数据框类型，其中后二者可按行或列合并。这些函数输入的向量应为原子向量类型，即向量中的元素是同类型的，包括6种类型：logical、integer、double、character、complex、raw(原始字节)，其中 integer 和 double 统称为numeric。如果需要有条件的应用<code>map()</code>，可使用<code>map_if()</code>和<code>map_at()</code>函数。</p>
<p>例如，用map函数对iris数据集前4列求平均值的代码如下：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(iris[, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], mean)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Sepal.Length
[1] 5.843333

$Sepal.Width
[1] 3.057333

$Petal.Length
[1] 3.758

$Petal.Width
[1] 1.199333</code></pre>
</div>
</div>
<p>purrr还提供了<code>walk()</code>、<code>walk2()</code>、<code>pwalk()</code>和<code>iwalk()</code>函数，用于执行副作用，即不返回任何结果。有时仅需要遍历一个数据结构调用函数进行一些显示、绘图等无需返回值的操作，这称为函数的副作用，不需要返回结果。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a>list1 <span class="ot">=</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">c =</span> <span class="dv">3</span>)</span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a>list2 <span class="ot">=</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="dv">10</span>, <span class="at">y =</span> <span class="dv">20</span>, <span class="at">z =</span> <span class="dv">30</span>)</span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a><span class="fu">walk2</span>(list1, list2, <span class="sc">~</span> <span class="fu">cat</span>(.x, .y, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1 10 
2 20 
3 30 </code></pre>
</div>
</div>
<p>tidyverse套件都支持管道操作符，最常用的是<code>%&gt;%</code>，还有<code>%T&gt;%</code>(传递上一步结果给下一步操作后，再将上一步原始结果继续向后传递)、<code>%&lt;&gt;%</code>(用下一步结果对上一步结果进行更新)和<code>%$%</code>(将上一步结果中的名字传递给下一步)，使用频率较低。<code>%&gt;%</code>的功能最简单，就是将数据经上一个函数处理或操作后的结果传递给下一个函数，从而将数据整理、分析与建模的流程整合在一个链条上，既简化了代码，使得代码逻辑关系更加清晰，又能省去中间变量的输出，减少内存占用。这些管道操作符依赖于magrittr包。R自4.1版开始增加的原生管道符<code>|&gt;</code>，可以替代<code>%&gt;%</code>，从而不再依赖magrittr包，减少资源占用，运算效率更高。但原生管道符<code>|&gt;</code>目前还不支持占位符，当函数的第一个参数不是上一步骤的结果时，需要构造<strong>匿名函数</strong>来解决。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用%&gt;%</span></span>
<span id="cb294-3"><a href="#cb294-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rnorm</span>(<span class="dv">10000</span>, <span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>          <span class="co"># 生成10000个正态分布随机数</span></span>
<span id="cb294-4"><a href="#cb294-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>(<span class="at">size =</span> <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span>    <span class="co"># 从中随机抽取100</span></span>
<span id="cb294-5"><a href="#cb294-5" aria-hidden="true" tabindex="-1"></a>  abs <span class="sc">%&gt;%</span>                                    <span class="co"># 求绝对值</span></span>
<span id="cb294-6"><a href="#cb294-6" aria-hidden="true" tabindex="-1"></a>  log <span class="sc">%&gt;%</span>                                    <span class="co"># 求自然对数值</span></span>
<span id="cb294-7"><a href="#cb294-7" aria-hidden="true" tabindex="-1"></a>  diff <span class="sc">%&gt;%</span>                                   <span class="co"># 一次差分</span></span>
<span id="cb294-8"><a href="#cb294-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">col =</span> <span class="st">"red"</span>, <span class="at">type =</span> <span class="st">"l"</span>)              <span class="co"># 绘制图形</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="CH2_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
</div>
<p>从上述代码可见，利用管道操作符整合数据处理流程，代码简洁优雅，逻辑清晰。当函数的第一个形参就是上一个函数处理后的对象且无需设置其他形参时，可省略<code>()</code>，只使用函数名。 如果流程中调用的第一个输入参数并非上一步结果的函数，如<code>lm()</code>函数，则<code>%&gt;%</code>和<code>|&gt;</code>会有区别：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb295"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" aria-hidden="true" tabindex="-1"></a>airquality <span class="sc">%&gt;%</span> </span>
<span id="cb295-2"><a href="#cb295-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(Ozone <span class="sc">~</span> Temp, <span class="at">data =</span> .)  </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Ozone ~ Temp, data = .)

Coefficients:
(Intercept)         Temp  
   -146.995        2.429  </code></pre>
</div>
</div>
<p><code>%&gt;%</code>提供了占位符<code>.</code>来解决这个问题，而<code>|&gt;</code>则需要构造一个匿名函数来解决这个问题：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a>airquality <span class="sc">|&gt;</span></span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a>  (\(x) <span class="fu">lm</span>(Ozone <span class="sc">~</span> Temp, <span class="at">data =</span> x))()</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Ozone ~ Temp, data = x)

Coefficients:
(Intercept)         Temp  
   -146.995        2.429  </code></pre>
</div>
</div>
<p>在R与RStudio中可使用<kbd aria-hidden="true">Ctrl+Shift+M</kbd><span class="visually-hidden">Ctrl+Shift+M</span>组合键输入管道符号，默认为<code>%&gt;%</code>，如果需要改为<code>|&gt;</code>，可依次点击菜单“<strong>Tools</strong>”→“Global options…”，打开“Options”对话框，点击其中左侧“Code”，在右侧“Editing”标签下，勾选“Use native pipe operator, |&gt; (requires 4.1+)”选项。</p>
</section>
</section>
<section id="自定义函数" class="level3" data-number="2.5.4">
<h3 data-number="2.5.4" class="anchored" data-anchor-id="自定义函数"><span class="header-section-number">2.5.4</span> 自定义函数</h3>
<p>R语言以及R包的主要功能都是通过函数实现的。除了直接利用R语言和R包内置的各种函数以外，用户还可以根据数据处理任务的需求自己编写函数。自定义函数的形式如下：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb299"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" aria-hidden="true" tabindex="-1"></a>函数名 <span class="ot">=</span> <span class="cf">function</span>(arg1, arg2, ...) {</span>
<span id="cb299-2"><a href="#cb299-2" aria-hidden="true" tabindex="-1"></a>  函数体</span>
<span id="cb299-3"><a href="#cb299-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(返回值)</span>
<span id="cb299-4"><a href="#cb299-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>arg1</code>、<code>arg2</code>是自定义函数的形参，可以没有，也可以是多个，甚至用<code>...</code>作为形参以表示可以有任意个参数，另外也可以为形参指定默认值。函数体用花括号包围，<code>return()</code>并非必需(但有返回值时，建议加上，以提高代码可读性)，因为R自定义函数默认将最后一行的值作为返回值。 下面给出一个自定义函数的例子：</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a>myf <span class="ot">=</span> <span class="cf">function</span>(n, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">sd =</span> <span class="dv">2</span>){</span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">=</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> mean, <span class="at">sd =</span> sd)</span>
<span id="cb300-3"><a href="#cb300-3" aria-hidden="true" tabindex="-1"></a>  avg <span class="ot">=</span> <span class="fu">mean</span>(z)</span>
<span id="cb300-4"><a href="#cb300-4" aria-hidden="true" tabindex="-1"></a>  mx <span class="ot">=</span> <span class="fu">max</span>(z)</span>
<span id="cb300-5"><a href="#cb300-5" aria-hidden="true" tabindex="-1"></a>  mn <span class="ot">=</span> <span class="fu">min</span>(z)</span>
<span id="cb300-6"><a href="#cb300-6" aria-hidden="true" tabindex="-1"></a>  std <span class="ot">=</span> <span class="fu">sd</span>(z)</span>
<span id="cb300-7"><a href="#cb300-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">barplot</span>(z)</span>
<span id="cb300-8"><a href="#cb300-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">avg =</span> avg, <span class="at">min =</span> mn, <span class="at">max =</span> mx, <span class="at">sd =</span> std))</span>
<span id="cb300-9"><a href="#cb300-9" aria-hidden="true" tabindex="-1"></a>} </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>调用该函数时，可以一次传入三个参数的值，但也可以只传递n的参数值，<code>mean</code>和<code>sd</code>参数采用默认值。调用该函数后，会根据传入的参数生成一个正态分布的数据集，接着计算这个数据集的平均值、最大最小值以及标准差，并绘制该数据集的条形图，最后用列表形式返回计算的四个值。</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb301"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="fu">myf</span>(<span class="dv">100</span>, <span class="dv">10</span>, <span class="dv">2</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="CH2_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:60.0%"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$avg
[1] 10.00962

$min
[1] 5.654718

$max
[1] 14.38687

$sd
[1] 1.797214</code></pre>
</div>
</div>
<div id="exr-2.10" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 2.10</strong></span> <br>
利用readr包编写R代码，将airquality数据集命名为aqdata.csv保存到磁盘上。然后再将其读入到R的工作空间。利用readxl包编写R代码，将airquality数据集命名为aqdata.xlsx保存到磁盘上。然后再将其读入到R的工作空间。</p>
</div>
<div id="exr-2.11" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 2.11</strong></span> <br>
选择使用purrr包中<code>map</code>系列函数，计算R内置数据集iris前四列的均值和标准差。</p>
</div>
<div id="exr-2.12" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 2.12</strong></span> <br>
编写R代码，识别airquality数据集中的缺失值，并将其删除。</p>
</div>
<div id="exr-2.13" class="theorem exercise">
<p><span class="theorem-title"><strong>练习 2.13</strong></span> <br>
(4)大气污染物高架连续点源地面浓度理论计算方程为：</p>
<p><span class="math display">
\rho(x,y,0)=\frac{Q}{\pi\bar{u}\sigma_{y}\sigma_{z}}\exp\left(-\frac{y^{2}}{2\sigma_{y}^{2}}\right)\exp\left(-\frac{H^{2}}{2\sigma_{z}^{2}}\right)
</span></p>
<p>式中：<span class="math inline">\rho</span>为地面任一点污染物浓度，g/m<sup>3</sup>；<span class="math inline">x</span>(正向为平均风向)和<span class="math inline">y</span>(垂直于<span class="math inline">x</span>，正向在<span class="math inline">x</span>轴左侧)为地面任一点坐标；<span class="math inline">Q</span>为源强，g/s；<span class="math inline">u</span>̅为平均风速，m/s；<span class="math inline">H</span>为有效源高，m；<span class="math inline">\sigma_{y}</span>和；<span class="math inline">\sigma_{z}</span>分别为距原点<span class="math inline">x</span>处烟流中污染物在<span class="math inline">y</span>和<span class="math inline">z</span>方向上分布的标注差，m。请为该方程编写一个R函数。</p>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "已复制");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "已复制");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./CH1.html" class="pagination-link" aria-label="绪论">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">绪论</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./CH3.html" class="pagination-link" aria-label="环境数据整理与可视化">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">环境数据整理与可视化</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>环境数据分析与机器学习，邓大鹏 编著.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>本书采用<a href="https://quarto.org/">Quarto</a>构建.</p>
</div>
  </div>
</footer>




</body></html>